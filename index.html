<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NOTMINE4REAL</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'><path d='M12 2L21 7V17L12 22L3 17V7L12 2Z' /><path d='M12 6L17 9V15L12 18L7 15V9L12 6' /></svg>" id="app-favicon" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['var(--font-base)', 'sans-serif'],
              display: ['var(--font-head)', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
            },
            colors: {
              zinc: { 850: '#1f1f22', 900: '#18181b', 950: '#050505' },
              black: '#000000',
            },
            animation: {
              'reveal-up': 'revealUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards',
              'fade-in': 'fadeIn 0.8s ease-out forwards',
              'loader-spin': 'loaderSpin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite',
              'float': 'float 6s ease-in-out infinite',
              'ticker': 'ticker 25s linear infinite',
              'pop-in': 'popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
              'slide-up-out': 'slideUpOut 0.8s cubic-bezier(0.7, 0, 0.3, 1) forwards',
              'ambient-shift': 'ambientShift 15s ease infinite alternate',
            },
            keyframes: {
              revealUp: { '0%': { transform: 'translateY(30px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-15px)' } },
              ticker: { '0%': { transform: 'translateX(0)' }, '100%': { transform: 'translateX(-50%)' } },
              popIn: { '0%': { transform: 'scale(0.8)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
              slideUpOut: { '0%': { transform: 'translateY(0)', opacity: '1' }, '100%': { transform: 'translateY(-100%)', opacity: '0' } },
              ambientShift: { '0%': { backgroundPosition: '0% 50%' }, '100%': { backgroundPosition: '100% 50%' } }
            }
          }
        }
      }
    </script>
    <style>
      :root {
          --accent: #8b5cf6;
          --font-base: 'Outfit';
          --font-head: 'Space Grotesk';
          --text-size: 16px;
          --tracking: normal;
          --radius: 1rem;
          --grid-gap: 1.5rem;
      }
      
      body { 
          background-color: #000000; 
          color: #f4f4f5; 
          overflow-x: hidden; 
          transition: background-color 0.5s ease; 
          font-size: var(--text-size);
          letter-spacing: var(--tracking);
      }
      
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #52525b; }
      
      .glass-panel { background: rgba(5, 5, 5, 0.6); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.05); }
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

      .text-accent { color: var(--accent) !important; }
      .bg-accent { background-color: var(--accent) !important; }
      .border-accent { border-color: var(--accent) !important; }
      .group:hover .group-hover\:text-accent { color: var(--accent) !important; }
      
      /* Base Dynamic Border Radius */
      .rounded-dynamic { border-radius: var(--radius) !important; }

      /* Modifiers */
      body.perf-mode .glass-panel, body.perf-mode .backdrop-blur-xl { backdrop-filter: none !important; background-color: #0a0a0a !important; }
      body.oled-mode { background-color: #000000 !important; }
      body.hide-scroll ::-webkit-scrollbar { display: none !important; }
      body.no-hover-fx .group:hover .hover-trigger { transform: none !important; box-shadow: none !important; border-color: rgba(255,255,255,0.05) !important; background-color: #0a0a0a !important; }
      body.compact-ui #games-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important; }
      body.blur-locked > *:not(#blur-overlay) { filter: blur(20px); pointer-events: none; user-select: none; }
      
      /* Cursor Injection */
      body.cursor-override * { cursor: var(--custom-cursor, default) !important; }
      
      /* Perspective for 3D Menu */
      .perspective-1000 { perspective: 1000px; transform-style: preserve-3d; }
      
    </style>
</head>
<body class="antialiased min-h-screen overflow-hidden bg-black text-white selection:bg-zinc-800 selection:text-white">

    <!-- Blur Security Overlay -->
    <div id="blur-overlay" class="fixed inset-0 z-[9999] bg-black/80 flex flex-col items-center justify-center hidden opacity-0 transition-opacity duration-300">
        <i data-lucide="lock" class="w-16 h-16 text-zinc-500 mb-6"></i>
        <h1 class="text-4xl font-display font-bold tracking-widest text-white mb-2">LOCKED</h1>
        <p class="font-mono text-zinc-500 text-sm">Click anywhere or focus window to unlock.</p>
    </div>

    <!-- Intro Launcher -->
    <div id="launcher-layer" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-black/80 backdrop-blur-md hidden animate-fade-in">
        <div class="text-center animate-reveal-up max-w-md px-6">
             <div class="mb-10 relative group cursor-pointer" onclick="app.launchApp()">
                <div class="absolute inset-0 bg-white/10 rounded-full blur-2xl group-hover:blur-3xl transition-all duration-700 opacity-0 group-hover:opacity-100"></div>
                <button class="relative px-12 py-6 bg-black border border-zinc-700/50 rounded-full text-2xl font-display font-extrabold text-white group-hover:bg-white group-hover:text-black transition-all duration-500 shadow-2xl flex items-center justify-center gap-4 w-full transform group-hover:scale-105">
                    <i data-lucide="power" class="w-6 h-6"></i><span>INITIALIZE</span>
                </button>
             </div>
             <p class="text-zinc-500 font-mono text-xs uppercase tracking-widest mb-6 font-semibold">Secure Environment Required</p>
             <button onclick="app.runIntro()" class="text-zinc-600 hover:text-white text-[10px] uppercase tracking-wider underline decoration-zinc-800 transition-all duration-300">Run in current window (Debug)</button>
        </div>
    </div>

    <!-- Cutscene Layer -->
    <div id="cutscene-layer" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center overflow-hidden hidden">
        <div id="cs-logo" class="relative z-10 text-center hidden">
            <div class="inline-flex items-center justify-center w-24 h-24 bg-zinc-900 rounded-3xl mb-10 shadow-2xl border border-zinc-800 animate-pop-in">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 text-white"><path d="M12 2L21 7V17L12 22L3 17V7L12 2Z" /><path d="M12 6L17 9V15L12 18L7 15V9L12 6" /></svg>
            </div>
            <h1 class="font-display text-5xl md:text-8xl font-black tracking-tighter text-white animate-reveal-up leading-none">NOTMINE<span class="text-zinc-600">4REAL</span></h1>
            <p class="font-mono text-zinc-500 text-xs md:text-sm font-bold tracking-[0.4em] mt-8 uppercase animate-reveal-up opacity-0" style="animation-delay: 0.3s">Dark. Stealth. Unblocked.</p>
        </div>
    </div>

    <!-- MAIN MENU LAYER -->
    <div id="menu-layer" class="fixed inset-0 z-40 bg-black hidden flex-col transition-all duration-1000 overflow-hidden"></div>

    <!-- GAMES HUB LAYER -->
    <div id="library-layer" class="min-h-screen bg-[#050505] transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] opacity-0 pointer-events-none h-0 overflow-hidden blur-xl transform origin-top">
        <nav class="sticky top-0 z-40 w-full pt-6 px-6 pb-4 transition-transform duration-500 bg-gradient-to-b from-[#050505] to-transparent" id="library-nav">
            <div class="max-w-7xl mx-auto flex items-center justify-between gap-6 pointer-events-auto">
                <div class="hidden md:flex items-center gap-4 cursor-pointer group shrink-0" onclick="location.reload()">
                    <div class="w-12 h-12 bg-zinc-900 border border-zinc-800 rounded-dynamic flex items-center justify-center transform group-hover:rotate-[15deg] group-hover:scale-110 transition-all duration-300 relative overflow-hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="w-6 h-6 text-white relative z-10"><path d="M12 2L21 7V17L12 22L3 17V7L12 2Z"/><path d="M12 6L17 9V15L12 18L7 15V9L12 6"/></svg>
                    </div>
                    <div class="flex flex-col leading-none">
                        <h1 class="font-display font-extrabold text-2xl tracking-tight text-white">NOTMINE</h1>
                        <span class="text-[10px] font-mono font-bold text-zinc-500 tracking-[0.3em] group-hover:text-white transition-colors mt-1">4REAL</span>
                    </div>
                </div>
                <div class="flex-1 max-w-3xl relative group mx-auto w-full">
                    <div class="relative flex items-center w-full bg-zinc-900/60 backdrop-blur-xl border border-zinc-800/80 rounded-full shadow-2xl transition-all duration-300 group-focus-within:bg-[#0a0a0a] group-focus-within:border-zinc-700">
                        <div class="pl-6 pointer-events-none"><i data-lucide="search" class="w-5 h-5 text-zinc-500"></i></div>
                        <input type="text" id="search-input" placeholder="Search database..." class="w-full bg-transparent border-none py-4 px-4 text-white placeholder-zinc-600 focus:outline-none" autocomplete="off">
                    </div>
                </div>
                <div class="flex items-center gap-1.5 shrink-0 bg-zinc-900/60 backdrop-blur-xl border border-zinc-800/80 p-1.5 rounded-full shadow-xl">
                    <button onclick="app.playRandom()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all"><i data-lucide="shuffle" class="w-5 h-5"></i></button>
                    <button onclick="app.cloak()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all"><i data-lucide="eye-off" class="w-5 h-5"></i></button>
                    <button onclick="app.openSettings()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all"><i data-lucide="settings" class="w-5 h-5"></i></button>
                </div>
            </div>
        </nav>
        <main class="max-w-7xl mx-auto px-6 py-6 min-h-screen">
            <div id="hero-section"></div>
            <div class="flex flex-wrap items-center gap-2 mb-10 scrollbar-hide overflow-x-auto pb-2" id="filter-container"></div>
            <div id="games-grid" class="grid gap-x-6 gap-y-10 pb-32 transition-all duration-300" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--grid-gap);"></div>
        </main>
    </div>

    <!-- FULL PAGE SETTINGS LAYER -->
    <div id="settings-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        
        <!-- Settings Navbar -->
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-white/5 shrink-0">
            <div class="flex items-center gap-6">
                <button onclick="app.closeSettings()" class="flex items-center gap-3 px-4 py-2 bg-white text-black rounded-full font-bold font-display hover:bg-zinc-200 transition-colors">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i> Back to Hub
                </button>
                <div class="h-8 w-[1px] bg-zinc-800"></div>
                <h2 class="font-display font-black text-3xl tracking-tight text-white">System Control</h2>
            </div>
            <div class="flex items-center gap-4">
                <span class="text-xs font-mono text-zinc-500 uppercase tracking-widest hidden md:block">Settings Module Active</span>
            </div>
        </div>

        <!-- Settings Body -->
        <div class="flex flex-1 overflow-hidden relative z-10">
            
            <!-- Sidebar Nav -->
            <div class="w-72 bg-[#080808] border-r border-white/5 flex flex-col p-6 space-y-2 overflow-y-auto scrollbar-hide shrink-0" id="settings-nav">
                <!-- Injected via JS -->
            </div>

            <!-- Content Area -->
            <div class="flex-1 bg-black overflow-y-auto scrollbar-hide relative p-10">
                <div class="max-w-4xl mx-auto">
                    
                    <div class="mb-10">
                        <h3 id="settings-cat-title" class="text-5xl font-display font-black text-white tracking-tighter mb-2">Category</h3>
                        <p id="settings-cat-desc" class="text-zinc-500 font-mono text-sm uppercase tracking-widest">Configuration Options</p>
                    </div>

                    <!-- Options Grid -->
                    <div id="settings-options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-20">
                        <!-- Injected via JS -->
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- VIEWER LAYER -->
    <div id="viewer-layer" class="fixed inset-0 z-[100] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.02] pointer-events-none">
        <div id="viewer-bg" class="absolute inset-0 opacity-15 pointer-events-none blur-[100px] scale-110 bg-cover bg-center transition-opacity"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/95 to-black/80 pointer-events-none"></div>

        <div class="relative z-10 flex items-center justify-between px-6 h-16 glass-panel border-b border-white/5">
            <div class="flex items-center gap-4">
                <button onclick="app.closeViewer()" class="p-2 hover:bg-zinc-800/50 rounded-lg transition-colors group">
                    <i data-lucide="arrow-left" class="w-5 h-5 text-zinc-400 group-hover:text-white"></i>
                </button>
                <div class="h-6 w-[1px] bg-zinc-800"></div>
                <div>
                    <h2 id="viewer-title" class="font-display font-bold text-white text-lg leading-none tracking-tight">Title</h2>
                    <p id="viewer-category" class="text-[11px] text-zinc-500 font-mono tracking-widest uppercase mt-1">Category</p>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="app.panic()" class="flex items-center gap-2 px-4 py-1.5 bg-zinc-900 hover:bg-white hover:text-black text-zinc-400 text-xs font-bold tracking-widest uppercase rounded-lg transition-colors border border-zinc-800"><i data-lucide="alert-triangle" class="w-3 h-3"></i> PANIC</button>
                <div class="h-6 w-[1px] bg-zinc-800 mx-2 hidden md:block"></div>
                <button onclick="app.toggleFullscreen()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800/50 rounded-lg transition-all"><i data-lucide="maximize" class="w-5 h-5"></i></button>
            </div>
        </div>

        <div class="flex-1 relative flex items-center justify-center p-4 md:p-8 overflow-hidden">
            <div id="game-container" class="relative w-full h-full max-w-[1600px] max-h-[900px] bg-[#0a0a0a] rounded-dynamic overflow-hidden shadow-[0_0_60px_rgba(0,0,0,0.8)] border border-zinc-800/80">
                <iframe id="game-frame" class="w-full h-full border-0 rounded-dynamic" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        var _GAMES = [
            ["Web Proxy", "https://d1ks901xvjj2p6.cloudfront.net/index.html#/search", "https://th.bing.com/th?q=Proxy+Adobe+PNG+Logo&w=120&h=120&c=1&rs=1&qlt=70&o=7&cb=1&dpr=1.1&pid=InlineBlock&rm=3&defcache=1&mkt=en-US&cc=US&setlang=en&adlt=moderate&t=1&mw=247", "Utility"],
            ["School boy runaway", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_32c0c8b002c4cb975a08f1c4e11993e2.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/605.png", "Action"],
            ["Five Nights at Freddy's: Pizza Simulator", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_8fd1120b36baff86409a8a249b866bfa.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/191.png", "Horror"],
            ["Kindergarten 1", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ef521b915ffa7ef66db86684a0954a82.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/445.png", "Simulation"],
            ["Fears to fathom","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_572aa2e68dc88d7bf012e5521b5f5970.html","https://th.bing.com/th/id/OIP.pZgZfCleZe6OEQmMKUwwrAHaEK?w=300&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
            ["FNAF 1","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_88f80b2f48655ffe2d93c945dd97c8dc.html","https://th.bing.com/th/id/OIP.tzsQpIaytSceo6d7z-pNBAHaEK?w=326&h=183&c=7&r=0&o=5&pid=1.7","Horror"],
            ["Baldi's Basics","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b49415c7838d5272bed3689dc5bf5f3a.html","https://th.bing.com/th/id/OIP.v_jCMioFl5pXyG7IwRLZ9gHaEK?w=308&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
            ["Drift hunters","https://sgs-game-cdn.pages.dev/Projects/Drift%20Hunters/main","https://th.bing.com/th/id/OIP.R5-k2knM3MzQGSbXhLbLKAHaEJ?w=304&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
            ["Blade Ball","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_bbde690928dfba35150bd1a7cf17c993.html","https://th.bing.com/th/id/OIP.w9Bq0azXbFtMkqLSje-z5QAAAA?w=234&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
            ["Minecraft 1.12","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2dd5de6cb688fee72be5cbab95e095a0.html","https://th.bing.com/th/id/OIP.YfwEzGWk99WxLiQZXMTw1AHaEK?w=321&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sandbox"],
            ["Super Mario 64","https://sgs-game-cdn.pages.dev/Projects/Super%20Mario%2064/main","https://th.bing.com/th/id/OIP.NJpccXzTJ0OHPflJYWgYJAHaEK?w=274&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Retro"],
            ["Super hot","https://sgs-game-cdn.pages.dev/Projects/SuperHot/main","https://th.bing.com/th/id/OIP.5V1RdBCu6Mh0q9a1M_sfKAHaEK?w=321&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
            ["Only up","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4fa7e24a1a30d8d8390701c57ece7d60.html","https://th.bing.com/th/id/OIP.fZ1gZeFVMMWhSBosF5ezxAHaF0?w=239&h=187&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
            ["Chrome dino","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_908edc67fbe3f9f03b98e4ec322cbfa1.html","https://th.bing.com/th/id/OIP.AXkOaVfMJMHuPZ0kut5tPQHaEO?w=267&h=180&c=7&r=0&o=5&pid=1.7","Arcade"],
            ["Subway surfers","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2f468b2d851e314d09dcd63a635fb832.html","https://th.bing.com/th/id/OIP.h-kgCIZHfbEcXyvc1ksbWwHaEK?w=208&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
            ["1v1.lol","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_86ec7f8b730df71e730127f41f76e9dd.html","https://th.bing.com/th/id/OIP.ASM6tUWCDbxvnZvSQT1GWgHaD4?w=309&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"]
        ];

        const GAMES = _GAMES.map(g => ({ title: g[0], url: g[1], image: g[2], category: g[3] }));
        const CATEGORIES = ['All', 'Action', 'Horror', 'Racing', 'Arcade', 'Simulation', 'Retro', 'Strategy', 'Favorites'];

        class App {
            constructor() {
                this.activeCategory = 'All';
                this.searchQuery = '';
                this.currentGame = null;
                this.favorites = new Set(JSON.parse(localStorage.getItem('nm4r-favorites') || '[]'));
                this.activeSettingsTab = 'Design';
                this.previousLayer = 'menu'; // menu or library
                this.menuTiltListener = null;
                this.menuPreviewData = {};
                
                // 60 Configurations (6 Categories x 10 Options)
                this.settings = { 
                    // 1. Design
                    perfMode: false, oledMode: false, compactUI: false, glassmorphism: true, 
                    borderRadius: '1rem', gridGap: '1.5rem', ambientBg: true, hoverFx: true, 
                    hideScroll: false, hideNavScroll: false,
                    // 2. Cursor
                    cursorStyle: 'default',
                    // 3. Text
                    fontBase: 'Outfit', fontHead: 'Space Grotesk', textSize: '16px', textTracking: 'normal',
                    // 4. Site
                    tabTitle: 'NOTMINE4REAL', tabIcon: '', panicUrl: 'https://classroom.google.com', 
                    autoPauseBlur: false, muteBlur: false,
                    // 5. Security
                    panicKey: '`', blurLeave: false, noRightClick: false, noDevTools: false, 
                    askClose: false, hideHistory: false, passLock: false, passPin: '',
                    // 6. Themes
                    accentColor: '#8b5cf6'
                };
                
                this.init();
            }

            init() {
                try { 
                    const s = JSON.parse(localStorage.getItem('nm4r-settings'));
                    if (s) this.settings = { ...this.settings, ...s };
                } catch(e){}

                this.applySettings();
                this.setupSecurity();
                lucide.createIcons();

                document.getElementById('search-input')?.addEventListener('input', e => {
                    this.searchQuery = e.target.value;
                    this.renderLibrary();
                });

                if (window.self !== window.top) this.showLauncher();
                else this.runIntro();
            }

            // --- NAVIGATION ---
            showLauncher() { document.getElementById('launcher-layer').classList.remove('hidden', 'opacity-0'); }
            launchApp() { window.open(window.location.href, '_blank'); }

            runIntro() {
                document.getElementById('launcher-layer').classList.add('hidden');
                const cs = document.getElementById('cutscene-layer');
                const logo = document.getElementById('cs-logo');
                
                cs.classList.remove('hidden');
                
                // Jump straight to logo
                setTimeout(() => { 
                    logo.classList.remove('hidden'); 
                    lucide.createIcons(); 
                }, 300);

                setTimeout(() => { 
                    cs.classList.add('animate-slide-up-out'); 
                    this.showMainMenu(); 
                }, 2500);
                
                setTimeout(() => { cs.classList.add('hidden'); }, 3500);
            }

            // --- RESTORED MAIN MENU ---
            showMainMenu() {
                this.previousLayer = 'menu';
                const menu = document.getElementById('menu-layer');
                menu.classList.remove('hidden');
                menu.classList.add('flex');
                
                this.renderMainMenu();
                this.setupMenuTilt();
                lucide.createIcons();
            }

            renderMainMenu() {
                const layer = document.getElementById('menu-layer');
                const heroGame = GAMES.find(g => g.title === "Minecraft 1.12") || GAMES[0];
                const randomGame = GAMES[1] || GAMES[0];
                
                this.menuPreviewData = {
                    games: { isGame: false },
                    featured: { isGame: true, title: heroGame.title, desc: "System Recommendation", img: heroGame.image, tag: "Featured" },
                    random: { isGame: true, title: "Shuffle Protocol", desc: "Launch an unknown process.", img: randomGame.image, tag: "Random" },
                    settings: { isGame: false }
                };

                const html = `
                    <div id="menu-ambient-bg" class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-zinc-900/40 via-black to-black transition-opacity duration-1000 opacity-100">
                        <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCI+CjxyZWN0IHdpZHRoPSI0MCIgaGVpZ2h0PSI0MCIgZmlsbD0ibm9uZSI+PC9yZWN0Pgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjIwIiByPSIxIiBmaWxsPSJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMSkiPjwvY2lyY2xlPgo8L3N2Zz4=')] bg-repeat opacity-30 ${this.settings.ambientBg ? 'animate-ambient-shift' : ''}"></div>
                    </div>
                    
                    <div id="menu-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-700 opacity-0 blur-xl scale-110"></div>
                    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                    
                    <div class="relative z-10 w-full h-full flex flex-col md:flex-row items-center justify-center p-8 md:p-16 lg:p-24 gap-12 lg:gap-24">
                        
                        <!-- Left: Navigation -->
                        <div class="w-full md:w-[45%] flex flex-col justify-center space-y-8 animate-reveal-up">
                            <div class="mb-6">
                                <h1 class="font-display font-extrabold text-6xl md:text-[5.5rem] text-white tracking-tighter leading-[0.85] mb-4">
                                    NOTMINE<span class="text-zinc-600 block md:inline">4REAL</span>
                                </h1>
                                <p class="text-accent font-mono text-sm tracking-[0.4em] uppercase font-bold flex items-center gap-3">
                                    <span class="w-2 h-2 rounded-full bg-accent animate-pulse"></span>
                                    System Online
                                </p>
                            </div>

                            <div class="flex flex-col space-y-1">
                                ${this.createMenuItem('GAMES', 'enterLibrary()', 'games', 'layout-grid')}
                                ${this.createMenuItem('FEATURED', `openViewer('${heroGame.title.replace(/'/g, "\\'")}')`, 'featured', 'star')}
                                ${this.createMenuItem('SHUFFLE', 'playRandomFromMenu()', 'random', 'shuffle')}
                                ${this.createMenuItem('SETTINGS', 'openSettings()', 'settings', 'settings')}
                            </div>
                        </div>

                        <!-- Right: Preview Card Container -->
                        <div class="hidden md:flex w-full md:w-[55%] h-full max-h-[600px] items-center justify-center">
                             <div id="menu-preview-card" class="w-full max-w-xl aspect-video bg-zinc-900 rounded-[2rem] overflow-hidden relative shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-white/10 transition-all duration-700 opacity-0 scale-95 pointer-events-none group perspective-1000">
                                  <img id="menu-preview-img" src="" class="w-full h-full object-cover transition-transform duration-[1.5s] ease-out group-hover:scale-110 opacity-80" />
                                  <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"></div>
                                  <div class="absolute inset-0 border-[1px] border-white/5 rounded-[2rem] pointer-events-none"></div>
                                  
                                  <div class="absolute bottom-0 left-0 p-10 w-full transform transition-transform duration-500 translate-y-4 group-hover:translate-y-0">
                                      <div class="flex items-center justify-between mb-4">
                                          <div id="menu-preview-tag" class="px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white text-xs font-bold uppercase tracking-widest">
                                            Tag
                                          </div>
                                          <div class="w-12 h-12 rounded-full bg-white text-black flex items-center justify-center transform transition-transform duration-300 group-hover:rotate-45 group-hover:scale-110">
                                              <i data-lucide="arrow-up-right" class="w-6 h-6"></i>
                                          </div>
                                      </div>
                                      <h2 id="menu-preview-title" class="font-display font-extrabold text-5xl text-white mb-2 leading-tight drop-shadow-lg">
                                        Title
                                      </h2>
                                      <p id="menu-preview-desc" class="font-sans text-zinc-300 text-lg opacity-80">
                                        Desc
                                      </p>
                                  </div>
                             </div>
                        </div>
                    </div>
                `;
                layer.innerHTML = html;
            }

            createMenuItem(text, action, key, icon) {
                return `
                    <button 
                        onclick="app.${action}" 
                        onmouseenter="app.updateMenuPreview('${key}')"
                        class="group w-full text-left py-6 border-b border-zinc-900 hover:border-zinc-500 transition-colors duration-500 flex items-center justify-between relative overflow-hidden"
                    >
                        <span class="font-display font-bold text-4xl md:text-5xl tracking-tight text-zinc-600 group-hover:text-white transition-colors duration-500 relative z-10">
                            ${text}
                        </span>
                        
                        <div class="flex items-center gap-6 relative z-10 transform translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-500 ease-out">
                            <span class="text-[10px] font-mono text-zinc-500 uppercase tracking-widest hidden lg:block">Execute</span>
                            <div class="w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center group-hover:bg-white group-hover:text-black group-hover:border-white transition-all duration-500">
                                <i data-lucide="${icon}" class="w-5 h-5"></i>
                            </div>
                        </div>
                    </button>
                `;
            }

            updateMenuPreview(key) {
                const data = this.menuPreviewData[key];
                const card = document.getElementById('menu-preview-card');
                const bg = document.getElementById('menu-bg');
                const ambient = document.getElementById('menu-ambient-bg');

                if(!data || !data.isGame) {
                    if(card) {
                        card.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto');
                        card.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                        card.style.transform = 'perspective(1000px) rotateY(0deg) rotateX(0deg) scale3d(0.95, 0.95, 0.95)';
                    }
                    if(bg) bg.style.opacity = '0';
                    if(ambient) ambient.style.opacity = '1';
                    return;
                }

                if(card) {
                    card.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');
                    card.classList.add('opacity-100', 'scale-100', 'pointer-events-auto');
                }
                
                if(bg && data.img) {
                    bg.style.backgroundImage = `url('${data.img}')`;
                    bg.style.opacity = '0.4';
                }
                if(ambient) ambient.style.opacity = '0';

                const img = document.getElementById('menu-preview-img');
                const title = document.getElementById('menu-preview-title');
                const desc = document.getElementById('menu-preview-desc');
                const tag = document.getElementById('menu-preview-tag');

                if(img) img.src = data.img;
                if(title) title.textContent = data.title;
                if(desc) desc.textContent = data.desc;
                if(tag) tag.textContent = data.tag;
            }

            setupMenuTilt() {
                if (this.menuTiltListener) document.removeEventListener('mousemove', this.menuTiltListener);

                this.menuTiltListener = (e) => {
                    const card = document.getElementById('menu-preview-card');
                    if(!card || document.getElementById('menu-layer').classList.contains('hidden') || card.classList.contains('opacity-0')) return;

                    const { clientX, clientY } = e;
                    const { innerWidth, innerHeight } = window;
                    
                    const x = (clientX / innerWidth - 0.5) * 20; 
                    const y = (clientY / innerHeight - 0.5) * 20;

                    card.style.transform = `perspective(1000px) rotateY(${x}deg) rotateX(${-y}deg) scale3d(1.02, 1.02, 1.02)`;
                };

                document.addEventListener('mousemove', this.menuTiltListener);
            }

            enterLibrary() {
                this.previousLayer = 'library';
                const menu = document.getElementById('menu-layer');
                menu.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none');
                
                if (this.menuTiltListener) document.removeEventListener('mousemove', this.menuTiltListener);
                
                setTimeout(() => {
                    menu.classList.add('hidden');
                    const lib = document.getElementById('library-layer');
                    lib.classList.remove('opacity-0', 'pointer-events-none', 'h-0', 'blur-xl');
                    lib.classList.add('opacity-100', 'blur-none', 'pointer-events-auto');
                    this.renderLibrary();
                }, 800);
            }

            // --- LIBRARY ---
            renderLibrary() {
                const filters = document.getElementById('filter-container');
                filters.innerHTML = CATEGORIES.map(cat => `
                    <button onclick="app.setCategory('${cat}')" class="px-6 py-2 rounded-full text-sm font-bold tracking-wide transition-all ${this.activeCategory === cat ? 'bg-white text-black shadow-[0_0_15px_rgba(255,255,255,0.2)]' : 'bg-zinc-900/50 text-zinc-400 hover:bg-zinc-800 border border-zinc-800/50'}">${cat}</button>
                `).join('');

                const grid = document.getElementById('games-grid');
                let games = GAMES;
                if (this.activeCategory === 'Favorites') games = games.filter(g => this.favorites.has(g.title));
                else if (this.activeCategory !== 'All') games = games.filter(g => g.category === this.activeCategory);
                if (this.searchQuery) games = games.filter(g => g.title.toLowerCase().includes(this.searchQuery.toLowerCase()));

                if (games.length === 0) {
                    grid.innerHTML = `<div class="col-span-full py-20 text-center"><h3 class="text-3xl text-zinc-500 font-display font-bold">No Data Found</h3></div>`;
                } else {
                    grid.innerHTML = games.map(g => {
                        const fav = this.favorites.has(g.title);
                        const safeTitle = g.title.replace(/'/g, "\\'");
                        return `
                        <div class="group relative game-card-wrapper h-full flex flex-col cursor-pointer" onclick="app.openViewer('${safeTitle}')">
                            <div class="flex-1 flex flex-col bg-[#0a0a0a] rounded-dynamic border border-white/5 p-3 hover-trigger transition-all duration-300 ${this.settings.hoverFx ? 'hover:border-zinc-600 hover:bg-zinc-900 hover:shadow-[0_15px_30px_rgba(0,0,0,0.8)] hover:-translate-y-2 relative z-0 hover:z-50' : ''}">
                                <div class="w-full aspect-video overflow-hidden rounded-[calc(var(--radius)-0.25rem)] bg-black relative shrink-0">
                                    <img src="${g.image}" class="w-full h-full object-cover transition-transform duration-700 ${this.settings.hoverFx ? 'group-hover:scale-110' : ''}" onerror="this.style.display='none'" />
                                </div>
                                <div class="mt-4 px-1 pb-1 flex-1 flex flex-col justify-between">
                                    <div class="flex items-start justify-between gap-2">
                                        <h3 class="font-display font-bold text-white text-lg leading-tight line-clamp-2">${g.title}</h3>
                                        <button onclick="app.toggleFav('${safeTitle}', event)" class="p-1.5 rounded-md hover:bg-zinc-800 shrink-0">
                                            <i data-lucide="heart" class="w-4 h-4 ${fav ? 'fill-red-500 text-red-500' : 'text-zinc-500'}"></i>
                                        </button>
                                    </div>
                                    <p class="text-[10px] font-mono text-zinc-600 uppercase mt-3">${g.category}</p>
                                </div>
                            </div>
                        </div>`;
                    }).join('');
                }
                lucide.createIcons();
            }

            setCategory(cat) { this.activeCategory = cat; this.renderLibrary(); }
            toggleFav(t, e) { e.stopPropagation(); this.favorites.has(t) ? this.favorites.delete(t) : this.favorites.add(t); localStorage.setItem('nm4r-favorites', JSON.stringify([...this.favorites])); this.renderLibrary(); }
            playRandomFromMenu() { this.enterLibrary(); setTimeout(() => this.playRandom(), 800); }
            playRandom() { const a = GAMES; if(a.length) this.openViewer(a[Math.floor(Math.random()*a.length)].title); }

            // --- FULL PAGE SETTINGS ---
            openSettings() {
                const layer = document.getElementById('settings-layer');
                layer.classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none');
                layer.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto');
                
                if(this.previousLayer === 'menu') document.getElementById('menu-layer').classList.add('hidden');
                if(this.previousLayer === 'library') document.getElementById('library-layer').classList.add('hidden');

                this.renderSettingsNav();
                this.renderSettingsContent();
            }

            closeSettings() {
                const layer = document.getElementById('settings-layer');
                layer.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none');
                layer.classList.remove('opacity-100', 'scale-100');
                
                setTimeout(() => {
                    layer.classList.add('hidden');
                    layer.classList.remove('flex');
                    if(this.previousLayer === 'menu') {
                        document.getElementById('menu-layer').classList.remove('hidden');
                        document.getElementById('menu-layer').classList.add('flex');
                    }
                    if(this.previousLayer === 'library') document.getElementById('library-layer').classList.remove('hidden');
                }, 700);
            }

            renderSettingsNav() {
                const nav = document.getElementById('settings-nav');
                const cats = ['Design', 'Cursor', 'Text', 'Site', 'Security', 'Themes'];
                nav.innerHTML = cats.map(c => `
                    <button onclick="app.activeSettingsTab='${c}'; app.renderSettingsContent();" class="text-left px-5 py-4 rounded-xl font-bold font-display transition-all ${this.activeSettingsTab === c ? 'bg-zinc-800 text-white shadow-md' : 'text-zinc-500 hover:text-white hover:bg-zinc-900'}">
                        ${c}
                    </button>
                `).join('');
            }

            renderSettingsContent() {
                this.renderSettingsNav();
                document.getElementById('settings-cat-title').textContent = this.activeSettingsTab;
                
                const grid = document.getElementById('settings-options-grid');
                let optionsHtml = '';
                
                const createRow = (title, type, key, extras) => {
                    const val = this.settings[key];
                    let control = '';
                    
                    if(type === 'toggle') {
                        control = `
                        <button onclick="app.updateSetting('${key}', ${!val})" class="w-12 h-6 rounded-full relative transition-colors duration-300 ${val ? 'bg-accent shadow-[0_0_10px_var(--accent)]' : 'bg-black border border-zinc-700'} shrink-0 focus:outline-none">
                            <div class="absolute top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 ${val ? 'translate-x-7' : 'translate-x-1'}"></div>
                        </button>`;
                    } else if (type === 'action') {
                        const isActive = extras.match === val;
                        control = `<button onclick="app.updateSetting('${key}', '${extras.match}')" class="px-4 py-2 rounded-lg text-sm font-bold ${isActive ? 'bg-white text-black' : 'bg-zinc-800 text-zinc-400 hover:bg-zinc-700'} transition-colors">${extras.label}</button>`;
                    } else if (type === 'input') {
                        control = `<input type="text" value="${val}" onchange="app.updateSetting('${key}', this.value)" placeholder="${extras.ph}" class="w-full mt-3 bg-black border border-zinc-800 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-zinc-500 font-mono">`;
                    } else if (type === 'button') {
                        control = `<button onclick="${extras.onClick}" class="px-4 py-2 rounded-lg text-sm font-bold ${extras.danger ? 'bg-red-900/50 text-red-500 hover:bg-red-800 hover:text-white' : 'bg-zinc-800 text-white hover:bg-zinc-700'} transition-colors">${extras.label}</button>`;
                    }

                    return `
                    <div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-5 flex flex-col justify-center">
                        <div class="flex items-center justify-between gap-4">
                            <span class="text-base font-medium text-zinc-200">${title}</span>
                            ${type !== 'input' ? control : ''}
                        </div>
                        ${type === 'input' ? control : ''}
                    </div>`;
                };

                // Exactly 10 options per category
                if(this.activeSettingsTab === 'Design') {
                    document.getElementById('settings-cat-desc').textContent = "Visual architecture and layout structure.";
                    optionsHtml = [
                        createRow("Performance Mode", "toggle", "perfMode"),
                        createRow("OLED Black Mode", "toggle", "oledMode"),
                        createRow("Compact UI Grid", "toggle", "compactUI"),
                        createRow("Glassmorphism FX", "toggle", "glassmorphism"),
                        createRow("Corners: Sharp", "action", "borderRadius", {match: '0px', label: 'Select'}),
                        createRow("Corners: Normal", "action", "borderRadius", {match: '1rem', label: 'Select'}),
                        createRow("Corners: Pill", "action", "borderRadius", {match: '2rem', label: 'Select'}),
                        createRow("Grid Gap Size", "action", "gridGap", {match: '2.5rem', label: 'Large'}),
                        createRow("Ambient Animations", "toggle", "ambientBg"),
                        createRow("Card Hover Lift", "toggle", "hoverFx")
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Cursor') {
                    document.getElementById('settings-cat-desc').textContent = "System pointer overrides.";
                    optionsHtml = [
                        createRow("System Default", "action", "cursorStyle", {match: 'default', label: 'Apply'}),
                        createRow("Crosshair Target", "action", "cursorStyle", {match: 'crosshair', label: 'Apply'}),
                        createRow("Data Cell", "action", "cursorStyle", {match: 'cell', label: 'Apply'}),
                        createRow("Text Select", "action", "cursorStyle", {match: 'text', label: 'Apply'}),
                        createRow("Help / Query", "action", "cursorStyle", {match: 'help', label: 'Apply'}),
                        createRow("Move / Pan", "action", "cursorStyle", {match: 'move', label: 'Apply'}),
                        createRow("Not Allowed", "action", "cursorStyle", {match: 'not-allowed', label: 'Apply'}),
                        createRow("Wait / Loading", "action", "cursorStyle", {match: 'wait', label: 'Apply'}),
                        createRow("Grab / Hand", "action", "cursorStyle", {match: 'grab', label: 'Apply'}),
                        createRow("Zoom In", "action", "cursorStyle", {match: 'zoom-in', label: 'Apply'})
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Text') {
                    document.getElementById('settings-cat-desc').textContent = "Typographic control variables.";
                    optionsHtml = [
                        createRow("Font: Outfit (Sans)", "action", "fontBase", {match: 'Outfit', label: 'Set Base'}),
                        createRow("Font: Grotesk (Display)", "action", "fontHead", {match: 'Space Grotesk', label: 'Set Head'}),
                        createRow("Font: JetBrains (Mono)", "action", "fontBase", {match: 'JetBrains Mono', label: 'Set Base'}),
                        createRow("Font: Playfair (Serif)", "action", "fontBase", {match: 'Playfair Display', label: 'Set Base'}),
                        createRow("Font: Pixel 8-Bit", "action", "fontHead", {match: '"Press Start 2P"', label: 'Set Head'}),
                        createRow("Size: Small", "action", "textSize", {match: '14px', label: 'Apply'}),
                        createRow("Size: Normal", "action", "textSize", {match: '16px', label: 'Apply'}),
                        createRow("Size: Large", "action", "textSize", {match: '18px', label: 'Apply'}),
                        createRow("Tracking: Tighter", "action", "textTracking", {match: '-0.05em', label: 'Apply'}),
                        createRow("Tracking: Wider", "action", "textTracking", {match: '0.1em', label: 'Apply'})
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Site') {
                    document.getElementById('settings-cat-desc').textContent = "Environment disguises and masking.";
                    optionsHtml = [
                        createRow("Disguise: Google", "button", "", {onClick: "app.setCloakPreset('Google', 'https://www.google.com/favicon.ico')", label: 'Apply'}),
                        createRow("Disguise: Classroom", "button", "", {onClick: "app.setCloakPreset('Classes', 'https://ssl.gstatic.com/classroom/favicon.png')", label: 'Apply'}),
                        createRow("Disguise: Drive", "button", "", {onClick: "app.setCloakPreset('My Drive', 'https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png')", label: 'Apply'}),
                        createRow("Disguise: Default", "button", "", {onClick: "app.setCloakPreset('NOTMINE4REAL', '')", label: 'Reset'}),
                        createRow("Custom Tab Title", "input", "tabTitle", {ph: 'Enter title...'}),
                        createRow("Custom Favicon URL", "input", "tabIcon", {ph: 'https://...'}),
                        createRow("Panic Redirect URL", "input", "panicUrl", {ph: 'https://...'}),
                        createRow("Open in About:Blank", "button", "", {onClick: "app.cloak()", label: 'Execute'}),
                        createRow("Auto-Pause on Blur", "toggle", "autoPauseBlur"),
                        createRow("Mute on Blur", "toggle", "muteBlur")
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Security') {
                    document.getElementById('settings-cat-desc').textContent = "Active defensive countermeasures.";
                    optionsHtml = [
                        createRow("Panic Keybind", "input", "panicKey", {ph: 'e.g. ` or Esc'}),
                        createRow("Blur Window on Leave", "toggle", "blurLeave"),
                        createRow("Disable Right Click", "toggle", "noRightClick"),
                        createRow("Disable Inspect (F12)", "toggle", "noDevTools"),
                        createRow("Ask Before Closing Tab", "toggle", "askClose"),
                        createRow("Hide Browser History", "toggle", "hideHistory"),
                        createRow("Password Lock Boot", "toggle", "passLock"),
                        createRow("Set Access PIN", "input", "passPin", {ph: 'Numeric PIN'}),
                        createRow("Nuclear Self Destruct", "button", "", {onClick: "app.selfDestruct()", label: 'NUKE', danger: true}),
                        createRow("Factory Reset System", "button", "", {onClick: "app.resetData()", label: 'RESET', danger: true})
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Themes') {
                    document.getElementById('settings-cat-desc').textContent = "Core system coloration.";
                    const hexes = ['#8b5cf6', '#22c55e', '#ef4444', '#3b82f6', '#f97316', '#eab308', '#ec4899', '#06b6d4', '#ffffff'];
                    optionsHtml = hexes.map((hex, i) => `
                        <div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-5 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-6 h-6 rounded-full" style="background-color: ${hex}"></div>
                                <span class="text-base font-medium text-zinc-200">Color Variant 0${i+1}</span>
                            </div>
                            <button onclick="app.updateSetting('accentColor', '${hex}')" class="px-4 py-2 rounded-lg text-sm font-bold ${this.settings.accentColor === hex ? 'bg-white text-black' : 'bg-zinc-800 text-zinc-400'} transition-colors">Select</button>
                        </div>
                    `).join('');
                    
                    optionsHtml += createRow("Custom Hex Accent", "input", "accentColor", {ph: '#RRGGBB'});
                }

                grid.innerHTML = optionsHtml;
            }

            updateSetting(key, val) {
                this.settings[key] = val;
                localStorage.setItem('nm4r-settings', JSON.stringify(this.settings));
                this.applySettings();
                this.renderSettingsContent(); 
            }

            setCloakPreset(title, icon) {
                this.settings.tabTitle = title;
                this.settings.tabIcon = icon;
                this.updateSetting('tabTitle', title);
            }

            applySettings() {
                const s = this.settings;
                const root = document.documentElement;
                
                root.style.setProperty('--accent', s.accentColor);
                root.style.setProperty('--font-base', s.fontBase);
                root.style.setProperty('--font-head', s.fontHead);
                root.style.setProperty('--text-size', s.textSize);
                root.style.setProperty('--tracking', s.textTracking);
                root.style.setProperty('--radius', s.borderRadius);
                root.style.setProperty('--grid-gap', s.gridGap);
                root.style.setProperty('--custom-cursor', s.cursorStyle);

                const setCls = (c, act) => act ? document.body.classList.add(c) : document.body.classList.remove(c);
                setCls('perf-mode', s.perfMode);
                setCls('oled-mode', s.oledMode);
                setCls('compact-ui', s.compactUI);
                setCls('hide-scroll', s.hideScroll);
                setCls('no-hover-fx', !s.hoverFx);
                setCls('cursor-override', s.cursorStyle !== 'default');

                if(!s.glassmorphism) setCls('perf-mode', true);

                document.title = s.tabTitle || 'NOTMINE4REAL';
                let link = document.querySelector("link[rel*='icon']") || document.createElement('link');
                link.type = 'image/x-icon'; link.rel = 'shortcut icon';
                link.href = s.tabIcon || document.getElementById('app-favicon').src || "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'><path d='M12 2L21 7V17L12 22L3 17V7L12 2Z' /><path d='M12 6L17 9V15L12 18L7 15V9L12 6' /></svg>";
                document.head.appendChild(link);
            }

            setupSecurity() {
                if(this.settings.passLock && this.settings.passPin && !sessionStorage.getItem('nm4r-unlocked')) {
                    const pass = prompt("SYSTEM LOCKED. Enter Access PIN:");
                    if(pass === this.settings.passPin) {
                        sessionStorage.setItem('nm4r-unlocked', 'true');
                    } else {
                        document.body.innerHTML = '<div style="background:black;color:red;height:100vh;display:flex;align-items:center;justify-content:center;font-family:monospace;font-size:2rem;">ACCESS DENIED</div>';
                        return;
                    }
                }

                document.addEventListener('keydown', e => {
                    if (e.key === this.settings.panicKey) { e.preventDefault(); this.panic(); }
                    if (this.settings.noDevTools) {
                        if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I')) e.preventDefault();
                    }
                });

                document.addEventListener('contextmenu', e => {
                    if(this.settings.noRightClick) e.preventDefault();
                });

                window.addEventListener('beforeunload', e => {
                    if(this.settings.askClose) { e.preventDefault(); e.returnValue = ''; }
                });

                window.addEventListener('blur', () => {
                    if(this.settings.blurLeave) {
                        document.body.classList.add('blur-locked');
                        document.getElementById('blur-overlay').classList.remove('hidden');
                        setTimeout(()=>document.getElementById('blur-overlay').classList.remove('opacity-0'), 10);
                    }
                    if(this.settings.autoPauseBlur && this.currentGame) {
                        const frame = document.getElementById('game-frame');
                        this.cachedSrc = frame.src;
                        frame.src = ''; 
                    }
                });

                window.addEventListener('focus', () => {
                    if(this.settings.blurLeave) {
                        document.body.classList.remove('blur-locked');
                        const over = document.getElementById('blur-overlay');
                        over.classList.add('opacity-0');
                        setTimeout(()=>over.classList.add('hidden'), 300);
                    }
                    if(this.settings.autoPauseBlur && this.currentGame && this.cachedSrc) {
                        document.getElementById('game-frame').src = this.cachedSrc;
                    }
                });

                if(this.settings.hideHistory) {
                    try { window.history.replaceState(null, null, '/'); } catch(e){}
                }
            }

            // --- SYSTEM ACTIONS ---
            resetData() {
                if(confirm("SYSTEM RESET: Erase all preferences and favorites?")) {
                    localStorage.removeItem('nm4r-settings');
                    localStorage.removeItem('nm4r-favorites');
                    window.location.reload();
                }
            }

            selfDestruct() {
                if(!confirm("WARNING: SYSTEM INSTABILITY IMMINENT. PROCEED?")) return;
                document.body.innerHTML = '<div class="flex items-center justify-center w-full h-screen bg-red-900"><h1 class="text-6xl font-black font-mono animate-pulse">SYSTEM NUKED</h1></div>';
                setTimeout(() => window.location.reload(), 2000);
            }

            panic() {
                let url = this.settings.panicUrl;
                if (!url.startsWith('http')) url = 'https://' + url;
                window.location.replace(url);
            }
            
            cloak() {
                const win = window.open('about:blank', '_blank');
                if (win) {
                    const iframe = win.document.createElement('iframe');
                    iframe.src = window.location.href;
                    iframe.style.cssText = 'width:100%;height:100%;border:none;position:fixed;top:0;left:0;margin:0;';
                    win.document.body.style.margin = '0';
                    win.document.body.appendChild(iframe);
                    window.location.replace('https://www.google.com');
                }
            }

            // --- VIEWER ---
            openViewer(gameTitle) {
                const game = GAMES.find(g => g.title === gameTitle);
                if (!game) return;
                this.currentGame = game;
                
                document.getElementById('viewer-title').textContent = game.title;
                document.getElementById('viewer-category').textContent = game.category;
                document.getElementById('viewer-bg').style.backgroundImage = `url(${game.image})`;
                
                const lib = document.getElementById('library-layer');
                if (lib && !lib.classList.contains('hidden')) {
                    lib.classList.add('opacity-0', 'scale-95', 'pointer-events-none');
                }

                const viewer = document.getElementById('viewer-layer');
                viewer.classList.remove('hidden', 'opacity-0', 'scale-[1.02]', 'pointer-events-none');
                viewer.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto');
                
                document.getElementById('game-frame').src = game.url;
            }

            closeViewer() {
                const viewer = document.getElementById('viewer-layer');
                viewer.classList.remove('flex', 'opacity-100', 'scale-100', 'pointer-events-auto');
                viewer.classList.add('opacity-0', 'scale-[1.02]', 'pointer-events-none');
                
                const lib = document.getElementById('library-layer');
                if (lib) lib.classList.remove('opacity-0', 'scale-95', 'pointer-events-none');

                setTimeout(() => {
                    viewer.classList.add('hidden');
                    document.getElementById('game-frame').src = '';
                }, 700);
                this.currentGame = null;
            }

            toggleFullscreen() {
                const el = document.getElementById('game-container');
                if (!document.fullscreenElement) el.requestFullscreen().catch(e => console.log(e));
                else document.exitFullscreen();
            }
        }

        const app = new App();
    </script>
</body>
</html>
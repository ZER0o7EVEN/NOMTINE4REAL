<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NOTMINE4REAL</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'><path d='M12 2L21 7V17L12 22L3 17V7L12 2Z' /><path d='M12 6L17 9V15L12 18L7 15V9L12 6' /></svg>" id="app-favicon" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Playfair+Display:wght@400;700&family=Press+Start+2P&family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet" />
    
    <!-- Tailwind CSS & Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: { sans: ['var(--font-base)', 'sans-serif'], display: ['var(--font-head)', 'sans-serif'], mono: ['var(--font-mono)', 'monospace'], },
            colors: { accent: 'var(--accent)', 'accent-dark': 'var(--accent-dark)', 'bg-primary': 'var(--bg-primary)', 'bg-secondary': 'var(--bg-secondary)', 'text-primary': 'var(--text-primary)', 'text-secondary': 'var(--text-secondary)' },
            animation: { 'reveal-up': 'revealUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards', 'fade-in': 'fadeIn 0.8s ease-out forwards', 'float': 'float 6s ease-in-out infinite', 'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'slide-up-out': 'slideUpOut 0.8s cubic-bezier(0.7, 0, 0.3, 1) forwards', 'border-beam': 'borderBeam 5s infinite linear', 'spin-slow': 'spin 10s linear infinite', 'float-away': 'floatAway 5s ease-in forwards'},
            keyframes: { revealUp: { '0%': { transform: 'translateY(30px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }, fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }, float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }, slideUpOut: { '0%': { transform: 'translateY(0)', opacity: '1' }, '100%': { transform: 'translateY(-100%)', opacity: '0' } }, borderBeam: { '0%': { 'transform': 'translateX(-100%)' }, '100%': { 'transform': 'translateX(100%)' } }, floatAway: { '0%': { transform: 'translateY(0)', opacity: 1 }, '100%': { transform: 'translateY(-200vh)', opacity: 0 } } }
          }
        }
      }
    </script>
    <style>
      :root { --accent: #a78bfa; --accent-dark: #7c3aed; --bg-primary: #000000; --bg-secondary: #0A0A0A; --text-primary: #f4f4f5; --text-secondary: #a1a1aa; --font-base: 'Outfit', sans-serif; --font-head: 'Space Grotesk', sans-serif; --font-mono: 'JetBrains Mono', monospace; --text-size: 16px; --tracking: normal; --radius: 1.25rem; --grid-gap: 1.5rem; }
      body { background-color: var(--bg-primary); color: var(--text-primary); overflow-x: hidden; transition: background-color 0.5s ease; font-size: var(--text-size); letter-spacing: var(--tracking); font-family: var(--font-base); background-image: radial-gradient(circle at 25% 25%, rgba(124, 58, 237, 0.1), transparent 35%), radial-gradient(circle at 75% 75%, rgba(124, 58, 237, 0.08), transparent 35%); }
      body.theme-nord { --bg-primary: #2E3440; --bg-secondary: #3B4252; --accent: #88C0D0; --text-primary: #ECEFF4; --text-secondary: #D8DEE9; }
      body.theme-solarized { --bg-primary: #002b36; --bg-secondary: #073642; --accent: #268bd2; --text-primary: #839496; --text-secondary: #586e75; }
      body.theme-terminal { --bg-primary: #000000; --bg-secondary: #0A0A0A; --accent: #00FF00; --text-primary: #00FF00; --text-secondary: #00C000; font-family: 'Roboto Mono', monospace !important; }
      body.no-animations * { animation: none !important; transition: none !important; }
      
      ::-webkit-scrollbar { width: 6px; height: 6px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; } ::-webkit-scrollbar-thumb:hover { background: #52525b; }
      .glass-panel { background: rgba(5, 5, 5, 0.6); backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.05); }
      .scrollbar-hide::-webkit-scrollbar { display: none; } .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      .text-accent { color: var(--accent) !important; } .bg-accent { background-color: var(--accent) !important; } .border-accent { border-color: var(--accent) !important; } .group:hover .group-hover\:text-accent { color: var(--accent) !important; } .rounded-dynamic { border-radius: var(--radius) !important; }
      body.perf-mode .glass-panel, body.perf-mode .backdrop-blur-xl { backdrop-filter: none !important; background-color: #0a0a0a !important; }
      body.compact-ui #games-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)) !important; }
      body.blur-locked > *:not(#blur-overlay):not(#admin-alert-modal) { filter: blur(20px); pointer-events: none; user-select: none; }
      #bg-canvas.hidden { display: none; }
      
      .gradient-text { background: linear-gradient(to right, var(--accent), #d8b4fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
      .game-card-wrapper { position: relative; }
      .game-card-wrapper::before { content: ""; position: absolute; inset: 0; border-radius: var(--radius); padding: 2px; background: linear-gradient(45deg, var(--accent-dark), var(--accent)); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity: 0; transition: opacity 0.3s; }
      .game-card-wrapper:hover::before { opacity: 1; }
      
      /* GLOBAL MODES CSS */
      body.matrix-mode { background: #000 !important; color: #0f0 !important; font-family: 'JetBrains Mono', monospace !important; }
      body.matrix-mode *:not(i) { border-color: #0f0 !important; color: #0f0 !important; font-family: 'JetBrains Mono', monospace !important; }
      body.matrix-mode .bg-accent, body.matrix-mode .bg-zinc-900 { background-color: #001100 !important; }
      body.matrix-mode img, body.matrix-mode svg { filter: grayscale(100%) sepia(100%) hue-rotate(90deg) saturate(500%) !important; }
      body.grayscale-mode { filter: grayscale(100%); }
      body.blur-mode > *:not(#admin-layer):not(#owner-layer) { filter: blur(5px); }
      body.invert-scroll-mode { overflow: hidden; } /* JS will handle scroll reversal */
      
      @keyframes hue-rotate-anim { from { filter: hue-rotate(0deg); } to { filter: hue-rotate(360deg); } }
      body.rainbow-mode { animation: hue-rotate-anim 3s linear infinite !important; }
      
      @keyframes shake-anim { 0%, 100% {transform: translate(0,0) rotate(0);} 10% {transform: translate(-1px, -2px) rotate(-0.5deg);} 20% {transform: translate(1px, 2px) rotate(0.5deg);} 30% {transform: translate(-1px, 1px) rotate(0);} 40% {transform: translate(1px, -1px) rotate(0.5deg);} 50% {transform: translate(-1px, 2px) rotate(-0.5deg);} }
      body.earthquake-mode { animation: shake-anim 0.2s infinite !important; }

      @keyframes fall-anim { to { transform: translateY(120vh) rotate(360deg); } }
      .falling-brainrot { position: fixed; top: -50px; font-size: 3rem; user-select: none; pointer-events: none; z-index: 99999; animation: fall-anim linear forwards; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
      
      .jumpscare-overlay, .screaming-cowboy-overlay { position: fixed; inset: 0; z-index: 999999; display: flex; align-items: center; justify-content: center; pointer-events: none; }
      .jumpscare-overlay { animation: flash-red 0.1s infinite; background-color: rgba(0,0,0,0.9); }
      .jumpscare-img, .screaming-cowboy-img { width: 100%; height: 100%; object-fit: cover; }
      .jumpscare-img { mix-blend-mode: multiply; transform: scale(1.5); }
      
      body.rotate-mode { transform: rotate(180deg); transition: transform 0.5s ease; }
      body.spin-mode { animation: spin 2s linear infinite; }
      body.invert-mode { filter: invert(1); }
      @keyframes glitch-anim { 0% { transform: translate(0); } 20% { transform: translate(-3px, 3px); } 40% { transform: translate(3px, -3px); } 60% { transform: translate(-3px, -3px); } 80% { transform: translate(3px, 3px); } 100% { transform: translate(0); } }
      body.glitch-mode::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: black; z-index: 9999; pointer-events: none; animation: glitch-anim .1s infinite linear alternate-reverse; opacity: .05; }
      body.glitch-mode { animation: shake-anim 0.1s infinite !important; }
      
      body.cursor-troll * { cursor: none !important; }
      .fake-cursor { position: fixed; width: 20px; height: 20px; background: red; border-radius: 50%; pointer-events: none; z-index: 999999; transform: translate(-50%, -50%); transition: transform 0.1s ease-out; }

      .float-away-mode > div:not(#admin-layer):not(#owner-layer) { animation: floatAway 10s ease-in forwards !important; }
      body.hide-ui-mode #library-nav, body.hide-ui-mode #hero-section, body.hide-ui-mode #filter-container, body.hide-ui-mode #games-grid { opacity: 0 !important; pointer-events: none !important; transition: opacity 0.5s !important;}

      /* Custom Audio Player Styles */
      .audio-player { display: flex; align-items: center; gap: 8px; max-width: 250px; }
      .audio-player button { background: rgba(255,255,255,0.1); border: none; border-radius: 50%; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: white; flex-shrink: 0; }
      .audio-player .progress-bar { flex-grow: 1; background: rgba(255,255,255,0.1); height: 4px; border-radius: 2px; overflow: hidden; }
      .audio-player .progress { background: white; height: 100%; width: 0; }
    </style>
</head>
<body class="antialiased min-h-screen bg-black text-white selection:bg-zinc-800 selection:text-white relative">

    <canvas id="bg-canvas"></canvas>

    <!-- Global Audio Players for Admin Commands -->
    <audio id="siren-audio" loop src="https://www.myinstants.com/media/sounds/air-raid-siren.mp3" preload="auto"></audio>
    <audio id="cowboy-audio" src="https://www.myinstants.com/media/sounds/big-enough-meme-remix.mp3" preload="auto"></audio>

    <div id="blur-overlay" onclick="this.classList.add('hidden')" class="fixed inset-0 z-[9999] bg-black/95 flex flex-col items-center justify-center hidden opacity-0 transition-opacity duration-300 cursor-pointer">
        <i data-lucide="lock" class="w-16 h-16 text-zinc-500 mb-6"></i>
        <h1 class="text-4xl font-display font-bold tracking-widest text-white mb-2">SYSTEM LOCKED</h1>
        <p class="font-mono text-zinc-500 text-sm">Administrator has locked your terminal.</p>
        <p class="font-mono text-zinc-600 text-[10px] mt-4">Click to attempt unlock</p>
    </div>

    <!-- CUSTOM ADMIN ALERT MODAL -->
    <div id="admin-alert-modal" class="fixed inset-0 z-[10000] bg-black/80 backdrop-blur-xl hidden items-center justify-center opacity-0 transition-opacity duration-300 pointer-events-auto">
        <div class="bg-[#0a0a0a] border border-accent/30 p-10 rounded-[2rem] shadow-2xl max-w-lg w-full text-center relative overflow-hidden animate-reveal-up">
            <div class="w-20 h-20 bg-accent/10 border-2 border-accent/20 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_40px_var(--accent)]">
                <i data-lucide="megaphone" class="w-10 h-10 text-accent"></i>
            </div>
            <h2 class="text-3xl font-display font-black text-white mb-2 uppercase tracking-widest">System Message</h2>
            <p id="admin-alert-message" class="text-zinc-300 font-sans text-lg mb-8 px-4">Admin message content goes here.</p>
            <button onclick="app.hideAdminAlertGUI()" class="w-full max-w-xs mx-auto py-3 bg-white text-black font-bold uppercase tracking-wider rounded-xl hover:bg-zinc-300 transition-colors">Acknowledge</button>
        </div>
    </div>

    <div id="launcher-layer" class="fixed inset-0 z-[200] flex flex-col items-center justify-center bg-black/80 backdrop-blur-md hidden animate-fade-in pointer-events-auto">
        <div class="text-center animate-reveal-up max-w-md px-6">
             <div class="mb-10 relative group cursor-pointer" onclick="app.launchApp()">
                <div class="absolute inset-0 bg-white/10 rounded-full blur-2xl group-hover:blur-3xl transition-all duration-700 opacity-0 group-hover:opacity-100"></div>
                <button class="relative px-12 py-6 bg-black border border-zinc-700/50 rounded-full text-2xl font-display font-extrabold text-white group-hover:bg-white group-hover:text-black transition-all duration-500 shadow-2xl flex items-center justify-center gap-4 w-full transform group-hover:scale-105">
                    <i data-lucide="power" class="w-6 h-6"></i><span>INITIALIZE</span>
                </button>
             </div>
             <button onclick="app.runIntro()" class="text-zinc-600 hover:text-white text-[10px] uppercase tracking-wider underline decoration-zinc-800 transition-all duration-300">Run in current window</button>
        </div>
    </div>

    <!-- Account Auth Modal -->
    <div id="auth-modal" class="fixed inset-0 z-[9999] bg-black/95 backdrop-blur-xl flex flex-col items-center justify-center pointer-events-auto transition-opacity duration-500 hidden opacity-0">
        <div class="bg-[#0a0a0a] border border-white/10 p-10 rounded-[2rem] shadow-2xl max-w-md w-full text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-accent-dark to-accent"></div>
            <h3 class="font-display text-4xl font-black text-white mb-2">Cloud Account</h3>
            <p class="text-zinc-400 font-sans text-sm mb-8">Create an account or login to access Chat and Cloud features.</p>
            <form onsubmit="accountSystem.authenticate(event)" class="flex flex-col gap-4">
                <input type="text" id="auth-user" required maxlength="20" placeholder="Username" autocomplete="off" class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-accent transition-colors font-bold">
                <input type="password" id="auth-pass" required placeholder="Password / PIN" autocomplete="off" class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-accent transition-colors font-bold mb-2">
                <button type="submit" id="auth-btn" class="w-full py-4 bg-accent text-white font-black uppercase tracking-widest rounded-xl hover:bg-accent/80 transition-colors shadow-[0_0_20px_var(--accent)]">Login / Create</button>
                <button type="button" onclick="document.getElementById('auth-modal').classList.add('opacity-0', 'pointer-events-none'); setTimeout(()=>document.getElementById('auth-modal').classList.add('hidden'), 500);" class="text-zinc-500 hover:text-white text-xs underline mt-2">Cancel</button>
            </form>
        </div>
    </div>

    <div id="cutscene-layer" class="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center overflow-hidden hidden pointer-events-none">
        <div id="cs-logo" class="relative z-10 text-center hidden">
            <div class="inline-flex items-center justify-center w-24 h-24 bg-zinc-900 rounded-3xl mb-10 shadow-2xl border border-zinc-800 animate-pop-in">
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 text-white"><path d="M12 2L21 7V17L12 22L3 17V7L12 2Z" /><path d="M12 6L17 9V15L12 18L7 15V9L12 6" /></svg>
            </div>
            <h1 class="font-display text-5xl md:text-8xl font-black tracking-tighter text-white animate-reveal-up leading-none">NOTMINE<span class="text-zinc-600">4REAL</span></h1>
        </div>
    </div>

    <div id="menu-layer" class="fixed inset-0 z-40 bg-transparent hidden flex-col transition-all duration-1000 overflow-hidden pointer-events-auto"></div>

    <div id="team-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-white/5 shrink-0 pointer-events-auto">
            <button onclick="app.closeTeam()" class="flex items-center gap-3 px-4 py-2 bg-white text-black rounded-full font-bold font-display hover:bg-zinc-200 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> Back</button>
            <h2 class="font-display font-black text-3xl tracking-tight text-white">System Team</h2>
            <div class="w-24"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10 pointer-events-auto flex flex-col items-center pt-20">
            <div class="mb-16 w-full max-w-2xl">
                <div class="text-center mb-8"><span class="text-accent font-mono text-sm tracking-[0.3em] font-bold uppercase mb-2 block">Creator & Lead Developer</span></div>
                <div class="bg-[#0a0a0a] border-2 owner-card-glow rounded-3xl p-10 flex flex-col items-center text-center transform transition-transform hover:scale-105 duration-500 relative overflow-hidden">
                    <div class="absolute inset-0 bg-accent/5 pointer-events-none"></div>
                    <div class="w-24 h-24 bg-accent rounded-full flex items-center justify-center mb-6 shadow-[0_0_30px_var(--accent)] relative z-10 text-white"><i data-lucide="crown" class="w-12 h-12"></i></div>
                    <h3 class="text-5xl font-display font-black text-white mb-2 relative z-10">Jessie Cook</h3>
                    <p class="text-accent font-sans text-3xl font-black tracking-[0.4em] mt-2 relative z-10 drop-shadow-lg">KING</p>
                </div>
            </div>
            <div class="w-full max-w-4xl border-t border-white/5 pt-16 text-center">
                <span class="text-zinc-500 font-mono text-sm tracking-[0.3em] font-bold uppercase mb-8 block">Administrators</span>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 opacity-50">
                    <div class="bg-[#0a0a0a] border border-white/5 rounded-2xl p-8 flex flex-col items-center border-dashed"><div class="w-16 h-16 bg-zinc-900 rounded-full flex items-center justify-center mb-4 text-zinc-600"><i data-lucide="user" class="w-8 h-8"></i></div><h4 class="text-xl font-bold text-zinc-500 mb-1">Vacant</h4><p class="text-xs font-mono text-zinc-600">No admin assigned</p></div>
                </div>
            </div>
        </div>
    </div>

    <div id="partners-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-900/20 via-black to-black pointer-events-none"></div>
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-orange-500/20 shrink-0 pointer-events-auto">
            <button onclick="app.closePartners()" class="flex items-center gap-3 px-4 py-2 bg-orange-500 text-black rounded-full font-bold font-display hover:bg-orange-400 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> Back</button>
            <h2 class="font-display font-black text-3xl tracking-tight text-orange-500">Official Partners</h2>
            <div class="w-24"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10 pointer-events-auto flex items-center justify-center">
            <div class="grid grid-cols-1 max-w-4xl w-full">
                <a href="https://engineeringdesign.publicvm.com/" target="_blank" class="group relative bg-black border border-orange-500/30 rounded-3xl p-8 hover:border-orange-500 hover:shadow-[0_0_50px_rgba(249,115,22,0.2)] transition-all duration-500 flex flex-col md:flex-row items-center gap-8 overflow-hidden cursor-pointer">
                    <div class="absolute inset-0 bg-gradient-to-r from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                    <div class="w-48 h-48 shrink-0 bg-zinc-900/50 rounded-2xl p-4 flex items-center justify-center border border-orange-500/20 group-hover:scale-105 transition-transform duration-500">
                        <img src="https://raw.githubusercontent.com/NoahsAmazingTutoringHelp/reimagined-octo-winner/refs/heads/main/my%20logos/small_trans.png" alt="Noah's Tutoring Hub" class="w-full h-full object-contain drop-shadow-[0_0_15px_rgba(249,115,22,0.3)]" />
                    </div>
                    <div class="flex-1 text-center md:text-left relative z-10">
                        <div class="inline-block px-3 py-1 bg-orange-500/10 border border-orange-500/30 text-orange-500 text-[10px] font-mono font-bold uppercase tracking-widest rounded-full mb-4">Verified Network Partner</div>
                        <h3 class="text-4xl font-display font-black text-white mb-2 group-hover:text-orange-400 transition-colors">Noah's Tutoring Hub</h3>
                        <p class="text-zinc-400 font-sans text-lg mb-6 leading-relaxed">Top-tier academic assistance and unblocked resources. Joining forces to provide the ultimate student experience across the web.</p>
                        <span class="text-orange-500 font-bold flex items-center justify-center md:justify-start gap-2 group-hover:translate-x-2 transition-transform">Visit Hub <i data-lucide="arrow-right" class="w-5 h-5"></i></span>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- HELP LAYER -->
    <div id="help-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-white/5 shrink-0 pointer-events-auto">
            <button onclick="app.closeHelp()" class="flex items-center gap-3 px-4 py-2 bg-white text-black rounded-full font-bold font-display hover:bg-zinc-200 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> Back</button>
            <h2 class="font-display font-black text-3xl tracking-tight text-white">Help & Support</h2>
            <div class="w-24"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10 pointer-events-auto flex justify-center">
            <div class="max-w-4xl w-full text-zinc-300 space-y-8">
                <div>
                    <h3 class="font-display text-3xl font-bold text-white mb-4">Frequently Asked Questions</h3>
                    <div class="space-y-4">
                        <div class="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                            <h4 class="font-bold text-white">How do I save my favorite games?</h4>
                            <p class="text-sm text-zinc-400 mt-1">Click the heart icon on any game card in the library. To see all your favorites, select the "Favorites" category filter.</p>
                        </div>
                        <div class="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                            <h4 class="font-bold text-white">How does the site cloak / panic button work?</h4>
                            <p class="text-sm text-zinc-400 mt-1">Go to Settings > Site to set a custom tab title and icon. Go to Settings > Security to set a custom panic key and redirect URL. Pressing the panic key will instantly redirect your tab to the specified URL.</p>
                        </div>
                         <div class="bg-zinc-900/50 p-4 rounded-xl border border-zinc-800">
                            <h4 class="font-bold text-white">How do I change my profile picture?</h4>
                            <p class="text-sm text-zinc-400 mt-1">Go to Settings > Account. Hover over the profile picture and click the camera icon to upload a new image. Don't forget to click "Sync Now" to save it to the cloud.</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="font-display text-3xl font-bold text-white mb-4">Contact</h3>
                     <p class="text-zinc-400">If you are experiencing a persistent issue or have a security concern, please contact the system administrator, Jessie Cook.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME REQUEST LAYER -->
    <div id="request-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-white/5 shrink-0 pointer-events-auto">
            <button onclick="app.closeRequests()" class="flex items-center gap-3 px-4 py-2 bg-white text-black rounded-full font-bold font-display hover:bg-zinc-200 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> Back</button>
            <h2 class="font-display font-black text-3xl tracking-tight text-white">Request a Game</h2>
            <div class="w-24"></div>
        </div>
        <div class="flex-1 overflow-y-auto p-6 md:p-10 relative z-10 pointer-events-auto flex items-center justify-center">
            <div class="max-w-xl w-full bg-zinc-900/30 border border-zinc-800 rounded-2xl p-8">
                <h3 class="text-2xl font-bold text-white mb-2">Submit your request</h3>
                <p class="text-zinc-400 text-sm mb-6">Found a game you'd like to see added? Fill out the form below. All submissions are reviewed.</p>
                <form onsubmit="app.submitGameRequest(event)" class="flex flex-col gap-4">
                    <input type="text" id="request-title" required placeholder="Game Title" class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-accent transition-colors font-sans">
                    <input type="url" id="request-url" placeholder="Link to game (optional)" class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-accent transition-colors font-sans">
                    <button type="submit" class="w-full py-3 bg-accent text-white font-black uppercase tracking-widest rounded-xl hover:bg-accent/80 transition-colors mt-2">Submit Request</button>
                </form>
            </div>
        </div>
    </div>


    <div id="library-layer" class="min-h-screen bg-transparent transition-all duration-700 ease-[cubic-bezier(0.16,1,0.3,1)] opacity-0 pointer-events-none h-0 overflow-hidden blur-xl transform origin-top">
        <nav class="sticky top-0 z-50 w-full pt-6 px-6 pb-4 transition-transform duration-500 bg-transparent" id="library-nav">
            <div class="max-w-7xl mx-auto flex items-center justify-between gap-6 pointer-events-auto">
                <div class="flex items-center gap-4 cursor-pointer group shrink-0" onclick="location.reload()">
                    <div class="w-12 h-12 bg-zinc-900 border border-zinc-800 rounded-dynamic flex items-center justify-center transform group-hover:rotate-[15deg] group-hover:scale-110 transition-all duration-300 relative overflow-hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="w-6 h-6 text-white relative z-10"><path d="M12 2L21 7V17L12 22L3 17V7L12 2Z"/><path d="M12 6L17 9V15L12 18L7 15V9L12 6"/></svg>
                    </div>
                    <div class="flex flex-col leading-none">
                        <h1 class="font-display font-extrabold text-2xl tracking-tight text-white">NOTMINE</h1>
                        <span class="text-[10px] font-mono font-bold text-zinc-500 tracking-[0.3em] group-hover:text-white transition-colors mt-1 gradient-text">4REAL</span>
                    </div>
                </div>
                <div class="flex items-center gap-1.5 shrink-0 bg-zinc-900/60 backdrop-blur-xl border border-zinc-800/80 p-1.5 rounded-full shadow-xl">
                    <button onclick="app.playRandom()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all" title="Random Game"><i data-lucide="shuffle" class="w-5 h-5"></i></button>
                    <button onclick="app.openChat()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all relative group" title="Chat"><i data-lucide="message-square" class="w-5 h-5"></i><span id="nav-chat-badge" class="absolute top-2 right-2 w-2.5 h-2.5 bg-accent rounded-full hidden border border-[#0a0a0a]"></span></button>
                    <button onclick="app.toggleNotifications()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all relative group" title="Notifications"><i data-lucide="bell" class="w-5 h-5"></i><span id="notif-badge" class="absolute top-2 right-2 w-2.5 h-2.5 bg-red-500 rounded-full hidden border border-[#0a0a0a]"></span></button>
                    <button onclick="app.cloak()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all" title="Cloak Tab"><i data-lucide="eye-off" class="w-5 h-5"></i></button>
                    <button onclick="app.openSettings()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-full transition-all" title="Settings"><i data-lucide="settings" class="w-5 h-5"></i></button>
                </div>
            </div>
        </nav>
        <!-- NOTIFICATION PANEL -->
        <div id="notification-panel" class="fixed top-24 right-6 z-40 w-full max-w-sm bg-zinc-900/80 backdrop-blur-2xl border border-zinc-800 rounded-2xl shadow-2xl hidden opacity-0 transition-all duration-300 transform origin-top-right scale-95 pointer-events-auto">
            <div class="p-4 border-b border-zinc-800 flex items-center justify-between">
                <h3 class="font-bold text-white">Notifications</h3>
                <button onclick="app.clearNotifications()" class="text-xs text-zinc-500 hover:text-white transition-colors">Clear All</button>
            </div>
            <div id="notification-list" class="p-2 max-h-96 overflow-y-auto scrollbar-hide">
                <!-- Notifications will be injected here -->
            </div>
        </div>

        <main class="max-w-7xl mx-auto px-6 pt-2 pb-6 min-h-screen pointer-events-auto relative z-10">
            <div id="hero-section" class="flex flex-col items-center justify-center pt-8 pb-10 text-center animate-reveal-up">
                <h1 class="font-display font-black text-5xl md:text-6xl text-white tracking-tighter mb-4 drop-shadow-2xl">Games Library</h1>
                <p class="text-zinc-400 font-sans text-base mb-6 max-w-xl mx-auto">Explore our extensive collection. Click any game to start playing immediately.</p>
                <div class="relative w-full max-w-2xl group animate-float">
                    <div class="absolute inset-0 bg-accent/20 rounded-full blur-xl group-hover:bg-accent/30 transition-all duration-500 opacity-50"></div>
                    <div class="relative flex items-center bg-zinc-900/80 backdrop-blur-md border border-white/10 rounded-full p-2 shadow-2xl transition-all duration-300 focus-within:border-accent/50 focus-within:bg-black">
                        <div class="pl-4 pr-3 text-zinc-500 group-focus-within:text-white transition-colors"><i data-lucide="search" class="w-6 h-6"></i></div>
                        <input type="text" id="search-input" placeholder="Search for a game..." class="w-full bg-transparent border-none py-3 text-lg text-white placeholder-zinc-600 focus:outline-none font-sans" autocomplete="off">
                    </div>
                </div>
                <p id="game-counter" class="text-zinc-600 font-mono text-xs mt-6 uppercase tracking-[0.2em] font-bold">Loading Database...</p>
            </div>
            <div class="flex flex-wrap items-center justify-center gap-2 mb-12 scrollbar-hide overflow-x-auto pb-2" id="filter-container"></div>
            <div id="games-grid" class="grid gap-x-6 gap-y-12 pb-32 transition-all duration-300" style="grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: var(--grid-gap);"></div>
        </main>
    </div>

    <!-- ADMIN LOGIN MODAL -->
    <div id="admin-login-modal" class="fixed inset-0 z-[300] bg-black/90 backdrop-blur-xl hidden flex-col items-center justify-center pointer-events-auto">
        <div class="text-center w-full max-w-sm">
            <div class="w-20 h-20 bg-red-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_40px_rgba(220,38,38,0.6)]"><i data-lucide="shield-alert" class="w-10 h-10 text-white"></i></div>
            <h2 class="text-3xl font-display font-black text-white mb-2 uppercase tracking-widest">Admin Access</h2>
            <p class="text-zinc-500 font-mono text-xs mb-8">SECURE SYSTEM // AUTHORIZED PERSONNEL ONLY</p>
            <input type="password" id="admin-password-input" placeholder="ENTER PASSCODE" class="w-full bg-black border-2 border-zinc-800 rounded-xl px-4 py-4 text-center text-xl text-white tracking-[0.5em] focus:outline-none focus:border-red-600 focus:shadow-[0_0_20px_rgba(220,38,38,0.4)] transition-all mb-4 font-mono">
            <button onclick="adminSystem.verify()" class="w-full py-4 bg-white text-black font-bold uppercase tracking-wider rounded-xl hover:bg-zinc-300 transition-colors">Authenticate</button>
            <button onclick="adminSystem.closeLogin()" class="mt-6 text-zinc-600 hover:text-white text-xs underline">Cancel</button>
        </div>
    </div>
    
    <!-- ADMIN PANEL (FULL SCREEN) -->
    <div id="admin-layer" class="fixed inset-0 z-[250] bg-[#0c0c0c] hidden flex-col transition-all duration-300 overflow-hidden pointer-events-auto">
        <div class="h-20 border-b border-red-900/30 flex items-center justify-between px-8 bg-black shrink-0">
            <div class="flex items-center gap-4"><div class="w-3 h-3 bg-red-600 rounded-full animate-pulse"></div><h2 class="font-mono font-bold text-red-600 text-xl tracking-widest uppercase">Command Center</h2></div>
            <div class="flex items-center gap-4">
                <select id="admin-user-select" onchange="document.getElementById('admin-target-user').value = this.value" class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white focus:border-red-500 focus:outline-none w-48"><option value="">All Users</option></select>
                <input type="text" id="admin-target-user" placeholder="Or type username..." class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white focus:border-red-500 focus:outline-none w-48">
                <button onclick="adminSystem.closePanel('admin-layer')" class="px-4 py-2 border border-zinc-800 text-zinc-400 hover:text-white hover:border-white rounded text-xs font-mono uppercase">Exit</button>
            </div>
        </div>
        <div class="flex-1 flex overflow-hidden">
            <div id="admin-nav" class="w-64 bg-black/50 border-r border-red-900/20 p-6 shrink-0 hidden md:block">
                <div class="flex flex-col gap-2">
                    <button onclick="adminSystem.switchTab('commands', 'admin')" class="admin-tab-btn text-left px-4 py-3 rounded-xl font-bold text-sm bg-red-900/20 text-white border border-red-900/30">Global Commands</button>
                </div>
            </div>
            <div class="flex-1 p-10 overflow-y-auto">
                <div id="admin-tab-content-commands" class="admin-tab-content">
                    <div class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="col-span-full mb-4"><h3 class="text-zinc-500 text-sm font-mono uppercase tracking-widest border-b border-zinc-800 pb-2">Global Modes</h3></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">System Lock</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('system_lock')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('system_unlock')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Matrix Mode</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('matrix_mode_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('matrix_mode_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Rainbow Mode</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('rainbow_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('rainbow_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Brainrot Mode</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('brainrot_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('brainrot_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Spin Mode</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_spin_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_spin_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Float Away</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_float_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_float_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Grayscale</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('grayscale_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('grayscale_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                        <div class="bg-zinc-900/30 border border-zinc-800 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white">Blur UI</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('blur_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('blur_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>

                        <div class="col-span-full mt-4 mb-4"><h3 class="text-zinc-500 text-sm font-mono uppercase tracking-widest border-b border-zinc-800 pb-2">Instant Actions</h3></div>
                        <button onclick="adminSystem.sendCustomAlert()" class="p-6 border border-zinc-800 bg-zinc-900/30 hover:bg-zinc-800 hover:border-zinc-600 rounded-xl text-left transition-all group"><i data-lucide="megaphone" class="w-8 h-8 text-yellow-500 mb-4"></i><h3 class="text-xl font-bold text-white mb-1">Custom Alert</h3><p class="text-zinc-500 text-xs font-mono">Send popup.</p></button>
                        <button onclick="adminSystem.sendCommand('force_reload')" class="p-6 border border-zinc-800 bg-zinc-900/30 hover:bg-zinc-800 hover:border-zinc-600 rounded-xl text-left transition-all group"><i data-lucide="refresh-cw" class="w-8 h-8 text-blue-500 mb-4"></i><h3 class="text-xl font-bold text-white mb-1">Force Refresh</h3><p class="text-zinc-500 text-xs font-mono">Reload browsers.</p></button>
                        <button onclick="adminSystem.sendCommand('force_logout')" class="p-6 border border-zinc-800 bg-zinc-900/30 hover:bg-zinc-800 hover:border-zinc-600 rounded-xl text-left transition-all group"><i data-lucide="log-out" class="w-8 h-8 text-orange-500 mb-4"></i><h3 class="text-xl font-bold text-white mb-1">Force Logout</h3><p class="text-zinc-500 text-xs font-mono">Log out a user.</p></button>
                        <button onclick="adminSystem.sendCommand('mute_user')" class="p-6 border border-zinc-800 bg-zinc-900/30 hover:bg-zinc-800 hover:border-zinc-600 rounded-xl text-left transition-all group"><i data-lucide="mic-off" class="w-8 h-8 text-pink-500 mb-4"></i><h3 class="text-xl font-bold text-white mb-1">Mute User</h3><p class="text-zinc-500 text-xs font-mono">Silence in global chat.</p></button>
                        <button onclick="adminSystem.sendCommand('unmute_user')" class="p-6 border border-zinc-800 bg-zinc-900/30 hover:bg-zinc-800 hover:border-zinc-600 rounded-xl text-left transition-all group"><i data-lucide="mic" class="w-8 h-8 text-green-500 mb-4"></i><h3 class="text-xl font-bold text-white mb-1">Unmute User</h3><p class="text-zinc-500 text-xs font-mono">Unsilence in global.</p></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OWNER PANEL (FULL SCREEN - INSANELY OVERPOWERED) -->
    <div id="owner-layer" class="fixed inset-0 z-[260] bg-[#0c0900] hidden flex-col transition-all duration-300 overflow-hidden pointer-events-auto">
        <div class="h-20 border-b border-yellow-500/30 flex items-center justify-between px-8 bg-black shrink-0">
            <div class="flex items-center gap-4"><i data-lucide="crown" class="w-6 h-6 text-yellow-500 animate-pulse"></i><h2 class="font-mono font-black text-yellow-500 text-2xl tracking-[0.3em] uppercase drop-shadow-md">Owner Override</h2></div>
            <div class="flex items-center gap-4">
                <select id="owner-user-select" onchange="document.getElementById('owner-target-user').value = this.value" class="bg-zinc-900 border border-yellow-900/50 rounded-lg px-3 py-2 text-sm text-yellow-500 focus:border-yellow-500 focus:outline-none w-48 placeholder-yellow-900"><option value="">All Users</option></select>
                <input type="text" id="owner-target-user" placeholder="Or type username..." class="bg-zinc-900 border border-yellow-900/50 rounded-lg px-3 py-2 text-sm text-yellow-500 focus:border-yellow-500 focus:outline-none w-48 placeholder-yellow-900">
                <button onclick="adminSystem.closePanel('owner-layer')" class="px-4 py-2 border border-zinc-800 text-zinc-400 hover:text-white hover:border-white rounded text-xs font-mono uppercase">Exit</button>
            </div>
        </div>
        <div class="flex-1 flex overflow-hidden">
            <div id="owner-nav" class="w-64 bg-black/50 border-r border-yellow-900/20 p-6 shrink-0 hidden md:block">
                <div class="flex flex-col gap-2">
                    <button onclick="adminSystem.switchTab('commands', 'owner')" class="owner-tab-btn text-left px-4 py-3 rounded-xl font-bold text-sm bg-yellow-900/20 text-white border border-yellow-900/30">Commands</button>
                    <!-- Game Requests tab will be added here by JS if user is 'Owner' -->
                </div>
            </div>
            <div class="flex-1 p-10 overflow-y-auto">
                <div id="owner-tab-content-commands" class="owner-tab-content">
                    <div class="max-w-6xl mx-auto space-y-12">
                        <div>
                            <h3 class="text-yellow-500/50 text-sm font-mono uppercase tracking-widest border-b border-yellow-500/20 pb-3 mb-6">Troll Modes</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="activity" class="w-5 h-5 text-orange-500"></i>Earthquake</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_earthquake_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_earthquake_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="rotate-cw" class="w-5 h-5 text-cyan-500"></i>Rotate Screen</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_rotate_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_rotate_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="sun" class="w-5 h-5 text-white"></i>Invert Colors</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_invert_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_invert_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="bug" class="w-5 h-5 text-green-500"></i>Glitch Effect</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_glitch_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_glitch_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="mouse-pointer-2" class="w-5 h-5 text-purple-500"></i>Fake Cursor</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_fake_cursor_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_fake_cursor_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="volume-x" class="w-5 h-5 text-red-400"></i>Global Siren</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_siren_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_siren_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="wrap-text" class="w-5 h-5 text-lime-400"></i>Gibberish</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('text_gibberish_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('text_gibberish_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="arrow-down-up" class="w-5 h-5 text-teal-400"></i>Invert Scroll</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('invert_scroll_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('invert_scroll_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-yellow-500/50 text-sm font-mono uppercase tracking-widest border-b border-yellow-500/20 pb-3 mb-6">UI & System Disruption</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <button onclick="adminSystem.sendCommand('owner_jumpscare')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="ghost" class="w-8 h-8 text-red-500 mb-4"></i><h3 class="text-lg font-bold text-white">Jumpscare</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_flashbang')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="zap" class="w-8 h-8 text-yellow-200 mb-4"></i><h3 class="text-lg font-bold text-white">Flashbang</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_cowboy')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="user" class="w-8 h-8 text-yellow-600 mb-4"></i><h3 class="text-lg font-bold text-white">Cowboy</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_spam_alerts')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="alert-octagon" class="w-8 h-8 text-yellow-500 mb-4"></i><h3 class="text-lg font-bold text-white">Spam Alerts</h3></button>
                                <button onclick="adminSystem.sendCommand('play_all_sounds')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="volume-2" class="w-8 h-8 text-rose-400 mb-4"></i><h3 class="text-lg font-bold text-white">Cacophony</h3></button>
                                <div class="bg-black border border-yellow-900/50 rounded-xl p-5 flex items-center justify-between col-span-1"><span class="font-bold text-white flex items-center gap-3"><i data-lucide="eye-off" class="w-5 h-5 text-blue-400"></i>Hide UI</span><div class="flex gap-2"><button onclick="adminSystem.sendCommand('owner_hide_ui_on')" class="px-3 py-1 bg-zinc-800 hover:bg-green-500 text-xs rounded transition-colors">ON</button><button onclick="adminSystem.sendCommand('owner_hide_ui_off')" class="px-3 py-1 bg-zinc-800 hover:bg-red-500 text-xs rounded transition-colors">OFF</button></div></div>
                                <button onclick="adminSystem.sendCommand('owner_random_theme')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="palette" class="w-8 h-8 text-pink-400 mb-4"></i><h3 class="text-lg font-bold text-white">Random Theme</h3></button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-yellow-500/50 text-sm font-mono uppercase tracking-widest border-b border-yellow-500/20 pb-3 mb-6">User Management & Destructive Actions</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                <button onclick="adminSystem.banUser()" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="ban" class="w-8 h-8 text-red-500 mb-4"></i><h3 class="text-lg font-bold text-white">Ban User</h3></button>
                                <button onclick="adminSystem.unbanUser()" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="shield-check" class="w-8 h-8 text-green-500 mb-4"></i><h3 class="text-lg font-bold text-white">Unban User</h3></button>
                                <button onclick="adminSystem.promoteUser()" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="user-plus" class="w-8 h-8 text-blue-400 mb-4"></i><h3 class="text-lg font-bold text-white">Promote Admin</h3></button>
                                <button onclick="adminSystem.demoteUser()" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="user-minus" class="w-8 h-8 text-orange-400 mb-4"></i><h3 class="text-lg font-bold text-white">Demote Admin</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_kick')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="log-out" class="w-8 h-8 text-pink-500 mb-4"></i><h3 class="text-lg font-bold text-white">Kick User</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_wipe_pfp')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="image-off" class="w-8 h-8 text-zinc-400 mb-4"></i><h3 class="text-lg font-bold text-white">Wipe PFP</h3></button>
                                <button onclick="adminSystem.resetUserSettings()" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="settings-2" class="w-8 h-8 text-cyan-400 mb-4"></i><h3 class="text-lg font-bold text-white">Reset Settings</h3></button>
                                <button onclick="adminSystem.sendCommand('owner_shutdown')" class="p-6 border border-yellow-900/50 bg-black hover:bg-yellow-900/20 hover:border-yellow-500 rounded-xl text-left transition-all group"><i data-lucide="power-off" class="w-8 h-8 text-zinc-500 mb-4"></i><h3 class="text-lg font-bold text-white">Client Shutdown</h3></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="owner-tab-content-requests" class="hidden owner-tab-content">
                    <h3 class="text-3xl font-bold mb-6 text-yellow-300">Game Requests</h3>
                    <div id="game-requests-list" class="space-y-4">
                        <p class="text-zinc-500">Loading requests...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- CHAT UI -->
    <div id="image-viewer-modal" class="fixed inset-0 z-[200] bg-black/90 backdrop-blur-lg flex items-center justify-center hidden opacity-0 transition-opacity duration-300" onclick="globalChat.hideImageModal()">
        <img id="image-viewer-img" src="" class="max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl">
        <button class="absolute top-6 right-6 text-white/50 hover:text-white transition-colors"><i data-lucide="x" class="w-8 h-8"></i></button>
    </div>

    <div id="chat-layer" class="fixed inset-0 z-[150] bg-[#0A0A0A] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="relative z-20 flex items-center justify-between px-6 h-20 bg-[#121212]/50 backdrop-blur-xl border-b border-white/5 shrink-0 pointer-events-auto">
            <button onclick="app.closeChat()" class="flex items-center gap-2 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 rounded-full font-bold transition-colors"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</button>
            <h2 class="font-display font-black text-xl text-white tracking-wide">Chat Room</h2>
            <div class="w-20"></div>
        </div>
        
        <div id="add-modal" class="absolute inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden items-center justify-center opacity-0 transition-opacity duration-300 pointer-events-auto">
            <div class="bg-zinc-900 border border-zinc-700 p-6 rounded-2xl w-full max-w-md shadow-2xl relative">
                <button onclick="globalChat.closeAddModal()" class="absolute top-4 right-4 text-zinc-500 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                <h3 id="add-modal-title" class="text-xl font-bold text-white mb-4">Add Friend</h3>
                <div class="relative">
                    <input type="text" id="add-modal-input" oninput="globalChat.handleAutocomplete(event)" placeholder="Search Username..." class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white mb-4 focus:outline-none focus:border-accent relative z-10">
                    <div id="autocomplete-dropdown" class="absolute top-full left-0 w-full bg-zinc-800 border border-zinc-700 rounded-xl mt-1 hidden shadow-2xl max-h-40 overflow-y-auto z-50"></div>
                </div>
                <p id="add-modal-error" class="text-accent text-sm hidden mb-4"></p>
                <button onclick="globalChat.confirmAdd()" class="w-full py-3 bg-white text-black font-bold rounded-xl hover:bg-zinc-200 transition-colors">Confirm</button>
            </div>
        </div>

        <div id="friend-request-modal" class="absolute inset-0 z-[65] bg-black/80 backdrop-blur-sm hidden items-center justify-center opacity-0 transition-opacity duration-300 pointer-events-auto">
            <div class="bg-zinc-900 border border-zinc-700 p-8 rounded-2xl w-full max-w-sm shadow-2xl text-center">
                <div class="w-16 h-16 bg-accent rounded-full flex items-center justify-center mx-auto mb-4 text-white"><i data-lucide="user-plus" class="w-8 h-8"></i></div>
                <h3 class="text-2xl font-black text-white mb-2">Friend Request</h3>
                <p id="friend-request-name" class="text-zinc-400 mb-6">User wants to be friends!</p>
                <div class="flex gap-4">
                    <button onclick="globalChat.declineFriendRequest()" class="flex-1 py-3 bg-zinc-800 hover:bg-red-500 hover:text-white text-zinc-300 font-bold rounded-xl transition-colors">Decline</button>
                    <button onclick="globalChat.acceptFriendRequest()" class="flex-1 py-3 bg-white text-black font-bold rounded-xl hover:bg-zinc-200 transition-colors">Accept</button>
                </div>
            </div>
        </div>
        <div id="incoming-call-modal" class="absolute inset-0 z-[70] bg-black/90 backdrop-blur-md hidden items-center justify-center opacity-0 transition-opacity duration-300 pointer-events-auto">
            <div class="text-center">
                <div class="w-24 h-24 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse-fast border-4 border-accent" id="incoming-call-icon-box"><i data-lucide="phone" class="w-10 h-10 text-white animate-bounce" id="incoming-call-icon"></i></div>
                <h3 class="text-3xl font-display font-black text-white mb-2" id="incoming-call-type-title">Incoming Call</h3>
                <p id="incoming-caller-name" class="text-zinc-400 text-lg mb-8">User is calling you...</p>
                <div class="flex items-center justify-center gap-6">
                    <button onclick="globalChat.declineCall()" class="w-16 h-16 bg-red-500 text-white rounded-full flex items-center justify-center hover:scale-110 transition-transform shadow-[0_0_20px_rgba(239,68,68,0.5)]"><i data-lucide="phone-off" class="w-6 h-6"></i></button>
                    <button onclick="globalChat.acceptCall()" class="w-16 h-16 bg-green-500 text-white rounded-full flex items-center justify-center hover:scale-110 transition-transform shadow-[0_0_20px_rgba(34,197,94,0.5)]"><i data-lucide="phone" class="w-6 h-6" id="incoming-accept-icon"></i></button>
                </div>
            </div>
        </div>
        <div id="active-call-bar" class="absolute top-20 left-0 right-0 z-30 bg-green-600/90 backdrop-blur-sm hidden items-center justify-between px-6 py-2 border-b border-green-500 shadow-lg pointer-events-auto">
            <div class="flex items-center gap-3"><i data-lucide="phone-call" class="w-5 h-5 text-white animate-pulse"></i><span class="text-white font-bold text-sm">Voice Call Active <span id="active-call-name" class="opacity-80 ml-1"></span></span></div>
            <div class="flex items-center gap-3">
                <button onclick="globalChat.toggleAudio()" class="p-1.5 bg-black/20 hover:bg-black/40 rounded-full text-white transition-colors"><i data-lucide="mic" class="w-4 h-4 call-mic-icon"></i></button>
                <button onclick="globalChat.endCall()" class="px-4 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-full transition-colors shadow-lg">Hang Up</button>
            </div>
        </div>
        <audio id="remote-audio" autoplay hidden></audio>
        <audio id="ringtone-audio" loop preload="auto" hidden src="https://cdn.pixabay.com/audio/2022/01/18/audio_d0a13f69d2.mp3"></audio>

        <div class="flex-1 flex overflow-hidden relative z-10 bg-black pointer-events-auto">
            <div class="w-72 border-r border-white/5 bg-[#121212] flex flex-col shrink-0">
                <div class="p-4 border-b border-white/5"><div class="flex items-center gap-3 bg-zinc-900 px-3 py-2 rounded-xl">
                    <div class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center font-bold text-sm" id="sidebar-user-initial">?</div>
                    <img id="sidebar-pfp" class="w-8 h-8 rounded-full object-cover hidden">
                    <span class="font-bold text-white text-sm truncate" id="sidebar-username">Not Logged In</span>
                </div></div>
                <div class="flex-1 overflow-y-auto p-3 space-y-6 scrollbar-hide">
                    <div><button onclick="globalChat.switchChannel('global', 'Global Chat')" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors group channel-btn active-channel" data-id="global"><i data-lucide="globe" class="w-5 h-5 text-zinc-400 group-hover:text-white"></i><span class="font-bold text-zinc-300 group-hover:text-white">Global Room</span></button></div>
                    <div><div class="flex items-center justify-between px-2 mb-2"><span class="text-[10px] font-bold text-zinc-500 uppercase tracking-wider">Friends</span><button onclick="globalChat.openAddModal('friend')" class="text-zinc-500 hover:text-white transition-colors"><i data-lucide="plus" class="w-4 h-4"></i></button></div><div id="friends-list" class="space-y-1"></div></div>
                    <div><div class="flex items-center justify-between px-2 mb-2"><span class="text-[10px] font-bold text-zinc-500 uppercase tracking-wider">Groups</span><button onclick="globalChat.openAddModal('group')" class="text-zinc-500 hover:text-white transition-colors"><i data-lucide="plus" class="w-4 h-4"></i></button></div><div id="groups-list" class="space-y-1"></div></div>
                </div>
            </div>
            <div class="flex-1 flex flex-col bg-[#0A0A0A] relative">
                <div class="h-16 border-b border-white/5 flex items-center justify-between px-6 bg-transparent shrink-0">
                    <div class="flex items-center gap-2"><i data-lucide="hash" class="w-4 h-4 text-zinc-500"></i><span class="font-bold text-white" id="current-room-name">Global Chat</span></div>
                    <div id="call-controls-container" class="hidden flex items-center gap-2">
                        <button onclick="globalChat.initiateCall(false)" class="p-2 bg-zinc-800 hover:bg-accent hover:text-white text-zinc-300 rounded-lg transition-colors" title="Voice Call"><i data-lucide="phone" class="w-4 h-4"></i></button>
                        <button onclick="globalChat.initiateCall(true)" class="p-2 bg-zinc-800 hover:bg-accent hover:text-white text-zinc-300 rounded-lg transition-colors" title="Video Call"><i data-lucide="video" class="w-4 h-4"></i></button>
                    </div>
                </div>
                <div id="video-call-ui" class="absolute inset-0 z-[40] bg-black hidden flex-col border-l border-white/5 pointer-events-auto">
                    <video id="remote-video" class="w-full h-full object-cover" autoplay playsinline></video>
                    <video id="local-video" class="absolute bottom-6 right-6 w-48 h-auto bg-zinc-900 border-2 border-white/10 rounded-xl shadow-2xl object-cover transform scale-x-[-1]" autoplay muted playsinline></video>
                    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 flex items-center gap-6 bg-black/60 backdrop-blur-md px-6 py-3 rounded-full border border-white/10 shadow-2xl">
                        <button onclick="globalChat.toggleAudio()" class="w-12 h-12 bg-zinc-700 hover:bg-zinc-600 rounded-full flex items-center justify-center text-white transition-colors shadow-lg"><i data-lucide="mic" class="w-5 h-5 call-mic-icon"></i></button>
                        <button onclick="globalChat.toggleVideo()" class="w-12 h-12 bg-zinc-700 hover:bg-zinc-600 rounded-full flex items-center justify-center text-white transition-colors shadow-lg"><i data-lucide="video" class="w-5 h-5 call-vid-icon"></i></button>
                        <button onclick="globalChat.endCall()" class="w-14 h-14 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white transition-colors shadow-lg ml-2"><i data-lucide="phone-off" class="w-6 h-6"></i></button>
                    </div>
                </div>
                
                <div id="chat-messages" class="flex-1 overflow-y-auto p-6 flex flex-col gap-6 scrollbar-hide relative z-10"></div>
                
                <div class="p-4 bg-transparent border-t border-white/5 relative z-10 flex flex-col">
                    <div id="reply-preview" class="hidden flex items-center justify-between bg-zinc-900 border-l-4 border-accent px-4 py-2 mb-3 rounded-r-lg shadow-inner">
                        <div class="truncate text-sm text-zinc-400 max-w-[80%]">Replying to <span id="reply-preview-user" class="font-bold text-white"></span>: <span id="reply-preview-text" class="italic"></span></div>
                        <button onclick="globalChat.cancelReply()" class="text-zinc-500 hover:text-white"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <form id="chat-form" class="flex items-center gap-3">
                        <button type="button" id="chat-img-btn" onclick="document.getElementById('chat-img-upload').click()" class="p-3 bg-zinc-800 text-zinc-400 hover:text-white hover:bg-zinc-700 rounded-xl transition-colors hidden" title="Send Image">
                            <i data-lucide="image" class="w-5 h-5"></i>
                        </button>
                        <input type="file" id="chat-img-upload" accept="image/*" class="hidden" onchange="globalChat.handleImageUpload(event)">
                        
                        <input type="text" id="chat-input" class="flex-1 bg-zinc-900 border border-zinc-800 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-zinc-500 transition-colors disabled:opacity-50" placeholder="Type a message..." autocomplete="off" disabled>
                        <button type="button" id="voice-note-btn" class="p-3 bg-zinc-800 text-zinc-400 rounded-xl transition-colors hidden"><i data-lucide="mic" class="w-5 h-5"></i></button>
                        <button type="submit" id="chat-submit-btn" class="p-3 bg-accent text-white rounded-xl hover:bg-accent/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled><i data-lucide="send" class="w-5 h-5"></i></button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- SETTINGS LAYER -->
    <div id="settings-layer" class="fixed inset-0 z-[150] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.05] pointer-events-none overflow-hidden">
        <div class="relative z-20 flex items-center justify-between px-8 h-20 glass-panel border-b border-white/5 shrink-0 pointer-events-auto">
            <div class="flex items-center gap-6">
                <button onclick="app.closeSettings()" class="flex items-center gap-3 px-4 py-2 bg-white text-black rounded-full font-bold font-display hover:bg-zinc-200 transition-colors"><i data-lucide="arrow-left" class="w-5 h-5"></i> Back</button>
                <div class="h-8 w-[1px] bg-zinc-800"></div><h2 class="font-display font-black text-3xl tracking-tight text-white">Settings</h2>
            </div>
        </div>
        <div class="flex flex-1 overflow-hidden relative z-10 pointer-events-auto">
            <div class="w-72 bg-[#080808] border-r border-white/5 flex flex-col p-6 space-y-2 overflow-y-auto scrollbar-hide shrink-0" id="settings-nav"></div>
            <div class="flex-1 bg-black overflow-y-auto scrollbar-hide relative p-10">
                <div class="max-w-4xl mx-auto"><div class="mb-10"><h3 id="settings-cat-title" class="text-5xl font-display font-black text-white tracking-tighter mb-2">Category</h3></div><div id="settings-options-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4 pb-20"></div></div>
            </div>
        </div>
    </div>

    <!-- VIEWER LAYER -->
    <div id="viewer-layer" class="fixed inset-0 z-[100] bg-[#050505] hidden flex-col transition-all duration-700 opacity-0 scale-[1.02] pointer-events-none">
        <div id="viewer-bg" class="absolute inset-0 opacity-15 pointer-events-none blur-[100px] scale-110 bg-cover bg-center transition-opacity"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-black via-black/95 to-black/80 pointer-events-none"></div>
        <div class="relative z-10 flex items-center justify-between px-6 h-16 glass-panel border-b border-white/5 pointer-events-auto">
            <div class="flex items-center gap-4">
                <button onclick="app.closeViewer()" class="p-2 hover:bg-zinc-800/50 rounded-lg transition-colors group"><i data-lucide="arrow-left" class="w-5 h-5 text-zinc-400 group-hover:text-white"></i></button>
                <div class="h-6 w-[1px] bg-zinc-800"></div>
                <div><h2 id="viewer-title" class="font-display font-bold text-white text-lg leading-none tracking-tight">Title</h2><p id="viewer-category" class="text-[11px] text-zinc-500 font-mono tracking-widest uppercase mt-1">Category</p></div>
            </div>
            <div class="flex items-center gap-2">
                <button onclick="app.panic()" class="flex items-center gap-2 px-4 py-1.5 bg-zinc-900 hover:bg-white hover:text-black text-zinc-400 text-xs font-bold tracking-widest uppercase rounded-lg transition-colors border border-zinc-800"><i data-lucide="alert-triangle" class="w-3 h-3"></i> PANIC</button>
                <button onclick="app.toggleFullscreen()" class="p-2.5 text-zinc-400 hover:text-white hover:bg-zinc-800/50 rounded-lg transition-all"><i id="fullscreen-icon" data-lucide="maximize" class="w-5 h-5"></i></button>
            </div>
        </div>
        <div class="flex-1 relative flex items-center justify-center p-4 md:p-8 overflow-hidden pointer-events-auto">
            <div id="game-container" class="relative w-full h-full max-w-[1600px] max-h-[900px] bg-[#0a0a0a] rounded-dynamic overflow-hidden shadow-[0_0_60px_rgba(0,0,0,0.8)] border border-zinc-800/80">
                <iframe id="game-frame" class="w-full h-full border-0 rounded-dynamic" allowfullscreen></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL DATABASE INIT ---
        let db = null;
        try {
            const firebaseConfig = {
              apiKey: "AIzaSyDKqhSa-fFT-R8DGWeGq0tFsuHySTto2NU",
              authDomain: "notminechat-71bd0.firebaseapp.com",
              databaseURL: "https://notminechat-71bd0-default-rtdb.firebaseio.com",
              projectId: "notminechat-71bd0",
              storageBucket: "notminechat-71bd0.firebasestorage.app",
              messagingSenderId: "446821268917",
              appId: "1:446821268917:web:181c7ad0e0b4241b02adfc"
            };
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
        } catch(e) { console.error("Firebase Error: ", e); }

        var _GAMES = [
            ["Proxy", "https://d1ks901xvjj2p6.cloudfront.net/index.html#/search", "https://tse1.mm.bing.net/th/id/OIP.jZphni_Ys5sEP7nbPzZfLQHaFl?o=7rm=3&rs=1&pid=ImgDetMain&o=7&rm=3", "Utility"],
            ["Cloud Gaming", "https://th.bing.com/th/id/OIP.kOFzpwfkS0fVQh8cKaiHbQHaHa?w=108&h=108&c=1&bgcl=76c541&r=0&o=7&dpr=1.1&pid=ImgRC&rm=3", "Utility"],
            ["Ultimate Custom Night", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0ed522122460b64053fcb0f9e96ab2f5.html", "https://th.bing.com/th/id/OIP.L3G13SaoY-bak_N78VFmOAHaEK?w=254&h=180&c=7&r=0&o=7&dpr=1.1&pid=1.7&rm=3", "Horror"],
            ["Fnaf World", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d8ee95c251f7c20598b0d42c2c375090.html", "https://th.bing.com/th/id/OIP.3nveg318CQ_eShKTd5zUFgHaEK?w=337&h=180&c=7&r=0&o=7&dpr=1.1&pid=1.7&rm=3", "Horror"],
           ["Five nights at Epstein's", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d7b5efdff8c12e973faa40020d911b3e.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/710.png", "Horror"],
    ["Midnight shift", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_f7629dd04a219c53bdf6d0f2421fcfd7.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/658.png", "Horror"],
    ["Iron Lung", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_e09fd370d40766ca1ffcc5bdb591d229.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/705.png", "Horror"],
    ["School boy runaway", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_32c0c8b002c4cb975a08f1c4e11993e2.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/605.png", "Action"],
    ["Five Nights at Freddy's: Pizza Simulator", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_8fd1120b36baff86409a8a249b866bfa.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/191.png", "Horror"],
    ["Five Nights at Freddy's: Sister Location", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_26177655aa637622cc3a3ec16f51fcc9.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/185.png", "Horror"],
    ["Kindergarten 1", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ef521b915ffa7ef66db86684a0954a82.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/445.png", "Simulation"],
    ["Kindergarten 2", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b93d3da6d567f909db1b2fbaf9505b76.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/446.png", "Simulation"],
    ["A Bite At Freddys", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_25f8965e3ec75d1611476c2e6da16894.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/258.png", "Horror"],
    ["Bust A Loop", "https://cookjessie383-wixsite-com.filesusr.com/html/308cff_483b7fa2dec065e53a3eda72e726f0da.html", "https://cdn.jsdelivr.net/gh/gn-math/covers@main/521.png", "Action"],
    ["That's not my neighbor","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0c81042a959729a95e7b7cdd63cf02d7.html","https://th.bing.com/th/id/OIP.jOp-nxrRJWRMuBW4kRT7fAHaEq?w=265&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Fears to fathom","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_572aa2e68dc88d7bf012e5521b5f5970.html","https://th.bing.com/th/id/OIP.pZgZfCleZe6OEQmMKUwwrAHaEK?w=300&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Slender man","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4fbdf675c831f01618fc1a1f06c170a1.html","https://tse3.mm.bing.net/th/id/OIP.9fzFna581lwkQp6blp2WdQHaEK?cb=ucfimg2&ucfimg=1&rs=1&pid=ImgDetMain&o=7&rm=3","Horror"],
    ["The man from the window","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_081f9eeba29467a9d0aa637fd45896f1.html","https://th.bing.com/th/id/OIP.jckpYALg87HRSm_QrMh2GAHaEj?w=278&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["FNAF 1","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_88f80b2f48655ffe2d93c945dd97c8dc.html","https://th.bing.com/th/id/OIP.tzsQpIaytSceo6d7z-pNBAHaEK?w=326&h=183&c=7&r=0&o=5&pid=1.7","Horror"],
    ["FNAF 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_1c2a06ce7c3dd0d7571a7c8cdf2159bd.html","https://th.bing.com/th/id/OIP.lLRwPUQifXTTaAywBgNtUQHaEK?w=333&h=187&c=7&r=0&o=5&pid=1.7","Horror"],
    ["R.E.P.O","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_3a7f6ee497a541f01b89e7d2ce341a7e.html","https://th.bing.com/th/id/OIP.ugZPQ-DkSgUQI5kViqcd5wHaD4?w=339&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Blood Money","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_23f23eb9e52bf1ceb07c788ac6c9e743.html","https://th.bing.com/th/id/OIP.rIex615SPcYgq4Z9BsCoLQHaEI?w=309&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Burger and frights","https://sgs-game-cdn.pages.dev/Projects/Burger%20&%20Frights/main","https://th.bing.com/th/id/OIP.nBGqj9oDhIuU6Ep-yx-mygHaEK?w=330&h=186&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Dead seat","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_e7c6eaa67db7e4fa7ab917de201bfcb6.html","https://th.bing.com/th/id/OIP.rViMeGlE1Z3PVscpk1nqXQHaEK?w=328&h=184&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Baldi's Basics","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b49415c7838d5272bed3689dc5bf5f3a.html","https://th.bing.com/th/id/OIP.v_jCMioFl5pXyG7IwRLZ9gHaEK?w=308&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Andys apple farm","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_55cf857ecf0f24c03931818ca5d2c64f.html","https://th.bing.com/th/id/OIP.ZufwLkcuYkIFhIi5w5TvIgHaEK?w=329&h=185&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Backrooms","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b0fb0d44b318cce53bb222223053649f.html","https://th.bing.com/th/id/OIP.W2BS8zgixNkZP2D0NaJ_dgHaEK?w=270&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Granny","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_dbdbefeff7b047946f8f53bd2fbe3eb9.html","https://th.bing.com/th/id/OIP.oAFZRgN_U5XtohDKMatA8gHaEK?w=314&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Granny 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c3f8a587f8831eefa2cca620e772a2e0.html","https://th.bing.com/th/id/OIP.ytNGKBEfwERxJGQrKjaAlgHaDn?w=350&h=170&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Granny 3","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_416af790ca7dea29c087069dcaa5bc7f.html","https://th.bing.com/th/id/OIP.rK4-OAg2PJa8AGm0JyGasgHaEP?w=309&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Drift hunters","https://sgs-game-cdn.pages.dev/Projects/Drift%20Hunters/main","https://th.bing.com/th/id/OIP.R5-k2knM3MzQGSbXhLbLKAHaEJ?w=304&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Crazy Cars","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_50dc552a289d3aa0e4273604c7c1ddd9.html","https://th.bing.com/th/id/OIP.dHeZ_7-NxHgpBEnSMXYXmQHaDn?w=290&h=170&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Bergen Truck","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ce3a36b65478665b459587784cd150e6.html","https://th.bing.com/th/id/OIP.iscqdkwq2sDPYA_WAPtZ3QAAAA?w=183&h=142&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Poly Track","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c60e40b61e7b68d01e3d0ab6e925de8b.html","https://th.bing.com/th/id/OIP.fsNUkXF_VFj7ff3ycpuEFAHaD0?w=318&h=179&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Escape Road","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_09a778fbb9300fcac375c605e1a95c41.html","https://th.bing.com/th/id/OIP.RxsM_DHsCi81kZ2-iiKULgHaEo?w=240&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Highway Racer","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c48f27399cfdf99416982c7763cdb81d.html","https://th.bing.com/th/id/OIP.66gDdLHcbTNZuOXruSm9JgHaD4?w=302&h=180&c=7&r=0&o=5&pid=1.7","Racing"],
    ["Blade Ball","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_bbde690928dfba35150bd1a7cf17c993.html","https://th.bing.com/th/id/OIP.w9Bq0azXbFtMkqLSje-z5QAAAA?w=234&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Minecraft 1.12","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2dd5de6cb688fee72be5cbab95e095a0.html","https://th.bing.com/th/id/OIP.YfwEzGWk99WxLiQZXMTw1AHaEK?w=321&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sandbox"],
    ["Kirby 64","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7baa9a02278914f648130cfbbf738e04.html","https://th.bing.com/th/id/OIP.3s6roTvNcUOFYVizk6gX9wHaDt?w=308&h=175&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Retro"],
    ["Super Mario 64","https://sgs-game-cdn.pages.dev/Projects/Super%20Mario%2064/main","https://th.bing.com/th/id/OIP.NJpccXzTJ0OHPflJYWgYJAHaEK?w=274&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Retro"],
    ["Lego Batman","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_1e99189d031d39e45df4ada28cf4ca6d.html","https://th.bing.com/th/id/OIP.Jgg-BZ0tNzUNSTviEJDOXwHaEK?w=312&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Solar Smash","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_a34d7d9529cdd13d72af213c4c67ca48.html","https://th.bing.com/th/id/OIP.2zlAYqtF8G_pV_HJBeDgRwHaDn?w=330&h=170&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Sandbox city","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_55aed20d83be262f0dec95a1c62c63cb.html","https://th.bing.com/th/id/OIP.sqkGZg2xxXsY_3NgmDILNwHaFj?w=239&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sandbox"],
    ["Super hot line miami","https://cookjessie383-wixsite-com.filesusr.com/html/308cff752c7227c6c8a92467696b38fd64c779.html","https://th.bing.com/th/id/OIP.hbgiYzWlAN-CCadAWj98zwHaFk?w=205&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Build now!","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_6b503f34c6f64a45a6fe9937d15f4fc0.html","https://th.bing.com/th/id/OIP.8VTjo7Z6rKoYtoH4Xzt39AHaHa?w=175&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Super hot","https://sgs-game-cdn.pages.dev/Projects/SuperHot/main","https://th.bing.com/th/id/OIP.5V1RdBCu6Mh0q9a1M_sfKAHaEK?w=321&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Karlson milk man","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_aec4e8345cfb319cf7874a359465987b.html","https://th.bing.com/th/id/OIP.Bks4wxZcflpWtgjr5lLeqAAAAA?w=227&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Ultra kill","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_919f5c53443b660a80d7c9d667fd1255.html","https://th.bing.com/th/id/OIP.F4tDtFN5oUnAhhGA1qlhFwHaEK?w=280&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Knights Arena","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_6bfbd4a603b41e65bf40dc506359f672.html","https://th.bing.com/th/id/OIP.3t5DISFg0gnT39Q16z-jUQHaEH?w=268&h=180&c=7&r=0&o=5&pid=1.7","Action"],
    ["HalfLife","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7fbcdf98e9bfce2bbdd9fc4800787797.html","https://th.bing.com/th/id/OIP.MzJhdFRr_r03qLJCj-f7hwHaFj?w=228&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["People playground","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_663dc2aec59746cedf7fdf39a8c7510d.html","https://th.bing.com/th/id/OIP.JOSKBAXMNzPVA7RCegNHKAAAAA?w=323&h=152&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Deltarune","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d3d08fe859c5e016e4a2710b5e930a07.html","https://th.bing.com/th/id/OIP.zDnsBsG5_S87y5RQNLhSawHaEK?w=323&h=181&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","RPG"],
    ["Squid Playground","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_1833ff0bb4ad28de308adb9e019568d3.html","https://th.bing.com/th/id/OIP.yw76oowFztk6sdIFhvEnlwAAAA?w=198&h=145&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Hollow knight","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_baadd1fca64488e9676b1cb222b162fc.html","https://th.bing.com/th/id/OIP.3uDiFHs1ltniHHMWxZRFngHaDt?w=317&h=174&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Raft","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d324c3d9aa09a662a30049a32f97a833.html","https://th.bing.com/th/id/OIP.YxWHQqIOCMMbGVB0hRDAwgHaEK?w=314&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Survival"],
    ["Only up","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4fa7e24a1a30d8d8390701c57ece7d60.html","https://th.bing.com/th/id/OIP.fZ1gZeFVMMWhSBosF5ezxAHaF0?w=239&h=187&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Gravity","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_719dccae1d8a4b0aac36d315a166124b.html","","Arcade"],
    ["Chrome dino","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_908edc67fbe3f9f03b98e4ec322cbfa1.html","https://th.bing.com/th/id/OIP.AXkOaVfMJMHuPZ0kut5tPQHaEO?w=267&h=180&c=7&r=0&o=5&pid=1.7","Arcade"],
    ["Getting over it","https://69150697-b785-4bcb-9ae1-0524e0fabe96.filesusr.com/html/308cff_c955f8860628e460512c60e251f69a9f.html","https://th.bing.com/th/id/OIP.4RyWPxhm1sRijTVqN0JPEwHaEK?w=304&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Friday night Funkin","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_dbd408f94b143f8373ebe76127d6a845.html","https://th.bing.com/th/id/OIP.H9roSlTGlAr5PknXZCsiPgHaEK?w=288&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Rhythm"],
    ["Friday night funkin VS Shaggy","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_aa9ea8410b0a4b3b4c7c11b44501d375.html","https://th.bing.com/th/id/OIP.c300rEGyaIobRsVVw4tsegHaEK?w=303&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Rhythm"],
    ["A dance of fire and ice","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0ab3ba6a32e352ad2d4bb87cde54141f.html","https://th.bing.com/th/id/OIP.ttcG_a5H7zU6TygOHA8mVwAAAA?w=194&h=181&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Rhythm"],
    ["A small world cup","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_f3940e0d70b5293bdbdaffd107ec6fde.html","https://th.bing.com/th/id/OIP.DxU6WnzvdlB2u7cJPCvOawHaDn?w=309&h=170&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["Angry birds","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_55dc779bc57b33541bed4205fbfd4f72.html","https://th.bing.com/th/id/OIP.CjCGq44xAwCK1gn77tk3DgHaEo?w=281&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Bad parenting","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0ed710982a10cd56b474252d5017db7f.html","https://th.bing.com/th/id/OIP.h9HV3cwTCjoUDLUFfauyrQHaEP?w=327&h=187&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Baseball bros","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c4981e24b86c333d69732a8cabaa0458.html","https://th.bing.com/th/id/OIP.sLodm1JS1xq6AfQsb_VBnQHaHa?w=173&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["basket battle","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7767f2c4954d55b5f267f73d2664d082.html","https://th.bing.com/th/id/OIP.Wt6l_swlb7wV-BkfLjiKaAHaHa?w=168&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["basket random","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_6e5bbfc9e5e861f5bf8fabc8e4714c99.html","https://th.bing.com/th/id/OIP.iF9-8aXNta97pHY7jLfTSwHaEo?w=248&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["basket ball stars","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5a0afb889ab52bc8762338ea8f77ba89.html","https://th.bing.com/th/id/OIP.e_VMFpEVoRmL58JC9jD3-AHaE0?w=248&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["Bitlife","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_fdd3accf5996a8beb9d8b9f2164c708b.html","https://th.bing.com/th/id/OIP.ed0vN6LGwQFtk6xmDmVoHwHaEK?w=321&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Blaze drifters","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_32c7643cdf334f895f1938ca4bd7491e.html","","Racing"],
    ["Block blast","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0c12aead615e2d2a38a55fc977400a03.html","https://th.bing.com/th/id/OIP.0eJl8ObTdD7YO6c71EbA0AHaES?w=280&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["Blocky Demolition Derby","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_33282609c09e64f1724e430bf498fec5.html","https://th.bing.com/th/id/OIP.dLZ9TVyaoqEQVHxCYs2p2wHaD4?w=324&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Blocky Snakes","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4306b08f07af81e007a7077601535229.html","https://th.bing.com/th/id/OIP.Qa3kOMxgKP1xrRY9foEE6gHaHa?w=162&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Blood tournament","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_cc7742378ad220d5391cde3831b761fa.html","https://th.bing.com/th/id/OIP.22rvrcKCAE0LcjBtAkH9QgHaFl?w=218&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Bounce masters","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_9699bb65c1a49b773d5dfed3fbf4e3d6.html","https://th.bing.com/th/id/OIP.34Bm5hs6xltXgQPtd86iyQHaDk?w=312&h=168&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["boxing random","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d6841a70a29c0330d95bbf5327bf9109.html","https://th.bing.com/th/id/OIP.GNwWCfdw4IcSwckXpY_LvQHaEK?w=266&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["choppy orc","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_8013c5601d2cc272c73df25da1cfc366.html","https://th.bing.com/th/id/OIP.T4UvcdA-eUXN_4WgC9VOKgHaDt?w=288&h=175&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["cluster truck","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5ba3cc4a3754b6501c3008fccc0daf22.html","https://th.bing.com/th/id/OIP.PlGx972nW0YgPaR-MShe2AHaDd?w=350&h=163&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["crazy mototrcycle","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2332d8760ae403bed4904bc512e48864.html","https://th.bing.com/th/id/OIP.sVOku8N2vgaYoLUraZHVxQHaEK?w=312&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["crazy chicken 3d","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_9bad45c3b00e9ebf5fd27777c7871a92.html","https://th.bing.com/th/id/OIP.kR6doKnU-RN8y79Wtg0X2wHaHa?w=183&h=183&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["cookie clicker","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_6191eb8aa21aac260a6391f342a9de56.html","https://th.bing.com/th/id/OIP.-uAVudpSoNrI7XtaXYG80QHaEb?w=297&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Clicker"],
    ["Crossy Road","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_094855848ee2a5b8aae9f3ed9fa2dd4a.html","https://th.bing.com/th/id/OIP.sRjDECblzJaAuPhGi_JvPQHaEK?w=285&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["deepest sword","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_f096c1116d1c8003e5e3e176bd75df45.html","https://th.bing.com/th/id/OIP.GpTUcRRCJBWQiuvVxoHhYQAAAA?w=226&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["dodge miner","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_746d66beb4e418ff01d10724f3988560.html","https://th.bing.com/th/id/OIP.XVsF69jpOcKYRPNBWLC-9AHaEM?w=287&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["dodge miner 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_a7b6d94fdd1ef26b09a78491241f7e45.html","https://th.bing.com/th/id/OIP.JIWJNSvihSdSM-dvPVxPdwHaD3?w=276&h=180&c=7&r=0&o=5&pid=1.7","Arcade"],
    ["drive mad","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_3db30de8a12682cd714f5f25ebc86990.html","https://th.bing.com/th/id/OIP.A59clITX9HQPunpR3Rj9uAHaD4?w=343&h=180&c=7&r=0&o=5&pid=1.7","Racing"],
    ["duck life space","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c39e72ad05032b2bd9bbb445569fd72a.html","https://th.bing.com/th/id/OIP.qgeXlcsgdz4GPBf2EsjkzQHaEK?w=326&h=183&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["eggy car","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_46b198270f823eb5d711532ce549edd0.html","https://th.bing.com/th/id/OIP.psbedeTnZFEIutksdNLS4gHaFj?w=228&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["fnaf 3","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b63025a4ec74885360a880f17f7a12f7.html","https://th.bing.com/th/id/OIP._CWgr-vY9AA8jLa7jCUgUgHaEK?w=265&h=180&c=7&r=0&o=5&pid=1.7","Horror"],
    ["fnaf 4","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_773f8fee0a014579017ec6bb39a5297a.html","https://th.bing.com/th/id/OIP.lVEA62d_STze123TEWP4YgHaEK?w=314&h=180&c=7&r=0&o=5&pid=1.7","Horror"],
    ["fnaf world","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_773f8fee0a014579017ec6bb39a5297a.html","https://th.bing.com/th/id/OIP.VKGjQER57vTXmA4NGPQNzQHaFj?w=169&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","RPG"],
    ["football bros","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_fe1a67ba6321b7b837d48f367c596aec.html","https://th.bing.com/th/id/OIP.cjdJbzyHy6zRK46FhSZ3ogHaEi?w=273&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["funny shooter 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ff36e20ff38d36e1b5e385547fefdaad.html","https://th.bing.com/th/id/OIP.abhtDf1vguVat2kxR46nrgHaEH?w=331&h=184&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["fruit ninja","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_823efca9c84f72061575a264c1f0e781.html","https://th.bing.com/th/id/OIP.vP6cJBF-zePfZzsp0fa0SwHaD4?w=324&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["geometry dash lite","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_9b5b85b6e8d4f34bfae93201b7bcb01b.html","https://th.bing.com/th/id/OIP.xzcGSyqVpOziy5nkJWadSwHaEK?w=270&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["getaway shooter","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0ff83caf3863d71b2b8fa735c45bc393.html","https://th.bing.com/th/id/OIP.PPom7Z99XBMeyX9oBa_LRQHaHa?w=176&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["gladi hoppers","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0ef6095ecd7eedb7d3e5db42c71689bc.html","https://th.bing.com/th/id/OIP.ZeajBlEibFZIQdzU-6AJ3wHaF4?w=218&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["gunspin","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b7b5981347397428a09798e9fa691438.html","https://th.bing.com/th/id/OIP.TIT_yoZ55-78She7ptPxLwHaFj?w=226&h=180&c=7&r=0&o=5&pid=1.7","Action"],
    ["gym stack","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_795292ec79b1082da7676e647047d306.html","https://th.bing.com/th/id/OIP.yD77yafAtNCgUsGWG17XrwHaEK?w=274&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["house of hazards","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_e56284247a100fe1d9f50219e9a9d9c7.html","https://th.bing.com/th/id/OIP.VlPiG2-IR0R3XEPO388fmgHaD4?w=329&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["human expenditure program","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c469d77b38e41e440fc597bdf74dd27a.html","https://th.bing.com/th/id/OIP.1RsStdB7PvTj_kV4uA5AxQHaEK?w=311&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["hover racer drive","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2b9e49be5764e23c768fcb218f2a944c.html","https://th.bing.com/th/id/OIP.0OPzixROwQfSV8LRQkGN5QHaEW?w=293&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["Ink game","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_325e848a4f104118997dfd7fbe018213.html","https://th.bing.com/th/id/OIP.vRHKJ5heDlfNCoeNcf8feAHaDc?w=345&h=162&c=7&r=0&o=5&pid=1.7","Puzzle"],
    ["infinite craft","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_cba2574ec494b666376991e5cabad7f5.html","https://th.bing.com/th/id/OIP.d3o7D0eqPNyXQP3QoNvMuwHaEK?w=278&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["kour.io","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0a15d30ec87206c4f68aae82410af213.html","https://th.bing.com/th/id/OIP._LGdgsV6AZNrQoAMou__CAAAAA?w=225&h=141&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Nazi zombies","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ed3b5224294996674e47f2275cf58544.html","https://th.bing.com/th/id/OIP.QLQIwvCpWU-mbAwbi6--mQHaEK?w=255&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["One night as Freddy's","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5963d8ea32096a62cd5b2d980d2d0682.html","https://th.bing.com/th/id/OIP.Lao9kYlLk2jvlv2Te0Mn5wHaEK?w=282&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Osu","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c1dd9f4bf1b1df89844415fc91b36eb8.html","https://th.bing.com/th/id/OIP.uS09Dhkx88SDSFfwpaSyPgHaEK?w=224&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Rhythm"],
    ["parking fury","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_464a0aa713c55cdce05a5927633d666b.html","https://th.bing.com/th/id/OIP.p4cAUggGx7EQ43qrrfXfsgHaEK?w=208&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["Portal 2d","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d5ab1ac2fd31a9a274811c3fcfd2b35f.html","https://th.bing.com/th/id/OIP.dhGUTpJdxLxztT4Ofjp6hQHaFk?w=225&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["ragdoll archers","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5988d2ef4447d0c02ed69d69bd4fef43.html","https://th.bing.com/th/id/OIP.enBZ7FzvUIcqaLO0pQhgqAHaE8?w=171&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["retro bowl","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_28d5a02fc7a1dc5ec931e6d586ddeca4.html","https://th.bing.com/th/id/OIP.73dFbFUHUVU9rpmvuoW9LAHaEK?w=297&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["retro bowl college","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_42cc059357e2050df7a6175ebb999505.html","https://th.bing.com/th/id/OIP.2n2m0uGJmCgcfSoTHzYsBAHaEK?w=316&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["rooftop snipers","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_72756475c31f965d6437a27c6bd33440.html","https://th.bing.com/th/id/OIP.jZ7SwB1Z4yY8Habr_PhtvwHaEj?w=255&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["rooftop snipers 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4468b2bc67ac38451402c0aa33bc6ea0.html","https://th.bing.com/th/id/OIP.cHmK8BvVnnTlCzEtMGnGgAAAAA?w=158&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["slither.io","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4606a41d970c4bbd3fedacb4af7955bd.html","https://th.bing.com/th/id/OIP.NE0F32ZefdDZP1YCNYaKAAHaHa?w=179&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["slow roads","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7ff9e5092f4da4b22d39083740e50606.html","https://th.bing.com/th/id/OIP.UHnpDdEBcJpC3HGXIoPBqwHaEK?w=280&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["snowball.io","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d38daba27415d322f88a12beae1ef159.html","https://th.bing.com/th/id/OIP.AFgFna9ltq1gKrxk2DKaHQHaD4?w=333&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["soccer bros","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_740b83abb2cd2ef4ac85793780809423.html","https://th.bing.com/th/id/OIP.N-nPdCz6pnIn9HrM4MRSWQHaD4?w=326&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["soccer random","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7c8ad00de8600a016d2768897f21b3dd.html","https://th.bing.com/th/id/OIP.ganHlo9M4-s8vws5c-DpQQHaDn?w=337&h=170&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["Subway surfers","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_2f468b2d851e314d09dcd63a635fb832.html","https://th.bing.com/th/id/OIP.h-kgCIZHfbEcXyvc1ksbWwHaEK?w=208&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["temple run 2d","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_76a5f1e84e97831ffd8e47b9f7c5c6c7.html","https://th.bing.com/th/id/OIP.h-kgCIZHfbEcXyvc1ksbWwHaEK?w=208&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["tomb of mask","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_f25e3738351adcfec44123857e8e1049.html","https://th.bing.com/th/id/OIP.6CJLfL9KUhnPAx2DvJg4pwHaEK?w=287&h=183&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["Ultimate car driving simulator","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_230b92c217825bf22807e5bae90215fd.html","https://th.bing.com/th/id/OIP.o5fH-Wsy34ntxwdlv8dAFwHaHa?w=184&h=184&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["slope plus","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_d10282c55ba16374431f3ae11885f772.html","https://th.bing.com/th/id/OIP.QdGX2PGxPzeZDTxizb5DOwHaDl?w=346&h=180&c=7&r=0&o=5&pid=1.7","Arcade"],
    ["snow rider 3d","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_b60f94ad0f84315fb5e8927dff258b68.html","https://th.bing.com/th/id/OIP.yFL6kbPM_ufuAMt8faoq1AHaHa?w=147&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sports"],
    ["sonic.exe","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_05c99092e1d9bc44a6ea93b516371b06.html","https://th.bing.com/th/id/OIP.y9mFUZ2coKXNbE_PZRwPrwHaDt?w=348&h=174&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["space bar clicker","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_023860389f27171745d022803c4c8a6e.html","https://th.bing.com/th/id/OIP.F6JOlukyM5WuXIJkGpC51QHaHa?w=172&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Clicker"],
    ["space waves","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5735650bd72214bf962da9b734073e73.html","https://th.bing.com/th/id/OIP.s2KHRTuSWAhN0c6rmqHVKQHaEH?w=320&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["survival race v2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5f5ea2c62ccfacbad02ffdbc03e0a3b8.html","https://th.bing.com/th/id/OIP.JDmxVxyMXr3QrrDp2F623gHaHa?w=163&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["survival race v1","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_1255378d4a6c1f98af13d6307dee47bc.html","https://th.bing.com/th/id/OIP.9Av81D5iX7t1kN9WmKNmdgHaDY?w=304&h=159&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["1","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_eaebd4fc27b5ee9f52b729339fd67b52.html","","Arcade"],
    ["10 minutes till dawn","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_a2dd5803a99016a757ce40a00102dffd.html","https://th.bing.com/th/id/OIP.Kq4jLVkO82hDFcBOl0tJuAHaD4?w=273&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["1v1.lol","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_86ec7f8b730df71e730127f41f76e9dd.html","https://th.bing.com/th/id/OIP.ASM6tUWCDbxvnZvSQT1GWgHaD4?w=309&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["99 nights in the forest","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_1c8651b0d1dafe927c3868200b711565.html","https://th.bing.com/th/id/OIP.jjmTx0KBOyhrqfPDBvLILAHaEK?w=314&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["a dark room","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ae7c59d700af7f1431f071de41e19951.html","https://th.bing.com/th/id/OIP.pSHqnP9xeswVBEIqpm6u1wHaEK?w=323&h=181&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","RPG"],
    ["a day in the office","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_37a700eda28c55912ed10eb5db0c72b4.html","https://th.bing.com/th/id/OIP.H5W3cb2nEZkBEGSwJ_8iawHaEK?w=314&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["ahoy survival","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_81beb819db847ed44d6ae9fa160d893d.html","https://th.bing.com/th/id/OIP.5_1HOzLcLpS8pmetpDMfqgHaEK?w=302&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Survival"],
    ["ages of conflict","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_453dbec432b54f2bb0bf0b10407f9df2.html","https://th.bing.com/th/id/OIP.clY-8CVvNttJxe6G1LlGDAHaEK?w=296&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Strategy"],
    ["amazing strange rope police","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_6a9c4f4cd238256c4888de3c7322c032.html","https://th.bing.com/th/id/OIP.d8pMHUvp5YsSBj7-CQZwTwHaEK?w=297&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["among us fan version","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_345405298de73cebfc138adc3737fd2d.html","https://th.bing.com/th/id/OIP.ZoxKA2oHG8C8vxDoKbmF8wHaEK?w=328&h=184&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["babel tower","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_18397f960d16bf07776777fa0de4d06d.html","https://th.bing.com/th/id/OIP.BVRI7bbi2iXE7Jn84Rhc0AHaEL?w=294&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Clicker"],
    ["baby Chicco adventures","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_3548274d8ea29cc51e6f27c250a8ee5f.html","https://th.bing.com/th/id/OIP.gxAJDJsbW8zgoPIsdkWT8AHaEK?w=289&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["baby sniper in Vietnam","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_e189e72667ac6e5f629a5162c34eef3d.html","https://th.bing.com/th/id/OIP.-Sc1_E2ZHBYygja9iJGYYQHaD4?w=331&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["bacon may die","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0404564ccb48dc84c3ca133152b99b0b.html","https://th.bing.com/th/id/OIP.0ns6_qfk6f6ldN0BM8FE6wHaDt?w=303&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["bad bodyguards","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_7cca25aad01ab4c5a0d2996a1749d4cd.html","https://th.bing.com/th/id/OIP.i_3opbZG85YsESoV4moKDQHaEK?w=290&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["bad Monday simulator","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_c6cbff115af23730347234b000bf10e6.html","https://th.bing.com/th/id/OIP.68dgXpRaFzAllIfXiJKBmgHaEK?w=333&h=187&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["bad time simulator","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_3e722c43f5df45f40886bcf783d04a6b.html","https://th.bing.com/th/id/OIP.fpELPk3wD4XlB8zm7I8PzgHaFj?w=240&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","RPG"],
    ["bank robber 2","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_8d0f426860166d8831b517c22fdfaea7.html","https://th.bing.com/th/id/OIP.YtL7L9jrs48QJp-z3nu7sAHaEK?w=296&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["capy barra clicker","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_cd411c683061919e4b717cfd02874cad.html","https://th.bing.com/th/id/OIP.tLeoYIhQefs4r_7voRI_1QHaHa?w=175&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Clicker"],
    ["car drawing","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5d2333369501409d61572514e3dca7a6.html","https://th.bing.com/th/id/OIP.JHPLvUUUNZ1SIv9vxLa21wHaEK?w=304&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["cheese chompers 3D","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_89a5f64f44970d6b23c6c327bb5e588b.html","https://th.bing.com/th/id/OIP.zK9b7a0vFQF3CpdFE5EiMAHaHa?w=180&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["clash of Vikings","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_bce33fe3e3a92651bd435c3a2b537b3d.html","https://th.bing.com/th/id/OIP.MTWgnyvooKdVgK9iw8-tIwHaD4?w=324&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Strategy"],
    ["Doodle Jump","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_26bc14dfcc278ba889af4aef205c9b59.html","https://th.bing.com/th/id/OIP.8a8AQMUmEQaIrn8N2KcZPQHaD4?w=324&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Arcade"],
    ["half life doom","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_0203bb115f63a5538bcf409d7e32f02e.html","https://th.bing.com/th/id/OIP.iFauKnPtf2-ExY8_Orow9QHaEK?w=268&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Action"],
    ["Draw climber","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4ab068ddcc157ff58600b8ca9878a482.html","https://th.bing.com/th/id/OIP.EbV0Ye60DvMGXMC_Do3NyAHaHa?w=199&h=199&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Puzzle"],
    ["dreader","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_155344af01d6542573a85dd75aa2cd53.html","https://th.bing.com/th/id/OIP.oZRoTn17tFMRDvy6kZj6dQHaEK?w=297&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["drve wild","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ceff85e78f3455cf796fc4917fd0935b.html","https://th.bing.com/th/id/OIP.XL2XV4SCk8E_luMgYw4MkwHaEK?w=276&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Racing"],
    ["SandBoxels","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_ad07b8fa67cccca584d2834177df8c95.html","https://th.bing.com/th/id/OIP.9U8qs2mYg_kpf7P-h3bp5AAAAA?w=256&h=150&c=6&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Sandbox"],
    ["Short Life","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_945a9ecaeb4a435048bd2204962fe1db.html","https://th.bing.com/th/id/OIP.9DQzEHP73HfqhY92hz3AogHaEK?w=323&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Side Effects","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_26073acb012073f793464381ff37379b.html","https://th.bing.com/th/id/OIP.ij8xFalWSTMYEuCCIdahHQHaFj?w=235&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Simulation"],
    ["Station 141","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5c218f501e6c67f5652d7baf5812b998.html","https://th.bing.com/th/id/OIP.0u2L0yHh_j2Fhn0wZPes6AAAAA?w=242&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1","Horror"],
    ["Gta vice city","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5462425dd3f0ea61efca0f14d5ca15ab.html","https://th.bing.com/th/id/OIP.vfq2Q2R1UJyLJE1189TT2gHaEK?w=328&h=184&c=7&r=0&o=5&pid=1.7","Action"],
    ["Gorilla tag","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_a6c51ff15e1a14ba87f573e556fbf374.html","https://th.bing.com/th/id/OIP.hRkZtLnpiGtDS-93uMa4WQHaEK?w=260&h=180&c=7&r=0&o=5&pid=1.7","Action"],
    ["Pizza tower","https://educateandlearnallabout.sciencevictory.com/gamefile/Pizza%20Tower.html","https://th.bing.com/th/id/OIP.H1Ue7_yzzD_FxS3vBZfkQAHaEK?w=314&h=180&c=7&r=0&o=5&pid=1.7","Action"],
    ["customer support","https://educateandlearnallabout.sciencevictory.com/games/CustomerSupport/index.html","https://img.itch.zone/aW1nLzIyNDA0OTE0LmpwZw==/original/9EfAmY.jpg","Simulation"],
    ["Yandere simulator","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_4d6f28fc6faa51efd76501f9c6c7d931.html","https://th.bing.com/th/id/OIP.5XjLOH6gkak1CgIondP6dAHaEK?w=289&h=180&c=7&r=0&o=5&pid=1.7","Simulation"],
    ["Baldi basics","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_71b56e8afb366e16b35005ecf06804df.html","https://th.bing.com/th/id/OIP.647bxkGN7fqaMM04BVg5YAAAAA?w=460&h=215&c=7&r=0&o=5&pid=1.7","Horror"],
    ["Class of 09","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_832effc1899f7a12522ca28d4f3bbb61.html","https://th.bing.com/th/id/OIP.3_x6Uj56uFhhr4cn_5dWbQAAAA?w=115&h=180&c=7&r=0&o=7&pid=1.7","Simulation"],
    ["Crazy plane landing","https://cookjessie383-wixsite-com.filesusr.com/html/308cff_5693c6ca5a5a524934f89e61e2a2441e.html","https://th.bing.com/th/id/OIP.4U20-dNtlNsK4V6Ni3xI_QHaEK?w=267&h=183&c=7&r=0&o=7&pid=1.7","Simulation"]
];

        const GAMES = _GAMES.map(g => ({ title: g[0], url: g[1], image: g[2], category: g[3] }));
        const CATEGORIES = ['All', 'Action', 'Horror', 'Racing', 'Arcade', 'Simulation', 'Retro', 'Strategy', 'Favorites'];
        const THEME_COLORS = ['#a78bfa', '#4ade80', '#f87171', '#60a5fa', '#fb923c', '#facc15', '#f472b6', '#22d3ee', '#ffffff'];

        class AccountSystem {
            constructor() {
                this.username = localStorage.getItem('nm4r-user');
                this.password = localStorage.getItem('nm4r-pass');
            }

            async authenticate(e) {
                e.preventDefault();
                const user = document.getElementById('auth-user').value.trim();
                const pass = document.getElementById('auth-pass').value.trim();
                if(!user || !pass) return;

                const btn = document.getElementById('auth-btn');
                btn.textContent = "Authenticating...";

                try {
                    // Check for ban first
                    const banSnap = await db.ref(`bans/${user}`).once('value');
                    if (banSnap.exists()) {
                        alert("ACCESS DENIED: This account has been permanently banned.");
                        btn.textContent = "Login / Create";
                        return;
                    }

                    const snap = await db.ref(`accounts/${user}`).once('value');
                    const data = snap.val();

                    if (data) {
                        if (data.password === pass) {
                            this.completeLogin(user, pass, data);
                        } else {
                            alert("Incorrect Password!");
                            btn.textContent = "Login / Create";
                        }
                    } else {
                        // Create new account
                        const newData = {
                            password: pass,
                            favorites: JSON.parse(localStorage.getItem('nm4r-favorites') || '[]'),
                            settings: JSON.parse(localStorage.getItem('nm4r-settings') || '{}'),
                            status: "No status set."
                        };
                        await db.ref(`accounts/${user}`).set(newData);
                        this.completeLogin(user, pass, newData);
                    }
                } catch(err) {
                    console.log(err);
                    alert("Network error.");
                    btn.textContent = "Login / Create";
                }
            }

            completeLogin(user, pass, data) {
                localStorage.setItem('nm4r-user', user);
                localStorage.setItem('nm4r-pass', pass);
                if(data.favorites) localStorage.setItem('nm4r-favorites', JSON.stringify(data.favorites));
                if(data.settings) localStorage.setItem('nm4r-settings', JSON.stringify(data.settings));
                if(data.role === 'admin') window.isAppAdmin = true; // Set app-wide admin status

                this.username = user;
                app.favorites = new Set(data.favorites || []);
                app.settings = { ...app.defaultSettings, ...app.settings, ...(data.settings || {}) };
                app.applySettings();
                app.renderLibrary();

                document.getElementById('auth-modal').classList.add('opacity-0', 'pointer-events-none');
                setTimeout(() => document.getElementById('auth-modal').classList.add('hidden'), 500);

                if(globalChat) {
                    globalChat.username = user;
                    document.getElementById('sidebar-username').textContent = user;
                    document.getElementById('sidebar-user-initial').textContent = user.charAt(0).toUpperCase();
                    globalChat.input.disabled = false;
                    globalChat.submitBtn.disabled = false;
                    globalChat.db.ref(`users/${user}`).onDisconnect().remove();
                    globalChat.db.ref(`users/${user}`).set(Date.now());
                    globalChat.renderSidebar();
                    globalChat.listenForCalls(); 
                    globalChat.listenForFriendRequests();
                } else {
                    globalChat = new ChatSystem();
                }
                app.openChat();
            }

            async changeName() {
                const newName = prompt("Enter new username:");
                if(!newName || newName === this.username) return;

                const snap = await db.ref(`accounts/${newName}`).once('value');
                if(snap.val()) {
                    alert("Username already taken!");
                    return;
                }
                const dataSnap = await db.ref(`accounts/${this.username}`).once('value');
                const oldData = dataSnap.val();
                await db.ref(`accounts/${newName}`).set(oldData);
                await db.ref(`accounts/${this.username}`).remove();
                localStorage.setItem('nm4r-user', newName);
                alert("Username changed! Reloading system...");
                location.reload();
            }
            
            async changePassword() {
                if(!this.username) return;
                const newPass = prompt("Enter new password/PIN:");
                if(newPass) {
                    await db.ref(`accounts/${this.username}/password`).set(newPass);
                    localStorage.setItem('nm4r-pass', newPass);
                    this.password = newPass;
                    alert("Password updated successfully.");
                }
            }
            
            async updateStatus() {
                if(!this.username) return;
                const newStatus = prompt("Set a new status (max 50 chars):", app.settings.status || "");
                if(newStatus !== null && newStatus.length <= 50) {
                    await db.ref(`accounts/${this.username}/status`).set(newStatus);
                    app.updateSetting('status', newStatus);
                    alert("Status updated.");
                } else if(newStatus !== null) {
                    alert("Status cannot be longer than 50 characters.");
                }
            }


            async syncData() {
                if(!this.username) return;
                const dataToSync = {
                    password: this.password,
                    favorites: JSON.parse(localStorage.getItem('nm4r-favorites') || '[]'),
                    settings: JSON.parse(localStorage.getItem('nm4r-settings') || '{}'),
                    status: app.settings.status || "No status set."
                };
                // Preserve role if it exists
                const snap = await db.ref(`accounts/${this.username}/role`).once('value');
                if (snap.exists()) dataToSync.role = snap.val();

                await db.ref(`accounts/${this.username}`).set(dataToSync);
                alert("Cloud Sync Complete!");
            }
            
            logout() {
                db.ref(`users/${this.username}`).remove();
                localStorage.removeItem('nm4r-user');
                localStorage.removeItem('nm4r-pass');
                location.reload();
            }
        }
        const accountSystem = new AccountSystem();

        class App {
            constructor() {
                this.defaultSettings = { 
                    perfMode: false, oledMode: false, compactUI: false, noAnimations: false, noParticles: false,
                    borderRadius: '1.25rem', gridGap: '1.5rem', 
                    fontBase: "'Outfit', sans-serif", fontHead: "'Space Grotesk', sans-serif", textSize: '16px', tracking: 'normal',
                    tabTitle: 'NOTMINE4REAL', tabIcon: '', panicUrl: 'https://classroom.google.com', panicKey: '`', 
                    accentColor: '#a78bfa', profilePic: '', status: 'No status set.',
                    theme: 'default'
                };
                this.settings = { ...this.defaultSettings };
                this.activeCategory = 'All'; this.searchQuery = ''; this.currentGame = null;
                this.favorites = new Set(JSON.parse(localStorage.getItem('nm4r-favorites') || '[]'));
                this.activeSettingsTab = 'Design'; this.previousLayer = 'menu';
                this.isChatOpen = false;
                this.notifications = [];
                this.brainrotInterval = null;
                this.fakeCursor = null;
                this.init();
            }

            init() {
                try { const s = JSON.parse(localStorage.getItem('nm4r-settings')); if (s) this.settings = { ...this.settings, ...s }; } catch(e){}
                this.loadNotifications();
                this.applySettings(); this.setupSecurity(); this.setupFullscreenListener(); lucide.createIcons();
                document.getElementById('search-input')?.addEventListener('input', e => { this.searchQuery = e.target.value; this.renderLibrary(); });
                if (window.self !== window.top) this.showLauncher(); else this.runIntro();
                this.listenForAdminCommands();
                window.onwheel = e => { if (document.body.classList.contains('invert-scroll-mode')) window.scrollBy(0, -e.deltaY); };
            }

            showLauncher() { document.getElementById('launcher-layer').classList.remove('hidden', 'opacity-0'); }
            launchApp() { window.open(window.location.href, '_blank'); }

            runIntro() {
                document.getElementById('launcher-layer').classList.add('hidden');
                const cs = document.getElementById('cutscene-layer');
                cs.classList.remove('hidden');
                setTimeout(() => { document.getElementById('cs-logo').classList.remove('hidden'); lucide.createIcons(); }, 300);
                setTimeout(() => { 
                    cs.classList.add('animate-slide-up-out'); 
                    this.showMainMenu(); 
                }, 2000);
                setTimeout(() => { cs.classList.add('hidden'); }, 3000);
            }

            showMainMenu() { this.previousLayer = 'menu'; const menu = document.getElementById('menu-layer'); menu.classList.remove('hidden'); menu.classList.add('flex'); document.body.classList.add('overflow-hidden'); this.renderMainMenu(); this.setupMenuTilt(); lucide.createIcons(); }
            
            renderMainMenu() {
                const layer = document.getElementById('menu-layer');
                const heroGame = GAMES.find(g => g.title === "Minecraft 1.12") || GAMES[0];
                this.menuPreviewData = { games: { isGame: false }, featured: { isGame: true, title: heroGame.title, desc: "Play now.", img: heroGame.image, tag: "Featured" }, random: { isGame: true, title: "Random Game", desc: "Play something new.", img: GAMES[1].image, tag: "Random" }, partners: { isGame: false }, team: { isGame: false }, chat: { isGame: false }, settings: { isGame: false }, requests: {isGame: false}, help: {isGame: false} };
                
                layer.innerHTML = `
                    <div id="menu-ambient-bg" class="absolute inset-0 bg-transparent"></div>
                    <div id="menu-bg" class="absolute inset-0 bg-cover bg-center transition-all duration-700 opacity-0 blur-xl scale-110"></div>
                    <div class="relative z-10 w-full h-full flex flex-col md:flex-row items-center justify-center p-8 md:p-16 lg:p-24 gap-12 lg:gap-24">
                        <div class="w-full md:w-[45%] flex flex-col justify-center space-y-8 animate-reveal-up">
                            <div class="mb-6"><h1 class="font-display font-extrabold text-6xl md:text-[5.5rem] text-white tracking-tighter leading-[0.85] mb-4">NOTMINE<span class="text-zinc-600 block md:inline">4REAL</span></h1></div>
                            <div class="flex flex-col space-y-1">
                                ${this.createMenuItem('GAMES', 'enterLibrary()', 'games', 'layout-grid')}
                                ${this.createMenuItem('FEATURED', `openViewer('${heroGame.title.replace(/'/g, "\\'")}')`, 'featured', 'star')}
                                ${this.createMenuItem('PARTNERS', 'openPartners()', 'partners', 'handshake')}
                                ${this.createMenuItem('CHAT', 'openChat()', 'chat', 'message-square')}
                                ${this.createMenuItem('REQUESTS', 'openRequests()', 'requests', 'plus-square')}
                                ${this.createMenuItem('HELP', 'openHelp()', 'help', 'help-circle')}
                                ${this.createMenuItem('SETTINGS', 'openSettings()', 'settings', 'settings')}
                                ${this.createMenuItem('TEAM', 'openTeam()', 'team', 'users')}
                            </div>
                        </div>
                        <div class="hidden md:flex w-full md:w-[55%] h-full max-h-[600px] items-center justify-center">
                             <div id="menu-preview-card" class="w-full max-w-xl aspect-video bg-zinc-900 rounded-[2rem] overflow-hidden relative shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-white/10 transition-all duration-700 opacity-0 scale-95 pointer-events-none group perspective-1000">
                                  <img id="menu-preview-img" src="" class="w-full h-full object-cover transition-transform duration-[1.5s] ease-out group-hover:scale-110 opacity-80" />
                                  <div class="absolute inset-0 bg-gradient-to-t from-black via-black/40 to-transparent opacity-90"></div>
                                  <div class="absolute bottom-0 left-0 p-10 w-full transform transition-transform duration-500 translate-y-4 group-hover:translate-y-0">
                                      <div class="flex items-center justify-between mb-4"><div id="menu-preview-tag" class="px-4 py-1.5 rounded-full bg-white/10 backdrop-blur-md border border-white/20 text-white text-xs font-bold uppercase tracking-widest">Tag</div></div>
                                      <h2 id="menu-preview-title" class="font-display font-extrabold text-5xl text-white mb-2 leading-tight drop-shadow-lg">Title</h2>
                                      <p id="menu-preview-desc" class="font-sans text-zinc-300 text-lg opacity-80">Desc</p>
                                  </div>
                             </div>
                        </div>
                    </div>`;
            }

            createMenuItem(text, action, key, icon) { return `<button onclick="app.${action}" onmouseenter="app.updateMenuPreview('${key}')" class="group w-full text-left py-6 border-b border-zinc-900 hover:border-zinc-500 transition-colors duration-500 flex items-center justify-between relative overflow-hidden"><span class="font-display font-bold text-4xl md:text-5xl tracking-tight text-zinc-600 group-hover:text-white transition-colors duration-500 relative z-10">${text}</span><div class="flex items-center gap-6 relative z-10 transform translate-x-4 opacity-0 group-hover:translate-x-0 group-hover:opacity-100 transition-all duration-500 ease-out"><div class="w-10 h-10 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center group-hover:bg-white group-hover:text-black transition-all duration-500"><i data-lucide="${icon}" class="w-5 h-5"></i></div></div></button>`; }
            
            updateMenuPreview(key) { 
                const data = this.menuPreviewData[key]; const card = document.getElementById('menu-preview-card'); const bg = document.getElementById('menu-bg'); 
                if(key === 'partners' || key === 'team' || key === 'help' || key === 'requests') { if(card) { card.classList.remove('opacity-100', 'scale-100'); card.classList.add('opacity-0', 'scale-95'); } if(bg) bg.style.opacity = '0'; return; } 
                if(!data || !data.isGame) { if(card) { card.classList.remove('opacity-100', 'scale-100'); card.classList.add('opacity-0', 'scale-95'); } if(bg) bg.style.opacity = '0'; return; } 
                if(card) { card.classList.remove('opacity-0', 'scale-95'); card.classList.add('opacity-100', 'scale-100'); } if(bg && data.img) { bg.style.backgroundImage = `url('${data.img}')`; bg.style.opacity = '0.4'; } 
                if(document.getElementById('menu-preview-img')) document.getElementById('menu-preview-img').src = data.img; if(document.getElementById('menu-preview-title')) document.getElementById('menu-preview-title').textContent = data.title; if(document.getElementById('menu-preview-desc')) document.getElementById('menu-preview-desc').textContent = data.desc; if(document.getElementById('menu-preview-tag')) document.getElementById('menu-preview-tag').textContent = data.tag; 
            }
            
            setupMenuTilt() { if (this.menuTiltListener) document.removeEventListener('mousemove', this.menuTiltListener); this.menuTiltListener = (e) => { const card = document.getElementById('menu-preview-card'); if(!card || card.classList.contains('opacity-0')) return; const x = (e.clientX / window.innerWidth - 0.5) * 20; const y = (e.clientY / window.innerHeight - 0.5) * 20; card.style.transform = `perspective(1000px) rotateY(${x}deg) rotateX(${-y}deg) scale3d(1.02, 1.02, 1.02)`; }; document.addEventListener('mousemove', this.menuTiltListener); }
            
            enterLibrary() { this.previousLayer = 'library'; const menu = document.getElementById('menu-layer'); menu.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); setTimeout(() => { menu.classList.add('hidden'); const lib = document.getElementById('library-layer'); lib.classList.remove('opacity-0', 'pointer-events-none', 'h-0', 'blur-xl', 'overflow-hidden'); lib.classList.add('opacity-100', 'blur-none', 'pointer-events-auto'); document.body.classList.remove('overflow-hidden'); this.renderLibrary(); }, 800); }
            
            renderLibrary() {
                const filters = document.getElementById('filter-container');
                filters.innerHTML = CATEGORIES.map(cat => `<button onclick="app.setCategory('${cat}')" class="px-6 py-2 rounded-full text-sm font-bold tracking-wide transition-all ${this.activeCategory === cat ? 'bg-white text-black shadow-[0_0_15px_rgba(255,255,255,0.2)]' : 'bg-zinc-900/50 text-zinc-400 hover:bg-zinc-800 border border-zinc-800/50'}">${cat}</button>`).join('');
                const grid = document.getElementById('games-grid');
                let games = GAMES; if (this.activeCategory === 'Favorites') games = games.filter(g => this.favorites.has(g.title)); else if (this.activeCategory !== 'All') games = games.filter(g => g.category === this.activeCategory); if (this.searchQuery) games = games.filter(g => g.title.toLowerCase().includes(this.searchQuery.toLowerCase()));
                const counter = document.getElementById('game-counter'); if(counter) counter.textContent = `${games.length} Games Loaded`;
                grid.innerHTML = games.map(g => `
                    <div class="group game-card-wrapper h-full flex flex-col cursor-pointer" onclick="app.openViewer('${g.title.replace(/'/g, "\\'")}')">
                        <div class="flex-1 flex flex-col bg-[#0a0a0a] rounded-dynamic p-3 transition-all duration-300 relative z-10 overflow-hidden">
                            <div class="w-full aspect-video overflow-hidden rounded-[calc(var(--radius)-0.25rem)] bg-black relative shrink-0">
                                <img src="${g.image}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" onerror="this.style.display='none'" />
                                <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                    <i data-lucide="play-circle" class="w-16 h-16 text-white/80 transform group-hover:scale-110 transition-transform duration-500"></i>
                                </div>
                            </div>
                            <div class="mt-4 px-1 pb-1 flex-1 flex flex-col justify-between">
                                <div class="flex items-start justify-between gap-2">
                                    <h3 class="font-display font-bold text-white text-lg leading-tight line-clamp-2">${g.title}</h3>
                                    <button onclick="app.toggleFav('${g.title.replace(/'/g, "\\'")}', event)" class="p-1.5 rounded-md hover:bg-zinc-800 shrink-0"><i data-lucide="heart" class="w-4 h-4 ${this.favorites.has(g.title) ? 'fill-red-500 text-red-500' : 'text-zinc-500'}"></i></button>
                                </div>
                                <p class="text-[10px] font-mono text-zinc-600 uppercase mt-3">${g.category}</p>
                            </div>
                        </div>
                    </div>`).join('');
                lucide.createIcons();
            }

            setCategory(cat) { this.activeCategory = cat; this.renderLibrary(); }
            toggleFav(t, e) { e.stopPropagation(); this.favorites.has(t) ? this.favorites.delete(t) : this.favorites.add(t); localStorage.setItem('nm4r-favorites', JSON.stringify([...this.favorites])); this.renderLibrary(); }
            playRandomFromMenu() { this.enterLibrary(); setTimeout(() => this.playRandom(), 800); }
            playRandom() { const a = GAMES; if(a.length) this.openViewer(a[Math.floor(Math.random()*a.length)].title); }

            openTeam() { document.body.classList.add('overflow-hidden'); document.getElementById('menu-layer').classList.add('hidden'); const t = document.getElementById('team-layer'); t.classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); t.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); }
            closeTeam() { const t = document.getElementById('team-layer'); t.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto'); t.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); setTimeout(() => { t.classList.add('hidden'); t.classList.remove('flex'); document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); }, 700); }
            
            openPartners() { document.body.classList.add('overflow-hidden'); document.getElementById('menu-layer').classList.add('hidden'); const p = document.getElementById('partners-layer'); p.classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); p.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); }
            closePartners() { const p = document.getElementById('partners-layer'); p.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto'); p.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); setTimeout(() => { p.classList.add('hidden'); p.classList.remove('flex'); document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); }, 700); }

            openHelp() { document.body.classList.add('overflow-hidden'); document.getElementById('menu-layer').classList.add('hidden'); const t = document.getElementById('help-layer'); t.classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); t.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); }
            closeHelp() { const t = document.getElementById('help-layer'); t.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto'); t.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); setTimeout(() => { t.classList.add('hidden'); t.classList.remove('flex'); document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); }, 700); }
            
            openRequests() { document.body.classList.add('overflow-hidden'); document.getElementById('menu-layer').classList.add('hidden'); const t = document.getElementById('request-layer'); t.classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); t.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); }
            closeRequests() { const t = document.getElementById('request-layer'); t.classList.remove('opacity-100', 'scale-100', 'pointer-events-auto'); t.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); setTimeout(() => { t.classList.add('hidden'); t.classList.remove('flex'); document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); }, 700); }
            
            submitGameRequest(e) {
                e.preventDefault();
                const title = document.getElementById('request-title').value;
                const url = document.getElementById('request-url').value;
                if (!title) return;
                try {
                    db.ref('game_requests').push({
                        title: title,
                        url: url,
                        user: accountSystem.username || 'guest',
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    alert('Request submitted successfully!');
                    e.target.reset();
                } catch(err) {
                    console.error("Firebase Error:", err);
                    alert("Could not submit request. Check console for errors.");
                }
            }

            openChat() { 
                if(!accountSystem.username) {
                    const modal = document.getElementById('auth-modal');
                    modal.classList.remove('hidden');
                    setTimeout(()=> modal.classList.remove('opacity-0'), 10);
                    return;
                }

                this.isChatOpen = true; 
                document.body.classList.add('overflow-hidden'); 
                document.getElementById('nav-chat-badge')?.classList.add('hidden'); 
                document.getElementById('chat-layer').classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); 
                document.getElementById('chat-layer').classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); 
                if(this.previousLayer === 'menu') document.getElementById('menu-layer').classList.add('hidden'); 
                if(this.previousLayer === 'library') document.getElementById('library-layer').classList.add('hidden'); 
                if (globalChat) { 
                    globalChat.username = accountSystem.username;
                    globalChat.scrollToBottom(); 
                } 
            }
            closeChat() { this.isChatOpen = false; const layer = document.getElementById('chat-layer'); layer.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); layer.classList.remove('opacity-100', 'scale-100'); setTimeout(() => { layer.classList.add('hidden'); layer.classList.remove('flex'); if(this.previousLayer === 'menu') { document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); } if(this.previousLayer === 'library') { document.getElementById('library-layer').classList.remove('hidden'); document.body.classList.remove('overflow-hidden'); } }, 700); }

            openSettings() { document.body.classList.add('overflow-hidden'); document.getElementById('settings-layer').classList.remove('hidden', 'opacity-0', 'scale-[1.05]', 'pointer-events-none'); document.getElementById('settings-layer').classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); if(this.previousLayer === 'menu') document.getElementById('menu-layer').classList.add('hidden'); if(this.previousLayer === 'library') document.getElementById('library-layer').classList.add('hidden'); this.renderSettingsNav(); this.renderSettingsContent(); }
            closeSettings() { const layer = document.getElementById('settings-layer'); layer.classList.add('opacity-0', 'scale-[1.05]', 'pointer-events-none'); layer.classList.remove('opacity-100', 'scale-100'); setTimeout(() => { layer.classList.add('hidden'); layer.classList.remove('flex'); if(this.previousLayer === 'menu') { document.getElementById('menu-layer').classList.remove('hidden'); document.getElementById('menu-layer').classList.add('flex'); } if(this.previousLayer === 'library') { document.getElementById('library-layer').classList.remove('hidden'); document.body.classList.remove('overflow-hidden'); } }, 700); }

            renderSettingsNav() { const nav = document.getElementById('settings-nav'); const cats = ['Account', 'Design', 'Site', 'Security', 'Themes']; nav.innerHTML = cats.map(c => `<button onclick="app.activeSettingsTab='${c}'; app.renderSettingsContent();" class="text-left px-5 py-4 rounded-xl font-bold font-display transition-all ${this.activeSettingsTab === c ? 'bg-zinc-800 text-white shadow-md' : 'text-zinc-500 hover:text-white hover:bg-zinc-900'}">${c}</button>`).join('') + `<div class="mt-auto pt-6 border-t border-white/5"><button onclick="adminSystem.openLogin()" class="w-full px-5 py-3 text-red-900/50 hover:text-red-500 hover:bg-red-900/10 text-xs font-bold font-mono tracking-widest text-center rounded-xl transition-colors">ADMIN</button></div>`; }
            renderSettingsContent() { 
                this.renderSettingsNav(); 
                document.getElementById('settings-cat-title').textContent = this.activeSettingsTab; 
                const grid = document.getElementById('settings-options-grid'); 
                let optionsHtml = ''; 
                
                const createRow = (title, type, key, extras) => { 
                    const val = this.settings[key]; let control = ''; 
                    if(type === 'toggle') { control = `<button onclick="app.updateSetting('${key}', ${!val})" class="w-12 h-6 rounded-full relative transition-colors duration-300 ${val ? 'bg-accent shadow-[0_0_10px_var(--accent)]' : 'bg-black border border-zinc-700'} shrink-0 focus:outline-none"><div class="absolute top-1 w-4 h-4 bg-white rounded-full transition-transform duration-300 ${val ? 'translate-x-7' : 'translate-x-1'}"></div></button>`; } 
                    else if (type === 'action') { control = `<button onclick="${extras.action}" class="px-4 py-2 rounded-lg text-sm font-bold bg-zinc-800 text-zinc-200 hover:bg-white hover:text-black transition-colors">${extras.label}</button>`; } 
                    else if (type === 'input') { control = `<input type="text" value="${val}" onchange="app.updateSetting('${key}', this.value)" placeholder="${extras.ph}" class="w-full mt-3 bg-black border border-zinc-800 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-zinc-500 font-mono">`; }
                    else if (type === 'slider') { control = `<div class="flex items-center gap-4 w-full mt-2"><input type="range" min="${extras.min}" max="${extras.max}" step="${extras.step}" value="${parseFloat(val)}" oninput="app.updateSetting('${key}', this.value + '${extras.unit}')" class="w-full"><span class="text-xs font-mono text-zinc-500 w-16 text-right">${val}</span></div>`; }
                    else if (type === 'select') { control = `<select onchange="app.updateSetting('${key}', this.value)" class="w-full mt-2 bg-black border border-zinc-800 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-zinc-500">${extras.options.map(o => `<option value="${o.value}" ${val === o.value ? 'selected' : ''}>${o.label}</option>`).join('')}</select>`; }
                    return `<div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-5 flex flex-col justify-center col-span-${extras && extras.span ? extras.span : '1'}"><div class="flex items-center justify-between gap-4"><span class="text-base font-medium text-zinc-200">${title}</span>${type==='toggle' || type==='action' ? control : ''}</div>${type!=='toggle' && type!=='action' ? control : ''}</div>`; 
                };
                
                if(this.activeSettingsTab === 'Account') {
                    optionsHtml = `
                    <div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-6 flex flex-col gap-4 col-span-full">
                        <div class="flex items-center gap-6">
                            <div class="relative group">
                                <img id="pfp-preview" src="${this.settings.profilePic || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}" class="w-24 h-24 rounded-full object-cover bg-zinc-800 border-2 border-zinc-700">
                                <label for="pfp-upload" class="absolute inset-0 bg-black/60 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                    <i data-lucide="camera" class="w-8 h-8"></i>
                                </label>
                                <input type="file" id="pfp-upload" accept="image/*" class="hidden" onchange="app.handlePfpUpload(event)">
                            </div>
                            <div>
                                <h4 class="text-xl font-bold text-white">Cloud Profile</h4>
                                <p class="text-sm text-zinc-400 mt-1">Logged in as: <span class="text-accent font-bold">${accountSystem.username || 'Guest'}</span></p>
                            </div>
                            <div class="ml-auto flex gap-2">
                                <button onclick="accountSystem.changeName()" class="px-4 py-2 bg-zinc-800 hover:bg-white hover:text-black text-white text-sm font-bold rounded-xl transition-colors">Change Name</button>
                                <button onclick="accountSystem.logout()" class="px-4 py-2 bg-red-900/50 hover:bg-red-600 text-red-200 hover:text-white text-sm font-bold rounded-xl transition-colors">Logout</button>
                            </div>
                        </div>
                        <hr class="border-zinc-800 my-2">
                        <div class="flex items-center justify-between">
                            <div><h4 class="text-md font-bold text-white">Cloud Sync</h4><p class="text-xs text-zinc-500 mt-1">Force save settings, favorites, and PFP.</p></div>
                            <button onclick="accountSystem.syncData()" class="px-4 py-2 bg-accent hover:bg-accent/80 text-white text-sm font-bold rounded-xl transition-colors shadow-lg shadow-accent/20">Sync Now</button>
                        </div>
                        ${!accountSystem.username ? `<hr class="border-zinc-800 my-2"><div class="w-full"><button onclick="document.getElementById('auth-modal').classList.remove('hidden'); setTimeout(()=>document.getElementById('auth-modal').classList.remove('opacity-0'),10)" class="w-full px-4 py-3 bg-white text-black font-black uppercase tracking-widest rounded-xl hover:bg-zinc-200 transition-colors">Login / Create Account</button></div>` : ''}
                    </div>`;
                    
                    optionsHtml += `<div class="col-span-full mt-4">${createRow("Change Password", "action", "", {action: 'accountSystem.changePassword()', label: 'Update'})}</div>
                    <div class="col-span-full">${createRow("Update Status", "input", "status", {ph: "Set your status..."})}</div>
                    <div class="col-span-full flex items-center justify-end"><button onclick="accountSystem.updateStatus()" class="px-4 py-2 rounded-lg text-sm font-bold bg-accent text-white">Save Status</button></div>`;
                    setTimeout(() => lucide.createIcons(), 10);
                }
                else if(this.activeSettingsTab === 'Design') {
                    const fontOptions = [{value: "'Outfit', sans-serif", label: "Outfit (Default)"}, {value: "'Inter', sans-serif", label: "Inter"}, {value: "'Roboto Mono', monospace", label: "Roboto Mono"}];
                    optionsHtml = [
                        createRow("Performance Mode", "toggle", "perfMode"), 
                        createRow("Disable Animations", "toggle", "noAnimations"),
                        createRow("Disable Particles", "toggle", "noParticles"),
                        createRow("Compact UI Grid", "toggle", "compactUI"),
                        createRow("Card Hover Lift", "toggle", "hoverFx"),
                        createRow("Base Font", "select", "fontBase", {options: fontOptions, span: 2}),
                        createRow("Font Size", "slider", "textSize", {min: 12, max: 20, step: 1, unit: 'px', span: 2}),
                        createRow("Letter Spacing", "slider", "tracking", {min: -1, max: 2, step: 0.1, unit: 'px', span: 2})
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Site') { 
                    optionsHtml = [
                        createRow("Tab Title", "input", "tabTitle", {ph: 'e.g. Google Classroom', span: 2}), 
                        createRow("Tab Icon URL", "input", "tabIcon", {ph: 'e.g. https://www.google.com/favicon.ico', span: 2}),
                        `<div class="col-span-full"><h4 class="text-sm font-bold text-zinc-400 mb-2">Cloaking Presets</h4><div class="grid grid-cols-3 gap-2">
                           <button onclick="app.updateSetting('tabTitle', 'Google'); app.updateSetting('tabIcon', 'https://www.google.com/favicon.ico')" class="px-4 py-2 text-sm bg-zinc-800 rounded-lg">Google</button>
                           <button onclick="app.updateSetting('tabTitle', 'Classes'); app.updateSetting('tabIcon', 'https://www.gstatic.com/classroom/favicon.ico')" class="px-4 py-2 text-sm bg-zinc-800 rounded-lg">Classroom</button>
                           <button onclick="app.updateSetting('tabTitle', 'Canvas'); app.updateSetting('tabIcon', 'https://canvas.instructure.com/favicon.ico')" class="px-4 py-2 text-sm bg-zinc-800 rounded-lg">Canvas</button>
                        </div></div>`,
                        `<div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-5 flex flex-col justify-center col-span-full"><div class="flex items-center justify-between gap-4"><span class="text-base font-medium text-zinc-200">Open in about:blank</span><button onclick="app.cloak()" class="px-4 py-2 rounded-lg text-sm font-bold bg-zinc-800 text-zinc-200 hover:bg-white hover:text-black transition-colors">Execute</button></div></div>`
                    ].join('');
                }
                else if(this.activeSettingsTab === 'Security') optionsHtml = [createRow("Panic Keybind", "input", "panicKey", {ph: 'e.g. ` or Esc'}), createRow("Panic Redirect URL", "input", "panicUrl", {ph: 'https://...'})].join('');
                else if(this.activeSettingsTab === 'Themes') { 
                    const themeButtons = [
                        {label: 'Default', value: 'default'}, {label: 'Nord', value: 'theme-nord'}, {label: 'Solarized', value: 'theme-solarized'}, {label: 'Terminal', value: 'theme-terminal'}
                    ].map(theme => `<button onclick="app.updateSetting('theme', '${theme.value}')" class="px-4 py-3 rounded-lg text-sm font-bold ${this.settings.theme === theme.value ? 'bg-white text-black' : 'bg-zinc-800 text-zinc-400'}">${theme.label}</button>`).join('');
                    
                    optionsHtml = `<div class="col-span-full"><h4 class="text-sm font-bold text-zinc-400 mb-2">Full Themes</h4><div class="grid grid-cols-2 gap-2 mb-6">${themeButtons}</div></div>` +
                    THEME_COLORS.map((hex, i) => `<div class="bg-zinc-900/30 border border-zinc-800/50 rounded-2xl p-5 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-6 h-6 rounded-full" style="background-color: ${hex}"></div><span class="text-base font-medium text-zinc-200">Accent 0${i+1}</span></div><button onclick="app.updateSetting('accentColor', '${hex}')" class="px-4 py-2 rounded-lg text-sm font-bold ${this.settings.accentColor === hex ? 'bg-white text-black' : 'bg-zinc-800 text-zinc-400'} transition-colors">Select</button></div>`).join(''); 
                }
                grid.innerHTML = optionsHtml;
            }

            handlePfpUpload(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_DIM = 128;
                        let width = img.width, height = img.height;
                        if (width > height) { if (width > MAX_DIM) { height *= MAX_DIM / width; width = MAX_DIM; } } 
                        else { if (height > MAX_DIM) { width *= MAX_DIM / height; height = MAX_DIM; } }
                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.8);
                        this.updateSetting('profilePic', dataUrl);
                        document.getElementById('pfp-preview').src = dataUrl;
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }

            updateSetting(key, val) { this.settings[key] = val; localStorage.setItem('nm4r-settings', JSON.stringify(this.settings)); this.applySettings(); this.renderSettingsContent(); }
            
            applySettings() {
                const s = this.settings;
                const root = document.documentElement;
                const body = document.body;

                // Apply theme class
                body.className = body.className.replace(/theme-\w+/g, '').trim();
                if(s.theme && s.theme !== 'default') body.classList.add(s.theme);

                // Set CSS variables
                root.style.setProperty('--accent', s.accentColor);
                root.style.setProperty('--radius', s.borderRadius);
                root.style.setProperty('--font-base', s.fontBase);
                root.style.setProperty('--font-head', s.fontHead);
                root.style.setProperty('--text-size', s.textSize);
                root.style.setProperty('--tracking', s.tracking);

                // Toggle classes
                const toggle = (className, condition) => body.classList.toggle(className, condition);
                toggle('perf-mode', s.perfMode);
                toggle('compact-ui', s.compactUI);
                toggle('no-hover-fx', !s.hoverFx);
                toggle('no-animations', s.noAnimations);
                document.getElementById('bg-canvas').classList.toggle('hidden', s.noParticles);

                // Tab Cloaking
                document.title = s.tabTitle || 'NOTMINE4REAL';
                let link = document.querySelector("link[rel*='icon']") || document.createElement('link');
                link.type = 'image/x-icon'; link.rel = 'shortcut icon';
                link.href = s.tabIcon || document.getElementById('app-favicon').href;
                document.head.appendChild(link);
                
                // PFP
                const pfp = document.getElementById('sidebar-pfp');
                const initial = document.getElementById('sidebar-user-initial');
                if (pfp && initial) {
                    if (s.profilePic) {
                        pfp.src = s.profilePic;
                        pfp.classList.remove('hidden');
                        initial.classList.add('hidden');
                    } else {
                        pfp.classList.add('hidden');
                        initial.classList.remove('hidden');
                    }
                }
            }
            setupSecurity() { document.addEventListener('keydown', e => { if (e.key === this.settings.panicKey) { e.preventDefault(); this.panic(); }}); }
            panic() { let url = this.settings.panicUrl; if (!url.startsWith('http')) url = 'https://' + url; window.location.replace(url); }
            cloak() { const newWindow = window.open('about:blank', '_blank'); if (newWindow) { const iframe = newWindow.document.createElement('iframe'); const currentIcon = document.querySelector("link[rel*='icon']").href; const currentTitle = document.title; newWindow.document.title = currentTitle; let link = newWindow.document.createElement('link'); link.rel = 'icon'; link.href = currentIcon; newWindow.document.head.appendChild(link); iframe.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;border:0;'; iframe.src = window.location.href; newWindow.document.body.appendChild(iframe); } else { alert('Please allow popups to use this feature.'); } }
            openViewer(gameTitle) { document.body.classList.add('overflow-hidden'); const game = GAMES.find(g => g.title === gameTitle); if (!game) return; this.currentGame = game; document.getElementById('viewer-title').textContent = game.title; document.getElementById('viewer-category').textContent = game.category; document.getElementById('viewer-bg').style.backgroundImage = `url(${game.image})`; const viewer = document.getElementById('viewer-layer'); viewer.classList.remove('hidden', 'opacity-0', 'scale-[1.02]', 'pointer-events-none'); viewer.classList.add('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); document.getElementById('game-frame').src = game.url; }
            closeViewer() { const viewer = document.getElementById('viewer-layer'); viewer.classList.remove('flex', 'opacity-100', 'scale-100', 'pointer-events-auto'); viewer.classList.add('opacity-0', 'scale-[1.02]', 'pointer-events-none'); document.body.classList.remove('overflow-hidden'); setTimeout(() => { viewer.classList.add('hidden'); document.getElementById('game-frame').src = ''; }, 700); this.currentGame = null; }
            
            setupFullscreenListener() { document.addEventListener('fullscreenchange', () => { const icon = document.getElementById('fullscreen-icon'); if (icon) { if (document.fullscreenElement) { icon.setAttribute('data-lucide', 'minimize'); } else { icon.setAttribute('data-lucide', 'maximize'); } lucide.createIcons(); } }); }
            toggleFullscreen() { const elem = document.getElementById('game-container'); if (!document.fullscreenElement) { elem.requestFullscreen().catch(err => { alert(`Error: ${err.message}`); }); } else { document.exitFullscreen(); } }

            // --- NOTIFICATION SYSTEM ---
            loadNotifications() { this.notifications = JSON.parse(localStorage.getItem('nm4r-notifications') || '[]'); this.renderNotifications(); }
            saveNotifications() { localStorage.setItem('nm4r-notifications', JSON.stringify(this.notifications)); }
            addNotification(type, title, message) { const newNotif = { id: Date.now(), type, title, message, read: false, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }; this.notifications.unshift(newNotif); if (this.notifications.length > 20) this.notifications.pop(); this.saveNotifications(); this.renderNotifications(); }
            renderNotifications() { const list = document.getElementById('notification-list'); const badge = document.getElementById('notif-badge'); const unreadCount = this.notifications.filter(n => !n.read).length; if (list) { if(this.notifications.length === 0) { list.innerHTML = `<p class="p-4 text-center text-xs text-zinc-500">No notifications.</p>`; } else { list.innerHTML = this.notifications.map(n => this.createNotificationHTML(n)).join(''); } lucide.createIcons(); } if (badge) { if (unreadCount > 0) badge.classList.remove('hidden'); else badge.classList.add('hidden'); } }
            createNotificationHTML(n) { const icons = { admin: 'megaphone', friend: 'user-plus' }; const colors = { admin: 'text-yellow-500', friend: 'text-blue-400'}; return `<div class="p-3 flex items-start gap-3 border-b border-zinc-800/50 last:border-0 hover:bg-zinc-800/50 rounded-lg relative"><div class="w-1.5 h-1.5 rounded-full bg-red-500 absolute top-3 left-1.5 ${n.read ? 'hidden' : ''}"></div><i data-lucide="${icons[n.type] || 'bell'}" class="w-5 h-5 ${colors[n.type] || 'text-zinc-400'} mt-1 shrink-0 ml-2"></i><div class="flex-1"><div class="flex items-center justify-between"><h4 class="text-sm font-bold text-white">${n.title}</h4><span class="text-[10px] text-zinc-500 font-mono">${n.time}</span></div><p class="text-xs text-zinc-400 mt-1">${n.message}</p></div></div>`; }
            toggleNotifications() { const panel = document.getElementById('notification-panel'); const isOpen = !panel.classList.contains('hidden'); if(isOpen) { panel.classList.add('opacity-0', 'scale-95'); setTimeout(() => panel.classList.add('hidden'), 300); } else { panel.classList.remove('hidden'); setTimeout(() => panel.classList.remove('opacity-0', 'scale-95'), 10); this.notifications.forEach(n => n.read = true); this.saveNotifications(); this.renderNotifications(); } }
            clearNotifications() { this.notifications = []; this.saveNotifications(); this.renderNotifications(); }

            // --- ADMIN ALERT GUI ---
            showAdminAlertGUI(message) { document.getElementById('admin-alert-message').textContent = message; const modal = document.getElementById('admin-alert-modal'); modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('opacity-0'), 10); lucide.createIcons(); }
            hideAdminAlertGUI() { const modal = document.getElementById('admin-alert-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); }

            // --- BRAINROT SYSTEM ---
            startBrainrot() {
                if(this.brainrotInterval) return;
                const emojis = ['', '', '', '', '', '', '', '', '', ''];
                this.brainrotInterval = setInterval(() => {
                    const el = document.createElement('div');
                    el.className = 'falling-brainrot';
                    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    el.style.left = Math.random() * 100 + 'vw';
                    el.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    document.body.appendChild(el);
                    setTimeout(() => el.remove(), 5000);
                }, 150);
            }
            stopBrainrot() {
                clearInterval(this.brainrotInterval);
                this.brainrotInterval = null;
                document.querySelectorAll('.falling-brainrot').forEach(el => el.remove());
            }

            // --- JUMPSCARE SYSTEM ---
            executeJumpscare() {
                const audio = new Audio('https://www.myinstants.com/media/sounds/fnaf-scream.mp3');
                audio.volume = 1.0;
                audio.play().catch(e=>{});
                const overlay = document.createElement('div');
                overlay.className = 'jumpscare-overlay';
                overlay.innerHTML = `<img src="https://i.imgflip.com/6hzzn0.png" class="jumpscare-img">`;
                document.body.appendChild(overlay);
                setTimeout(() => overlay.remove(), 2000);
            }
            
            // --- FAKE CURSOR ---
            toggleFakeCursor(enable) {
                if(enable) {
                    if(this.fakeCursor) return;
                    document.body.classList.add('cursor-troll');
                    this.fakeCursor = document.createElement('div');
                    this.fakeCursor.className = 'fake-cursor';
                    document.body.appendChild(this.fakeCursor);
                    document.addEventListener('mousemove', this.moveFakeCursor);
                } else {
                    document.body.classList.remove('cursor-troll');
                    if(this.fakeCursor) {
                        this.fakeCursor.remove();
                        this.fakeCursor = null;
                    }
                    document.removeEventListener('mousemove', this.moveFakeCursor);
                }
            }
            moveFakeCursor = (e) => {
                if(this.fakeCursor) {
                    this.fakeCursor.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
                }
            }
            
            toggleGibberish(enable) {
                const elements = document.querySelectorAll('h1, h2, h3, h4, p, span, button, a');
                if (enable) {
                    document.body.classList.add('text-gibberish-mode');
                    elements.forEach(el => {
                        if (!el.closest('#admin-layer, #owner-layer')) {
                            const originalText = el.textContent;
                            if (originalText.trim().length > 0) {
                                el.dataset.originalText = originalText;
                                el.textContent = originalText.replace(/[a-zA-Z0-9]/g, () => '');
                            }
                        }
                    });
                } else {
                    document.body.classList.remove('text-gibberish-mode');
                    elements.forEach(el => {
                        if (el.dataset.originalText) {
                            el.textContent = el.dataset.originalText;
                            delete el.dataset.originalText;
                        }
                    });
                }
            }

            listenForAdminCommands() {
                try {
                    db.ref('global_commands').limitToLast(1).on('child_added', (snapshot) => {
                        const cmd = snapshot.val();
                        if (Date.now() - cmd.timestamp > 3000) return; 
                        
                        if (window.isAdmin || window.isAppAdmin) { return; } // Both owner and admins are immune

                        if(cmd.target && cmd.target.toLowerCase() !== 'all' && cmd.target !== "") {
                            if(cmd.target.toLowerCase() !== (accountSystem.username || "").toLowerCase()) return;
                        }

                        // --- Audio Commands ---
                        const siren = document.getElementById('siren-audio');
                        const cowboy = document.getElementById('cowboy-audio');

                        switch(cmd.type) {
                            case 'global_alert': this.showAdminAlertGUI(cmd.payload || "Alert"); this.addNotification('admin', 'System Alert', cmd.payload); break;
                            case 'force_reload': location.reload(); break;
                            case 'system_lock': document.getElementById('blur-overlay').classList.remove('hidden'); setTimeout(() => document.getElementById('blur-overlay').classList.remove('opacity-0'), 10); document.body.classList.add('blur-locked'); break;
                            case 'system_unlock': document.getElementById('blur-overlay').classList.add('opacity-0'); setTimeout(() => document.getElementById('blur-overlay').classList.add('hidden'), 300); document.body.classList.remove('blur-locked'); break;
                            case 'rickroll': window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ"; break;
                            case 'matrix_mode_on': document.body.classList.add('matrix-mode'); break;
                            case 'matrix_mode_off': document.body.classList.remove('matrix-mode'); break;
                            case 'rainbow_on': document.body.classList.add('rainbow-mode'); break;
                            case 'rainbow_off': document.body.classList.remove('rainbow-mode'); break;
                            case 'brainrot_on': this.startBrainrot(); break;
                            case 'brainrot_off': this.stopBrainrot(); break;
                            case 'grayscale_on': document.body.classList.add('grayscale-mode'); break;
                            case 'grayscale_off': document.body.classList.remove('grayscale-mode'); break;
                            case 'blur_on': document.body.classList.add('blur-mode'); break;
                            case 'blur_off': document.body.classList.remove('blur-mode'); break;
                            case 'force_logout': accountSystem.logout(); break;
                            case 'mute_user': if(globalChat) globalChat.isMuted = true; break;
                            case 'unmute_user': if(globalChat) globalChat.isMuted = false; break;

                            // OWNER COMMANDS
                            case 'owner_jumpscare': this.executeJumpscare(); break;
                            case 'owner_earthquake_on': document.body.classList.add('earthquake-mode'); break;
                            case 'owner_earthquake_off': document.body.classList.remove('earthquake-mode'); break;
                            case 'owner_rotate_on': document.body.classList.add('rotate-mode'); break;
                            case 'owner_rotate_off': document.body.classList.remove('rotate-mode'); break;
                            case 'owner_invert_on': document.body.classList.add('invert-mode'); break;
                            case 'owner_invert_off': document.body.classList.remove('invert-mode'); break;
                            case 'owner_glitch_on': document.body.classList.add('glitch-mode'); break;
                            case 'owner_glitch_off': document.body.classList.remove('glitch-mode'); break;
                            case 'owner_fake_cursor_on': this.toggleFakeCursor(true); break;
                            case 'owner_fake_cursor_off': this.toggleFakeCursor(false); break;
                            case 'owner_spin_on': document.body.classList.add('spin-mode'); break;
                            case 'owner_spin_off': document.body.classList.remove('spin-mode'); break;
                            case 'owner_float_on': document.body.classList.add('float-away-mode'); break;
                            case 'owner_float_off': document.body.classList.remove('float-away-mode'); break;
                            case 'owner_hide_ui_on': document.body.classList.add('hide-ui-mode'); break;
                            case 'owner_hide_ui_off': document.body.classList.remove('hide-ui-mode'); break;
                            case 'owner_siren_on': siren.play().catch(e=>{}); break;
                            case 'owner_siren_off': siren.pause(); siren.currentTime = 0; break;
                            case 'text_gibberish_on': this.toggleGibberish(true); break;
                            case 'text_gibberish_off': this.toggleGibberish(false); break;
                            case 'invert_scroll_on': document.body.classList.add('invert-scroll-mode'); break;
                            case 'invert_scroll_off': document.body.classList.remove('invert-scroll-mode'); break;
                            case 'owner_cowboy': 
                                cowboy.play().catch(e=>{});
                                const cOverlay = document.createElement('div'); cOverlay.className = 'screaming-cowboy-overlay'; cOverlay.innerHTML = `<img src="https://media1.tenor.com/m/5-2h23aO0s0AAAAC/sky-screaming.gif" class="screaming-cowboy-img">`; document.body.appendChild(cOverlay);
                                setTimeout(() => cOverlay.remove(), 4000);
                                break;
                            case 'play_all_sounds': siren.play(); cowboy.play(); break;
                            case 'owner_spam_alerts': 
                                let i = 0; 
                                const spam = setInterval(() => { this.addNotification('admin', 'SYSTEM WARNING', 'CRITICAL ERROR DETECTED'); if(i++ > 15) clearInterval(spam); }, 200);
                                break;
                            case 'owner_force_cloak': this.cloak(); break;
                            case 'owner_shutdown':
                                document.body.innerHTML = '<div style="background:black;color:red;height:100vh;display:flex;align-items:center;justify-content:center;font-family:monospace;font-size:2rem;font-weight:bold;">SYSTEM TERMINATED.</div>';
                                break;
                            case 'owner_disable_chat':
                                if(globalChat) { globalChat.input.disabled = true; globalChat.submitBtn.disabled = true; globalChat.input.placeholder = "CHAT LOCKED BY OWNER."; }
                                break;
                            case 'owner_enable_chat':
                                if(globalChat) { globalChat.input.disabled = false; globalChat.submitBtn.disabled = false; globalChat.input.placeholder = "Type a message..."; }
                                break;
                            case 'owner_kick': window.location.href = "https://www.google.com"; break;
                            case 'owner_nuke_chat': if(globalChat) document.getElementById('chat-messages').innerHTML = '<p class="text-red-500 font-bold text-center">ALL CHAT HISTORY HAS BEEN INCINERATED.</p>'; break;
                            case 'owner_wipe_db': alert("YOUR ACCOUNT HAS BEEN DELETED."); localStorage.clear(); location.reload(); break;
                            case 'owner_wipe_pfp': case 'owner_random_theme': case 'reset_user_settings': location.reload(); break; // Reload to apply server-side settings change
                            case 'owner_flashbang': 
                                const f = document.createElement('div');
                                f.style.cssText = 'position:fixed;inset:0;background:white;z-index:999999;transition:opacity 2s;';
                                document.body.appendChild(f);
                                const a = new Audio('https://www.myinstants.com/media/sounds/flashbang.mp3'); a.play().catch(e=>{});
                                setTimeout(() => f.style.opacity = 0, 100);
                                setTimeout(() => f.remove(), 2100);
                                break;
                        }
                    });
                } catch(e) { console.error("Admin command listener failed:", e) }
            }
        }
        const app = new App();

        class AdminSystem {
            constructor() {
                this.activeTab = 'commands';
            }
            openLogin() { document.getElementById('admin-login-modal').classList.remove('hidden'); document.getElementById('admin-login-modal').classList.add('flex'); }
            closeLogin() { document.getElementById('admin-login-modal').classList.add('hidden'); document.getElementById('admin-login-modal').classList.remove('flex'); }
            
            async verify() { 
                const pass = document.getElementById('admin-password-input').value; 
                this.closeLogin(); 
                document.getElementById('admin-password-input').value = "";
                
                let panelId = null;
                if(pass === "0924") { 
                    panelId = 'admin-layer'; 
                    window.isAdmin = true;
                } 
                else if (pass === "ZER0" || (accountSystem.username && accountSystem.username.toLowerCase() === 'owner')) { 
                    panelId = 'owner-layer'; 
                    window.isAdmin = true;
                } 
                else if (window.isAppAdmin) {
                     panelId = 'admin-layer';
                     window.isAdmin = true;
                }
                else { alert("ACCESS DENIED"); return; }
                
                app.closeSettings();
                const panel = document.getElementById(panelId); 
                panel.classList.remove('hidden'); 
                panel.classList.add('flex');
                
                await this.populateUserList();
                if (panelId === 'owner-layer') {
                    this.addGameRequestTab();
                }
                lucide.createIcons();
            }

            addGameRequestTab() {
                const nav = document.getElementById('owner-nav');
                if (nav && !document.getElementById('requests-tab-btn')) {
                    nav.querySelector('.flex-col').innerHTML += `<button id="requests-tab-btn" onclick="adminSystem.switchTab('requests', 'owner')" class="owner-tab-btn text-left px-4 py-3 rounded-xl font-bold text-sm text-yellow-500/80 hover:bg-yellow-900/10">Game Requests</button>`;
                }
            }

            async loadGameRequests() {
                this.switchTab('requests', 'owner');
                const listEl = document.getElementById('game-requests-list');
                if (!listEl) return;
                listEl.innerHTML = '<p class="text-zinc-500">Loading requests...</p>';
                try {
                    const snapshot = await db.ref('game_requests').orderByChild('timestamp').once('value');
                    const requests = snapshot.val();
                    if (!requests) {
                        listEl.innerHTML = '<p class="text-zinc-500">No pending game requests.</p>';
                        return;
                    }
                    const sortedKeys = Object.keys(requests).sort((a,b) => requests[b].timestamp - requests[a].timestamp);
                    listEl.innerHTML = sortedKeys.map(key => {
                        const req = requests[key];
                        return `
                        <div class="bg-zinc-900/50 border border-yellow-900/30 rounded-lg p-4 flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-white">${req.title}</h4>
                                <p class="text-xs text-zinc-400 mt-1">
                                    Requested by <span class="text-yellow-400">${req.user}</span> on ${new Date(req.timestamp).toLocaleDateString()}
                                </p>
                                ${req.url ? `<a href="${req.url}" target="_blank" class="text-xs text-cyan-400 hover:underline">Game Link</a>` : ''}
                            </div>
                            <button onclick="adminSystem.deleteGameRequest('${key}')" class="p-2 text-red-500 hover:bg-red-500/10 rounded-full"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>`;
                    }).join('');
                    lucide.createIcons();
                } catch(e) {
                    listEl.innerHTML = '<p class="text-red-500">Error loading requests.</p>';
                    console.error("Failed to load game requests:", e);
                }
            }

            async deleteGameRequest(key) {
                if (confirm('Are you sure you want to delete this request?')) {
                    await db.ref(`game_requests/${key}`).remove();
                    this.loadGameRequests();
                }
            }
            
            async populateUserList() {
                try {
                    const snapshot = await db.ref('accounts').once('value');
                    const users = snapshot.val() ? Object.keys(snapshot.val()) : [];
                    const adminSelect = document.getElementById('admin-user-select');
                    const ownerSelect = document.getElementById('owner-user-select');
                    
                    const optionsHtml = '<option value="">All Users</option>' + users.map(u => `<option value="${u}">${u}</option>`).join('');
                    if(adminSelect) adminSelect.innerHTML = optionsHtml;
                    if(ownerSelect) ownerSelect.innerHTML = optionsHtml;

                } catch(e) { console.error("Failed to populate user list:", e); }
            }
            
            closePanel(panelId) {
                const panel = document.getElementById(panelId);
                panel.classList.add('hidden');
                panel.classList.remove('flex');
                window.isAdmin = false;
            }
            sendCommand(type, payload = null) { 
                if(!db) { alert("Error: DB not connected."); return; } 
                
                let targetInput;
                if(!document.getElementById('admin-layer').classList.contains('hidden')) {
                    targetInput = document.getElementById('admin-target-user');
                } else if (!document.getElementById('owner-layer').classList.contains('hidden')) {
                    targetInput = document.getElementById('owner-target-user');
                }
                const target = targetInput ? targetInput.value.trim() : "";
                
                const commandData = { 
                    type: type, 
                    payload: payload, 
                    target: target || "ALL",
                    timestamp: firebase.database.ServerValue.TIMESTAMP 
                };

                // For commands that directly manipulate user data
                if (['owner_wipe_pfp', 'owner_random_theme'].includes(type)) {
                    if (target && target !== "ALL") {
                        if(type === 'owner_wipe_pfp') db.ref(`accounts/${target}/settings/profilePic`).set("");
                        if(type === 'owner_random_theme') db.ref(`accounts/${target}/settings/accentColor`).set(THEME_COLORS[Math.floor(Math.random() * THEME_COLORS.length)]);
                    } else {
                        alert("These commands require a specific target user.");
                        return;
                    }
                }
                
                db.ref('global_commands').push(commandData); 
                
                if(type === 'clear_chat' || type === 'owner_nuke_chat') { db.ref('messages/global').remove(); } 
                if(type === 'owner_wipe_db') { db.ref('accounts').remove(); db.ref('bans').remove(); } 
                
                const btn = event.currentTarget; 
                if(btn && btn.tagName === 'BUTTON') {
                    btn.classList.add('border-green-500');
                    setTimeout(() => { btn.classList.remove('border-green-500'); }, 500); 
                }
            }
            
            getTargetUser(promptMsg) {
                let targetInput;
                if(!document.getElementById('admin-layer').classList.contains('hidden')) {
                    targetInput = document.getElementById('admin-target-user');
                } else if (!document.getElementById('owner-layer').classList.contains('hidden')) {
                    targetInput = document.getElementById('owner-target-user');
                }
                const targetUser = targetInput ? targetInput.value.trim() : "";
                return targetUser || prompt(promptMsg);
            }

            async banUser() {
                const userToBan = this.getTargetUser("Enter the username to BAN:");
                if (userToBan) {
                    await db.ref(`bans/${userToBan}`).set(true);
                    alert(`${userToBan} has been banned.`);
                }
            }

            async unbanUser() {
                const userToUnban = this.getTargetUser("Enter the username to UNBAN:");
                if (userToUnban) {
                    await db.ref(`bans/${userToUnban}`).remove();
                    alert(`${userToUnban} has been unbanned.`);
                }
            }

            async promoteUser() {
                const userToPromote = this.getTargetUser("Enter username to promote to Admin:");
                if (userToPromote) {
                    await db.ref(`accounts/${userToPromote}/role`).set('admin');
                    alert(`${userToPromote} is now an admin.`);
                }
            }

            async demoteUser() {
                const userToDemote = this.getTargetUser("Enter username to demote:");
                if (userToDemote) {
                    await db.ref(`accounts/${userToDemote}/role`).remove();
                    alert(`${userToDemote} is no longer an admin.`);
                }
            }
            
            async resetUserSettings() {
                const userToReset = this.getTargetUser("Enter username to reset settings for:");
                if(userToReset && confirm(`Are you sure you want to reset all settings for ${userToReset}?`)) {
                    await db.ref(`accounts/${userToReset}/settings`).set(app.defaultSettings);
                    this.sendCommand('reset_user_settings', null); // Force reload client
                    alert(`${userToReset}'s settings have been reset.`);
                }
            }


            sendCustomAlert() { const msg = prompt("Enter the message to send to all users:"); if (msg) { this.sendCommand('global_alert', msg); } }
            
            switchTab(tabName, panelType) {
                this.activeTab = tabName;
                document.querySelectorAll(`.${panelType}-tab-btn`).forEach(btn => {
                    const color = panelType === 'owner' ? 'yellow' : 'red';
                    btn.classList.remove(`bg-${color}-900/20`, 'text-white');
                    btn.classList.add(`text-zinc-400`, `hover:bg-${color}-900/10`, `hover:text-white`);
                    btn.style.borderColor = 'transparent';
                });
                document.querySelectorAll(`.${panelType}-tab-content`).forEach(content => {
                    content.classList.add('hidden');
                });
                
                const activeBtn = event.currentTarget;
                if(activeBtn) {
                    const color = panelType === 'owner' ? 'yellow' : 'red';
                    activeBtn.classList.add(`bg-${color}-900/20`, 'text-white');
                    activeBtn.classList.remove(`text-zinc-400`);
                    activeBtn.style.borderColor = `var(--${color}-900/30)`;
                }
                document.getElementById(`${panelType}-tab-content-${tabName}`).classList.remove('hidden');

                if (tabName === 'requests' && panelType === 'owner') {
                    this.loadGameRequests();
                }
            }
        }
        const adminSystem = new AdminSystem();

        class ChatSystem {
            constructor() {
                this.messagesContainer = document.getElementById('chat-messages');
                this.form = document.getElementById('chat-form');
                this.input = document.getElementById('chat-input');
                this.submitBtn = document.getElementById('chat-submit-btn');
                this.voiceNoteBtn = document.getElementById('voice-note-btn');
                this.navBadge = document.getElementById('nav-chat-badge');
                this.ringtone = document.getElementById('ringtone-audio');
                this.username = accountSystem.username;
                this.friends = JSON.parse(localStorage.getItem('nm4r-friends') || '[]');
                this.groups = JSON.parse(localStorage.getItem('nm4r-groups') || '[]');
                this.unreadCounts = JSON.parse(localStorage.getItem('nm4r-unread') || '{}');
                this.isMuted = false;
                
                this.currentChannel = 'global';
                this.currentChannelName = 'Global Chat';
                this.messagesListener = null;

                // RTC and Media Recorder state
                this.localStream = null; this.peerConnection = null; this.callRef = null; this.isCalling = false; this.isVideoCall = false; this.pendingCallChannel = null; this.pendingFriendRequest = null;
                this.mediaRecorder = null; this.audioChunks = []; this.isRecording = false;

                this.allUsers = [];
                this.replyingTo = null;
                
                this.form.addEventListener('submit', (e) => { e.preventDefault(); this.sendMessage(); });
                this.voiceNoteBtn.addEventListener('mousedown', this.startRecording);
                this.voiceNoteBtn.addEventListener('mouseup', this.stopRecording);
                this.voiceNoteBtn.addEventListener('mouseleave', this.stopRecording);
                // Touch events for mobile
                this.voiceNoteBtn.addEventListener('touchstart', (e) => { e.preventDefault(); this.startRecording(); });
                this.voiceNoteBtn.addEventListener('touchend', (e) => { e.preventDefault(); this.stopRecording(); });

                document.addEventListener('keydown', (e) => {
                    if (e.key === "Escape" && !document.getElementById('image-viewer-modal').classList.contains('hidden')) {
                        this.hideImageModal();
                    }
                });
                
                this.db = db; 
                if(this.db) { 
                    this.db.ref('users').on('value', snap => { if(snap.val()) this.allUsers = Object.keys(snap.val()); }); 
                    if (this.username) { 
                        this.renderSidebar();
                        this.updateSidebarBadges();
                        this.listenForCalls(); 
                        this.listenForFriendRequests();
                        this.input.disabled = false;
                        this.submitBtn.disabled = false;
                        document.getElementById('sidebar-username').textContent = this.username;
                        document.getElementById('sidebar-user-initial').textContent = this.username.charAt(0).toUpperCase();
                    } 
                }
            }

            showImageModal(src) {
                const modal = document.getElementById('image-viewer-modal');
                const img = document.getElementById('image-viewer-img');
                img.src = src;
                modal.classList.remove('hidden');
                setTimeout(() => modal.classList.remove('opacity-0'), 10);
            }

            hideImageModal() {
                const modal = document.getElementById('image-viewer-modal');
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            
            handleAutocomplete(e) { const query = e.target.value.toLowerCase(); const dropdown = document.getElementById('autocomplete-dropdown'); if(!query || this.addType !== 'friend') { dropdown.classList.add('hidden'); return; } const matches = this.allUsers.filter(u => u.toLowerCase().includes(query) && u !== this.username && !this.friends.includes(u)).slice(0, 5); if(matches.length === 0) { dropdown.classList.add('hidden'); return; } dropdown.innerHTML = matches.map(m => `<div class="px-4 py-3 hover:bg-zinc-700 cursor-pointer text-white border-b border-zinc-700/50 last:border-0 transition-colors" onclick="globalChat.selectSuggestion('${m}')">${m}</div>`).join(''); dropdown.classList.remove('hidden'); }
            selectSuggestion(user) { document.getElementById('add-modal-input').value = user; document.getElementById('autocomplete-dropdown').classList.add('hidden'); document.getElementById('add-modal-input').focus(); }
            listenForFriendRequests() { this.db.ref(`requests/${this.username}`).on('child_added', snapshot => { this.showFriendRequest(snapshot.key); app.addNotification('friend', 'Friend Request', `${snapshot.key} wants to be your friend.`) }); this.db.ref(`accepts/${this.username}`).on('child_added', snapshot => { const target = snapshot.key; if(!this.friends.includes(target)) { this.friends.push(target); localStorage.setItem('nm4r-friends', JSON.stringify(this.friends)); this.renderSidebar(); } this.db.ref(`accepts/${this.username}/${target}`).remove(); }); }
            renderSidebar() { const fList = document.getElementById('friends-list'); fList.innerHTML = this.friends.map(f => `<button onclick="globalChat.switchChannel('dm_${[this.username, f].sort().join('_')}', '${f}', true)" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors group channel-btn relative" data-id="dm_${[this.username, f].sort().join('_')}"><div class="w-8 h-8 rounded-full bg-zinc-800 text-zinc-400 flex items-center justify-center text-xs font-bold group-hover:text-white shrink-0">${f.charAt(0).toUpperCase()}</div><span class="font-medium text-zinc-400 group-hover:text-white truncate flex-1 text-left">${f}</span></button>`).join('') || '<p class="text-xs text-zinc-600 px-3 py-1">No friends added.</p>'; const gList = document.getElementById('groups-list'); gList.innerHTML = this.groups.map(g => `<button onclick="globalChat.switchChannel('group_${g}', '${g}', true)" class="w-full flex items-center gap-3 px-3 py-2 rounded-lg transition-colors group channel-btn relative" data-id="group_${g}"><div class="w-8 h-8 rounded-lg bg-zinc-800 flex items-center justify-center group-hover:text-white shrink-0"><i data-lucide="users" class="w-4 h-4 text-zinc-400 group-hover:text-white"></i></div><span class="font-medium text-zinc-400 group-hover:text-white truncate flex-1 text-left">${g}</span></button>`).join('') || '<p class="text-xs text-zinc-600 px-3 py-1">No groups created.</p>'; lucide.createIcons(); this.listenForCalls(); this.updateSidebarBadges(); }
            openAddModal(type) { this.addType = type; const modal = document.getElementById('add-modal'); document.getElementById('add-modal-title').textContent = type === 'friend' ? 'Add a Friend' : 'Create Group'; document.getElementById('add-modal-input').placeholder = type === 'friend' ? 'Search Username...' : 'Enter Group Name...'; document.getElementById('add-modal-input').value = ''; document.getElementById('add-modal-error').classList.add('hidden'); document.getElementById('autocomplete-dropdown').classList.add('hidden'); modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('opacity-0'), 10); document.getElementById('add-modal-input').focus(); }
            closeAddModal() { const modal = document.getElementById('add-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); }
            confirmAdd() { const input = document.getElementById('add-modal-input').value.trim(); const err = document.getElementById('add-modal-error'); if(!input) { err.textContent = "Please enter a name."; err.classList.remove('hidden'); return; } if(input === this.username && this.addType === 'friend') { err.textContent = "You can't add yourself."; err.classList.remove('hidden'); return; } if (this.addType === 'friend') { if(this.friends.includes(input)) { err.textContent = "Already friends."; err.classList.remove('hidden'); return; } this.db.ref(`requests/${input}/${this.username}`).set(Date.now()); err.classList.remove('hidden', 'text-accent'); err.classList.add('text-green-500'); err.textContent = "Friend Request Sent!"; setTimeout(() => this.closeAddModal(), 1500); } else { if(!this.groups.includes(input)) { this.groups.push(input); localStorage.setItem('nm4r-groups', JSON.stringify(this.groups)); this.renderSidebar(); this.closeAddModal(); } } }
            showFriendRequest(sender) { this.pendingFriendRequest = sender; document.getElementById('friend-request-name').innerHTML = `<span class="text-white font-bold">${sender}</span> wants to add you.`; const modal = document.getElementById('friend-request-modal'); modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('opacity-0'), 10); }
            acceptFriendRequest() { if(!this.pendingFriendRequest) return; const sender = this.pendingFriendRequest; if(!this.friends.includes(sender)) { this.friends.push(sender); localStorage.setItem('nm4r-friends', JSON.stringify(this.friends)); } this.db.ref(`accepts/${sender}/${this.username}`).set(Date.now()); this.db.ref(`requests/${this.username}/${sender}`).remove(); const modal = document.getElementById('friend-request-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); this.pendingFriendRequest = null; this.renderSidebar(); }
            declineFriendRequest() { if(!this.pendingFriendRequest) return; this.db.ref(`requests/${this.username}/${this.pendingFriendRequest}`).remove(); const modal = document.getElementById('friend-request-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); this.pendingFriendRequest = null; }
            
            switchChannel(channelId, channelName, showCallBtn = false) { 
                this.currentChannel = channelId; this.currentChannelName = channelName; 
                document.getElementById('current-room-name').textContent = channelName; 
                document.getElementById('chat-messages').innerHTML = ''; 
                this.cancelReply(); 
                
                const controls = document.getElementById('call-controls-container'); 
                const imgBtn = document.getElementById('chat-img-btn');
                const voiceBtn = document.getElementById('voice-note-btn');

                if (channelId === 'global') {
                    controls.classList.add('hidden');
                    imgBtn.classList.add('hidden');
                    voiceBtn.classList.add('hidden');
                } else {
                    if(showCallBtn) controls.classList.remove('hidden');
                    imgBtn.classList.remove('hidden');
                    voiceBtn.classList.remove('hidden');
                }

                document.querySelectorAll('.channel-btn').forEach(btn => { btn.classList.remove('bg-zinc-800'); if(btn.dataset.id === channelId) btn.classList.add('bg-zinc-800'); }); 
                if (this.messagesListener) this.messagesListener.off(); 
                this.messagesListener = this.db.ref(`messages/${channelId}`).limitToLast(50); 
                this.messagesListener.on('child_added', (snapshot, prevChildKey) => { this.receiveMessage(snapshot.val(), channelId, snapshot.key); }); 
                this.input.focus();
                
                // Clear unread count for this channel
                if (this.unreadCounts[channelId]) {
                    this.unreadCounts[channelId] = 0;
                    this.updateSidebarBadges();
                }
            }
            
            updateSidebarBadges() {
                localStorage.setItem('nm4r-unread', JSON.stringify(this.unreadCounts));
                document.querySelectorAll('.channel-btn').forEach(btn => {
                    const channelId = btn.dataset.id;
                    let badge = btn.querySelector('.unread-badge');
                    if (this.unreadCounts[channelId] > 0) {
                        if (!badge) {
                            badge = document.createElement('span');
                            badge.className = 'unread-badge absolute right-2 top-1/2 -translate-y-1/2 bg-red-500 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center';
                            btn.appendChild(badge);
                        }
                        badge.textContent = this.unreadCounts[channelId] > 9 ? '9+' : this.unreadCounts[channelId];
                    } else {
                        if (badge) badge.remove();
                    }
                });
            }

            initiateReply(user, encodedText) { const text = decodeURIComponent(encodedText); this.replyingTo = { user, text }; document.getElementById('reply-preview').classList.remove('hidden'); document.getElementById('reply-preview-user').textContent = user; document.getElementById('reply-preview-text').textContent = text; this.input.focus(); }
            cancelReply() { this.replyingTo = null; document.getElementById('reply-preview').classList.add('hidden'); }
            
            handleImageUpload(e) {
                const file = e.target.files[0];
                if(!file || !this.username) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 500;
                        let scaleSize = 1;
                        if(img.width > MAX_WIDTH) scaleSize = MAX_WIDTH / img.width;
                        canvas.width = img.width * scaleSize;
                        canvas.height = img.height * scaleSize;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        const dataUrl = canvas.toDataURL('image/jpeg', 0.6); 
                        this.db.ref(`messages/${this.currentChannel}`).push({
                            user: this.username,
                            pfp: app.settings.profilePic || null,
                            imgBase64: dataUrl,
                            time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                        });
                    }
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
                e.target.value = ''; 
            }

            sendMessage() { 
                const text = this.input.value.trim(); 
                if(!text || !this.username) return; 
                if (this.currentChannel === 'global' && this.isMuted) {
                    alert("You are muted in the global chat.");
                    return;
                }
                const msg = { user: this.username, text: text, pfp: app.settings.profilePic || null, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), replyTo: this.replyingTo || null }; 
                this.db.ref(`messages/${this.currentChannel}`).push(msg); this.input.value = ''; this.cancelReply(); this.input.focus(); 
            }
            
            receiveMessage(msg, channelId) {
                const isMe = msg.user === this.username; 
                if (channelId !== this.currentChannel && !isMe) {
                    this.unreadCounts[channelId] = (this.unreadCounts[channelId] || 0) + 1;
                    this.updateSidebarBadges();
                }

                let pfpHtml = '';
                if (msg.pfp) {
                    pfpHtml = `<img src="${msg.pfp}" class="w-8 h-8 rounded-full object-cover">`;
                } else {
                    pfpHtml = `<div class="w-8 h-8 rounded-full bg-zinc-700 flex items-center justify-center text-sm font-bold text-white">${msg.user.charAt(0).toUpperCase()}</div>`;
                }

                let replyHtml = ''; 
                if (msg.replyTo) { replyHtml = `<div class="text-[11px] text-zinc-300 bg-black/30 rounded-lg px-3 py-1.5 mb-2 border-l-2 border-white/50 truncate max-w-full"><span class="font-bold opacity-80">@${msg.replyTo.user}</span>: <span class="opacity-70">${this.escapeHTML(msg.replyTo.text)}</span></div>`; } 
                
                let contentHtml = '', safeText = '';
                if(msg.imgBase64) {
                    contentHtml = `<img src="${msg.imgBase64}" class="w-full max-w-[250px] rounded-lg cursor-pointer hover:opacity-80 transition-opacity" onclick="globalChat.showImageModal('${msg.imgBase64}')">`;
                    safeText = encodeURIComponent("[Image]");
                } else if (msg.audioBase64) {
                    const audioId = `audio_${Date.now()}_${Math.random()}`;
                    contentHtml = `<div class="audio-player">
                        <audio id="${audioId}" src="${msg.audioBase64}"></audio>
                        <button onclick="globalChat.toggleAudioPlayer('${audioId}')"><i data-lucide="play" class="w-4 h-4"></i></button>
                        <div class="progress-bar"><div class="progress"></div></div>
                    </div>`;
                    safeText = encodeURIComponent("[Voice Note]");
                } else {
                    contentHtml = this.escapeHTML(msg.text);
                    safeText = encodeURIComponent(msg.text); 
                }
                
                let html = `
                    <div class="flex items-start gap-3 group animate-reveal-up ${isMe ? 'flex-row-reverse' : ''}" style="animation-duration: 0.3s">
                        <div class="shrink-0 mt-1">${pfpHtml}</div>
                        <div class="flex flex-col gap-1 ${isMe ? 'items-end' : 'items-start'}">
                            <div class="flex items-center gap-2">
                                <span class="text-sm font-bold tracking-wide text-zinc-300">${msg.user}</span>
                                <span class="text-[10px] font-mono text-zinc-600">${msg.time}</span>
                            </div>
                            <div class="relative group/bubble">
                                <div class="px-4 py-3 text-[15px] max-w-xs md:max-w-md break-words shadow-lg ${isMe ? 'bg-gradient-to-br from-accent-dark to-accent text-white rounded-[1.2rem] rounded-br-sm' : 'bg-zinc-800 text-zinc-100 rounded-[1.2rem] rounded-bl-sm'}">
                                    ${replyHtml}${contentHtml}
                                </div>
                                <button onclick="globalChat.initiateReply('${msg.user}', '${safeText}')" class="absolute top-1/2 -translate-y-1/2 ${isMe ? 'left-0 -translate-x-full' : 'right-0 translate-x-full'} opacity-0 group-hover/bubble:opacity-100 p-2 text-zinc-500 hover:text-white transition-opacity"><i data-lucide="reply" class="w-4 h-4"></i></button>
                            </div>
                        </div>
                    </div>`; 

                this.messagesContainer.insertAdjacentHTML('beforeend', html); 
                lucide.createIcons();
                if (msg.audioBase64) this.initAudioPlayer(document.getElementById(this.messagesContainer.lastElementChild.querySelector('audio').id));
                this.scrollToBottom(); 
                if(!app.isChatOpen && !isMe && this.navBadge) this.navBadge.classList.remove('hidden'); 
            }
            
            initAudioPlayer(audioElement) {
                audioElement.addEventListener('timeupdate', () => {
                    const progress = (audioElement.currentTime / audioElement.duration) * 100;
                    audioElement.parentElement.querySelector('.progress').style.width = `${progress}%`;
                });
                audioElement.addEventListener('ended', () => {
                    audioElement.parentElement.querySelector('button i').setAttribute('data-lucide', 'play');
                    lucide.createIcons();
                });
            }

            toggleAudioPlayer(audioId) {
                const audio = document.getElementById(audioId);
                const icon = audio.parentElement.querySelector('button i');
                if (audio.paused) {
                    audio.play();
                    icon.setAttribute('data-lucide', 'pause');
                } else {
                    audio.pause();
                    icon.setAttribute('data-lucide', 'play');
                }
                lucide.createIcons();
            }

            startRecording = async () => {
                if (this.isRecording) return;
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.isRecording = true;
                    this.audioChunks = [];
                    this.mediaRecorder = new MediaRecorder(stream);
                    this.mediaRecorder.ondataavailable = e => this.audioChunks.push(e.data);
                    this.mediaRecorder.onstop = this.sendRecording;
                    this.mediaRecorder.start();
                    this.voiceNoteBtn.classList.add('bg-red-500', 'text-white', 'animate-pulse');
                } catch(e) { console.error("Mic access denied:", e); alert("Microphone access is required for voice notes."); }
            }

            stopRecording = () => {
                if (!this.isRecording || !this.mediaRecorder) return;
                this.mediaRecorder.stop();
                this.isRecording = false;
                this.voiceNoteBtn.classList.remove('bg-red-500', 'text-white', 'animate-pulse');
            }

            sendRecording = () => {
                const audioBlob = new Blob(this.audioChunks, { type: 'audio/webm' });
                const reader = new FileReader();
                reader.readAsDataURL(audioBlob);
                reader.onloadend = () => {
                    const base64String = reader.result;
                    this.db.ref(`messages/${this.currentChannel}`).push({
                        user: this.username,
                        pfp: app.settings.profilePic || null,
                        audioBase64: base64String,
                        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                    });
                };
            }
            
            scrollToBottom() { setTimeout(() => { this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight; }, 50); }
            escapeHTML(str) { return str.replace(/[&<>'"]/g, tag => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;' }[tag])); }
            
            // --- CALL LOGIC ---
            listenForCalls() { const channelsToListen = []; this.friends.forEach(f => channelsToListen.push(`dm_${[this.username, f].sort().join('_')}`)); this.groups.forEach(g => channelsToListen.push(`group_${g}`)); channelsToListen.forEach(channelId => { this.db.ref(`calls/${channelId}`).on('value', snapshot => { const callData = snapshot.val(); if (callData && callData.offer && callData.caller !== this.username && !this.isCalling) { this.showIncomingCall(callData.caller, channelId, callData.isVideo); } if (callData && callData.answer && callData.caller === this.username && this.isCalling) { if (!this.peerConnection.currentRemoteDescription) { this.peerConnection.setRemoteDescription(new RTCSessionDescription(callData.answer)); } } if (callData && callData.candidates) { Object.values(callData.candidates).forEach(c => { if (c.user !== this.username && this.peerConnection) { this.peerConnection.addIceCandidate(new RTCIceCandidate(c.candidate)).catch(e=>console.error(e)); } }); } if (!callData && this.isCalling) this.endCall(false); }); }); }
            async setupWebRTC(channelId, isVideo = false) { const configuration = {'iceServers': [{'urls': 'stun:stun.l.google.com:19302'}]}; this.peerConnection = new RTCPeerConnection(configuration); this.callRef = this.db.ref(`calls/${channelId}`); this.isVideoCall = isVideo; try { this.localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: isVideo }); if (isVideo) { document.getElementById('local-video').srcObject = this.localStream; } this.localStream.getTracks().forEach(track => { this.peerConnection.addTrack(track, this.localStream); }); } catch (e) { alert("Hardware access blocked. Ensure you are on HTTPS."); return false; } this.peerConnection.ontrack = event => { if(isVideo) { document.getElementById('remote-video').srcObject = event.streams[0]; } else { document.getElementById('remote-audio').srcObject = event.streams[0]; } }; this.peerConnection.onicecandidate = event => { if (event.candidate) { this.callRef.child('candidates').push({ user: this.username, candidate: event.candidate.toJSON() }); } }; this.isCalling = true; let cleanName = channelId.replace('dm_', '').replace('group_', '').replace(this.username, '').replace('_', ''); this.showActiveCallUI(cleanName, isVideo); return true; }
            async initiateCall(isVideo) { if (this.currentChannel === 'global') return; const success = await this.setupWebRTC(this.currentChannel, isVideo); if (!success) return; const offer = await this.peerConnection.createOffer(); await this.peerConnection.setLocalDescription(offer); this.callRef.set({ caller: this.username, isVideo: isVideo, offer: { type: offer.type, sdp: offer.sdp } }); }
            showIncomingCall(callerName, channelId, isVideo) { this.pendingCallChannel = channelId; document.getElementById('incoming-caller-name').textContent = `${callerName} is calling...`; document.getElementById('incoming-call-type-title').textContent = isVideo ? 'Incoming Video Call' : 'Incoming Voice Call'; document.getElementById('incoming-call-icon').setAttribute('data-lucide', isVideo ? 'video' : 'phone'); document.getElementById('incoming-accept-icon').setAttribute('data-lucide', isVideo ? 'video' : 'phone'); lucide.createIcons(); const modal = document.getElementById('incoming-call-modal'); modal.classList.remove('hidden'); setTimeout(() => modal.classList.remove('opacity-0'), 10); this.ringtone.currentTime = 0; this.ringtone.play().catch(e => console.log("Audio autoplay blocked")); }
            async acceptCall() { this.ringtone.pause(); const modal = document.getElementById('incoming-call-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); if (!this.pendingCallChannel) return; const snapshot = await this.db.ref(`calls/${this.pendingCallChannel}`).once('value'); const callData = snapshot.val(); if(!callData || callData.answer) { this.endCall(false); return; } const success = await this.setupWebRTC(this.pendingCallChannel, callData.isVideo); if (!success) return; await this.peerConnection.setRemoteDescription(new RTCSessionDescription(callData.offer)); const answer = await this.peerConnection.createAnswer(); await this.peerConnection.setLocalDescription(answer); this.callRef.update({ answer: { type: answer.type, sdp: answer.sdp } }); }
            declineCall() { this.ringtone.pause(); const modal = document.getElementById('incoming-call-modal'); modal.classList.add('opacity-0'); setTimeout(() => modal.classList.add('hidden'), 300); if (this.pendingCallChannel) { this.db.ref(`calls/${this.pendingCallChannel}`).remove(); this.pendingCallChannel = null; } }
            showActiveCallUI(name, isVideo) { if (isVideo) { const vidUI = document.getElementById('video-call-ui'); vidUI.classList.remove('hidden'); vidUI.classList.add('flex'); } else { document.getElementById('active-call-name').textContent = name; const bar = document.getElementById('active-call-bar'); bar.classList.remove('hidden'); bar.classList.add('flex'); } }
            
            toggleAudio() {
                if(this.localStream) {
                    const audioTrack = this.localStream.getAudioTracks()[0];
                    if(audioTrack) {
                        audioTrack.enabled = !audioTrack.enabled;
                        document.querySelectorAll('.call-mic-icon').forEach(i => {
                            i.setAttribute('data-lucide', audioTrack.enabled ? 'mic' : 'mic-off');
                            if(!audioTrack.enabled) i.classList.add('text-red-500');
                            else i.classList.remove('text-red-500');
                        });
                        lucide.createIcons();
                    }
                }
            }
            
            toggleVideo() {
                if(this.localStream) {
                    const videoTrack = this.localStream.getVideoTracks()[0];
                    if(videoTrack) {
                        videoTrack.enabled = !videoTrack.enabled;
                        document.querySelectorAll('.call-vid-icon').forEach(i => {
                            i.setAttribute('data-lucide', videoTrack.enabled ? 'video' : 'video-off');
                            if(!videoTrack.enabled) i.classList.add('text-red-500');
                            else i.classList.remove('text-red-500');
                        });
                        lucide.createIcons();
                    }
                }
            }
            
            endCall(clearDb = true) { this.isCalling = false; this.isVideoCall = false; this.ringtone.pause(); const bar = document.getElementById('active-call-bar'); bar.classList.add('hidden'); bar.classList.remove('flex'); const vidUI = document.getElementById('video-call-ui'); vidUI.classList.add('hidden'); vidUI.classList.remove('flex'); document.getElementById('remote-audio').srcObject = null; document.getElementById('remote-video').srcObject = null; document.getElementById('local-video').srcObject = null; document.getElementById('incoming-call-modal').classList.add('opacity-0', 'hidden'); if (this.localStream) { this.localStream.getTracks().forEach(track => track.stop()); this.localStream = null; } if (this.peerConnection) { this.peerConnection.close(); this.peerConnection = null; } if (this.callRef && clearDb) { this.callRef.remove(); } }
        }
        let globalChat; window.addEventListener('DOMContentLoaded', () => { setTimeout(() => { globalChat = new ChatSystem(); }, 500); });

        // --- PARTICLE CANVAS SYSTEM ---
        window.addEventListener('load', () => {
            const canvas = document.getElementById('bg-canvas');
            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];
            const mouse = { x: null, y: null, radius: 100 }; 

            class Particle {
                constructor(x, y) {
                    this.x = x; this.y = y; this.baseX = x; this.baseY = y;
                    this.density = (Math.random() * 20) + 1; 
                    this.size = Math.random() * 1.5;
                }
                draw() {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                    ctx.beginPath(); ctx.arc(this.x, this.y, this.currentSize || this.size, 0, Math.PI * 2); ctx.closePath(); ctx.fill();
                }
                update() {
                    let dx = mouse.x - this.x; let dy = mouse.y - this.y;
                    let distance = Math.sqrt(dx * dx + dy * dy);
                    let forceDirectionX = dx / distance; let forceDirectionY = dy / distance;
                    let maxDistance = mouse.radius; let force = (maxDistance - distance) / maxDistance;
                    let directionX = forceDirectionX * force * this.density; let directionY = forceDirectionY * force * this.density;

                    if (distance < mouse.radius) {
                        this.x -= directionX; this.y -= directionY;
                        this.currentSize = this.size * (1 + ((maxDistance - distance) / maxDistance) * 1.5); 
                    } else {
                        if (this.x !== this.baseX) { let dx = this.x - this.baseX; this.x -= dx / 15; }
                        if (this.y !== this.baseY) { let dy = this.y - this.baseY; this.y -= dy / 15; }
                        this.currentSize = this.size;
                    }
                }
            }

            function initParticles() {
                particles = []; const gap = 35; 
                for (let y = 0; y < height; y += gap) { for (let x = 0; x < width; x += gap) { particles.push(new Particle(x, y)); } }
            }

            function animateParticles() {
                if (document.getElementById('bg-canvas').classList.contains('hidden')) {
                     requestAnimationFrame(animateParticles);
                     return;
                }
                ctx.clearRect(0, 0, width, height);
                for (let i = 0; i < particles.length; i++) { particles[i].draw(); particles[i].update(); }
                requestAnimationFrame(animateParticles);
            }

            function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; initParticles(); }
            window.addEventListener('resize', resize);
            window.addEventListener('mousemove', (e) => { mouse.x = e.x; mouse.y = e.y; });
            resize(); animateParticles();
        });
    </script>
</body>
</html>
